<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Leptonica: src/fpix2.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<script type="text/javascript">
function hasClass(ele,cls) {
  return ele.className.match(new RegExp('(\\s|^)'+cls+'(\\s|$)'));
}

function addClass(ele,cls) {
  if (!this.hasClass(ele,cls)) ele.className += " "+cls;
}

function removeClass(ele,cls) {
  if (hasClass(ele,cls)) {
    var reg = new RegExp('(\\s|^)'+cls+'(\\s|$)');
    ele.className=ele.className.replace(reg,' ');
  }
}

function toggleVisibility(linkObj) {
 var base = linkObj.getAttribute('id');
 var summary = document.getElementById(base + '-summary');
 var content = document.getElementById(base + '-content');
 var trigger = document.getElementById(base + '-trigger');
 if ( hasClass(linkObj,'closed') ) {
   summary.style.display = 'none';
   content.style.display = 'block';
   trigger.src = 'open.png';
   removeClass(linkObj,'closed');
   addClass(linkObj,'opened');
 } else if ( hasClass(linkObj,'opened') ) {
   summary.style.display = 'block';
   content.style.display = 'none';
   trigger.src = 'closed.png';
   removeClass(linkObj,'opened');
   addClass(linkObj,'closed');
 }
 return false;
}
</script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="moller52-tiny.jpg"></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Leptonica&#160;<span id="projectnumber">1.68</span></div>
   <div id="projectbrief">C Image Processing Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('fpix2_8c.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<h1>fpix2.c</h1>  </div>
</div>
<div class="contents">
<a href="fpix2_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*====================================================================*</span>
<a name="l00002"></a>00002 <span class="comment"> -  Copyright (C) 2001 Leptonica.  All rights reserved.</span>
<a name="l00003"></a>00003 <span class="comment"> -  This software is distributed in the hope that it will be</span>
<a name="l00004"></a>00004 <span class="comment"> -  useful, but with NO WARRANTY OF ANY KIND.</span>
<a name="l00005"></a>00005 <span class="comment"> -  No author or distributor accepts responsibility to anyone for the</span>
<a name="l00006"></a>00006 <span class="comment"> -  consequences of using this software, or for whether it serves any</span>
<a name="l00007"></a>00007 <span class="comment"> -  particular purpose or works at all, unless he or she says so in</span>
<a name="l00008"></a>00008 <span class="comment"> -  writing.  Everyone is granted permission to copy, modify and</span>
<a name="l00009"></a>00009 <span class="comment"> -  redistribute this source code, for commercial or non-commercial</span>
<a name="l00010"></a>00010 <span class="comment"> -  purposes, with the following restrictions: (1) the origin of this</span>
<a name="l00011"></a>00011 <span class="comment"> -  source code must not be misrepresented; (2) modified versions must</span>
<a name="l00012"></a>00012 <span class="comment"> -  be plainly marked as such; and (3) this notice may not be removed</span>
<a name="l00013"></a>00013 <span class="comment"> -  or altered from any source or modified source distribution.</span>
<a name="l00014"></a>00014 <span class="comment"> *====================================================================*/</span>
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 <span class="comment">/*</span>
<a name="l00017"></a>00017 <span class="comment"> *  fpix2.c</span>
<a name="l00018"></a>00018 <span class="comment"> *</span>
<a name="l00019"></a>00019 <span class="comment"> *    This file has these FPix utilities:</span>
<a name="l00020"></a>00020 <span class="comment"> *       - interconversion with pix</span>
<a name="l00021"></a>00021 <span class="comment"> *       - interconversion with dpix</span>
<a name="l00022"></a>00022 <span class="comment"> *       - min and max values</span>
<a name="l00023"></a>00023 <span class="comment"> *       - border functions</span>
<a name="l00024"></a>00024 <span class="comment"> *       - simple rasterop (source --&gt; dest)</span>
<a name="l00025"></a>00025 <span class="comment"> *       - integer scaling</span>
<a name="l00026"></a>00026 <span class="comment"> *       - arithmetic operations</span>
<a name="l00027"></a>00027 <span class="comment"> *</span>
<a name="l00028"></a>00028 <span class="comment"> *    Interconversions between Pix and FPix</span>
<a name="l00029"></a>00029 <span class="comment"> *          FPIX          *pixConvertToFPix()</span>
<a name="l00030"></a>00030 <span class="comment"> *          PIX           *fpixConvertToPix()</span>
<a name="l00031"></a>00031 <span class="comment"> *          PIX           *fpixDisplayMaxDynamicRange()  [useful for debugging]</span>
<a name="l00032"></a>00032 <span class="comment"> *</span>
<a name="l00033"></a>00033 <span class="comment"> *    Interconversions between FPix and DPix</span>
<a name="l00034"></a>00034 <span class="comment"> *          DPIX          *fpixConvertToDPix()</span>
<a name="l00035"></a>00035 <span class="comment"> *          FPIX          *dpixConvertToFPix()</span>
<a name="l00036"></a>00036 <span class="comment"> *</span>
<a name="l00037"></a>00037 <span class="comment"> *    FPix min/max value</span>
<a name="l00038"></a>00038 <span class="comment"> *          l_int32        fpixGetMin()</span>
<a name="l00039"></a>00039 <span class="comment"> *          l_int32        fpixGetMax()</span>
<a name="l00040"></a>00040 <span class="comment"> *</span>
<a name="l00041"></a>00041 <span class="comment"> *    FPix border functions</span>
<a name="l00042"></a>00042 <span class="comment"> *          FPIX          *fpixAddBorder()</span>
<a name="l00043"></a>00043 <span class="comment"> *          FPIX          *fpixRemoveBorder()</span>
<a name="l00044"></a>00044 <span class="comment"> *          FPIX          *fpixAddMirroredBorder()</span>
<a name="l00045"></a>00045 <span class="comment"> *</span>
<a name="l00046"></a>00046 <span class="comment"> *    FPix simple rasterop</span>
<a name="l00047"></a>00047 <span class="comment"> *          l_int32        fpixRasterop()</span>
<a name="l00048"></a>00048 <span class="comment"> *</span>
<a name="l00049"></a>00049 <span class="comment"> *    Integer scaling</span>
<a name="l00050"></a>00050 <span class="comment"> *          FPIX          *fpixScaleByInteger()</span>
<a name="l00051"></a>00051 <span class="comment"> *          DPIX          *dpixScaleByInteger()</span>
<a name="l00052"></a>00052 <span class="comment"> *</span>
<a name="l00053"></a>00053 <span class="comment"> *    FPix arithmetic operations</span>
<a name="l00054"></a>00054 <span class="comment"> *          FPIX          *fpixLinearCombination()</span>
<a name="l00055"></a>00055 <span class="comment"> *          l_int32        fpixAddMultConstant()</span>
<a name="l00056"></a>00056 <span class="comment"> */</span>
<a name="l00057"></a>00057 
<a name="l00058"></a>00058 <span class="preprocessor">#include &quot;<a class="code" href="allheaders_8h.html" title="Includes all required Leptonica header files.">allheaders.h</a>&quot;</span>
<a name="l00059"></a>00059 
<a name="l00060"></a>00060 <span class="comment">/*--------------------------------------------------------------------*</span>
<a name="l00061"></a>00061 <span class="comment"> *                     FPix  &lt;--&gt;  Pix conversions                    *</span>
<a name="l00062"></a>00062 <span class="comment"> *--------------------------------------------------------------------*/</span><span class="comment"></span>
<a name="l00063"></a>00063 <span class="comment">/*!</span>
<a name="l00064"></a>00064 <span class="comment"> *  pixConvertToFPix()</span>
<a name="l00065"></a>00065 <span class="comment"> *</span>
<a name="l00066"></a>00066 <span class="comment"> *      Input:  pix (1, 2, 4, 8, 16 or 32 bpp)</span>
<a name="l00067"></a>00067 <span class="comment"> *              ncomps (number of components: 3 for RGB, 1 otherwise)</span>
<a name="l00068"></a>00068 <span class="comment"> *      Return: fpix, or null on error</span>
<a name="l00069"></a>00069 <span class="comment"> *</span>
<a name="l00070"></a>00070 <span class="comment"> *  Notes:</span>
<a name="l00071"></a>00071 <span class="comment"> *      (1) If colormapped, remove to grayscale.</span>
<a name="l00072"></a>00072 <span class="comment"> *      (2) If 32 bpp and @ncomps == 3, this is RGB; convert to luminance.</span>
<a name="l00073"></a>00073 <span class="comment"> *          In all other cases the src image is treated as having a single</span>
<a name="l00074"></a>00074 <span class="comment"> *          component of pixel values.</span>
<a name="l00075"></a>00075 <span class="comment"> */</span>
<a name="l00076"></a>00076 <a class="code" href="struct_f_pix.html">FPIX</a> *
<a name="l00077"></a><a class="code" href="leptprotos_8h.html#aa6db4a2bcef4eb8931d6c090ae65517d">00077</a> <a class="code" href="fpix2_8c.html#aabfd27542dbf273137b4e85e63596e3b">pixConvertToFPix</a>(<a class="code" href="struct_pix.html">PIX</a>     *<a class="code" href="struct_l___dewarp.html#a8a427338bac6feb299cfadfd61d522ce">pixs</a>,
<a name="l00078"></a>00078                  <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  ncomps)
<a name="l00079"></a>00079 {
<a name="l00080"></a>00080 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>     w, h, d, i, j, val, wplt, wpld;
<a name="l00081"></a>00081 <a class="code" href="environ_8h.html#a4d4d7254020fc95aef5dde8884405358">l_uint32</a>    uval;
<a name="l00082"></a>00082 <a class="code" href="environ_8h.html#a4d4d7254020fc95aef5dde8884405358">l_uint32</a>   *datat, *linet;
<a name="l00083"></a>00083 <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>  *datad, *lined;
<a name="l00084"></a>00084 <a class="code" href="struct_pix.html">PIX</a>        *pixt;
<a name="l00085"></a>00085 <a class="code" href="struct_f_pix.html">FPIX</a>       *fpixd;
<a name="l00086"></a>00086 
<a name="l00087"></a>00087     <a class="code" href="environ_8h.html#a1a16952819bcbc526c998e3ac86f2e78">PROCNAME</a>(<span class="stringliteral">&quot;pixConvertToFPix&quot;</span>);
<a name="l00088"></a>00088 
<a name="l00089"></a>00089     <span class="keywordflow">if</span> (!pixs)
<a name="l00090"></a>00090         <span class="keywordflow">return</span> (<a class="code" href="struct_f_pix.html">FPIX</a> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;pixs not defined&quot;</span>, procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00091"></a>00091 
<a name="l00092"></a>00092     <span class="keywordflow">if</span> (<a class="code" href="leptprotos_8h.html#a6c959f1c381ebe5a4abc867a3d8ae1e6">pixGetColormap</a>(pixs))
<a name="l00093"></a>00093         pixt = <a class="code" href="leptprotos_8h.html#a422b2e45ac5ed1185c1804fdca9f7528">pixRemoveColormap</a>(pixs, <a class="code" href="pix_8h.html#aabfcbcb5ac86a1edac4035264bc7d2b8a54402b4e942824148e91eb282043b413">REMOVE_CMAP_TO_GRAYSCALE</a>);
<a name="l00094"></a>00094     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="leptprotos_8h.html#a1646270a1eae38cd7af74c68351ce513">pixGetDepth</a>(pixs) == 32 &amp;&amp; ncomps == 3)
<a name="l00095"></a>00095         pixt = <a class="code" href="leptprotos_8h.html#a44e5faddaf3507b26f5fac41218db5a2">pixConvertRGBToLuminance</a>(pixs);
<a name="l00096"></a>00096     <span class="keywordflow">else</span>
<a name="l00097"></a>00097         pixt = <a class="code" href="leptprotos_8h.html#a48c3df1b04f60de6d7fcabd8375250d8">pixClone</a>(pixs);
<a name="l00098"></a>00098 
<a name="l00099"></a>00099     <a class="code" href="leptprotos_8h.html#a11b8bc890f3872b0a19307f4c5a9b41e">pixGetDimensions</a>(pixt, &amp;w, &amp;h, &amp;d);
<a name="l00100"></a>00100     <span class="keywordflow">if</span> ((fpixd = <a class="code" href="fpix1_8c.html#adbbb61d64f5c6262dca09633b1693f4d">fpixCreate</a>(w, h)) == <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00101"></a>00101         <span class="keywordflow">return</span> (<a class="code" href="struct_f_pix.html">FPIX</a> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;fpixd not made&quot;</span>, procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00102"></a>00102     datat = <a class="code" href="leptprotos_8h.html#a44546f758f2cf71bb109bfc114e3ca7f">pixGetData</a>(pixt);
<a name="l00103"></a>00103     wplt = <a class="code" href="leptprotos_8h.html#af0b490472ab7999f208098dd37167d73">pixGetWpl</a>(pixt);
<a name="l00104"></a>00104     datad = <a class="code" href="fpix1_8c.html#af27ae584a0480d0f65258e8d8465846b">fpixGetData</a>(fpixd);
<a name="l00105"></a>00105     wpld = <a class="code" href="fpix1_8c.html#ab7f19e7fb19716b478b16f5f20c059c3">fpixGetWpl</a>(fpixd);
<a name="l00106"></a>00106     <span class="keywordflow">for</span> (i = 0; i &lt; h; i++) {
<a name="l00107"></a>00107         linet = datat + i * wplt;
<a name="l00108"></a>00108         lined = datad + i * wpld;
<a name="l00109"></a>00109         <span class="keywordflow">if</span> (d == 1) {
<a name="l00110"></a>00110             <span class="keywordflow">for</span> (j = 0; j &lt; w; j++) {
<a name="l00111"></a>00111                 val = <a class="code" href="arrayaccess_8h.html#ac76be298c81846741bd3106d13a027b2">GET_DATA_BIT</a>(linet, j);
<a name="l00112"></a>00112                 lined[j] = (<a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>)val;
<a name="l00113"></a>00113             }
<a name="l00114"></a>00114         }
<a name="l00115"></a>00115         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (d == 2) {
<a name="l00116"></a>00116             <span class="keywordflow">for</span> (j = 0; j &lt; w; j++) {
<a name="l00117"></a>00117                 val = <a class="code" href="arrayaccess_8h.html#aa37f0d0f3189d384fb554b9d10fb1498">GET_DATA_DIBIT</a>(linet, j);
<a name="l00118"></a>00118                 lined[j] = (<a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>)val;
<a name="l00119"></a>00119             }
<a name="l00120"></a>00120         }
<a name="l00121"></a>00121         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (d == 4) {
<a name="l00122"></a>00122             <span class="keywordflow">for</span> (j = 0; j &lt; w; j++) {
<a name="l00123"></a>00123                 val = <a class="code" href="arrayaccess_8h.html#a0d694a93f7177f411859ccc24e4f92b8">GET_DATA_QBIT</a>(linet, j);
<a name="l00124"></a>00124                 lined[j] = (<a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>)val;
<a name="l00125"></a>00125             }
<a name="l00126"></a>00126         }
<a name="l00127"></a>00127         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (d == 8) {
<a name="l00128"></a>00128             <span class="keywordflow">for</span> (j = 0; j &lt; w; j++) {
<a name="l00129"></a>00129                 val = <a class="code" href="arrayaccess_8h.html#a9b285094ef3b18d30d8ad13262e61faf">GET_DATA_BYTE</a>(linet, j);
<a name="l00130"></a>00130                 lined[j] = (<a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>)val;
<a name="l00131"></a>00131             }
<a name="l00132"></a>00132         }
<a name="l00133"></a>00133         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (d == 16) {
<a name="l00134"></a>00134             <span class="keywordflow">for</span> (j = 0; j &lt; w; j++) {
<a name="l00135"></a>00135                 val = <a class="code" href="arrayaccess_8h.html#a123c239e0f125d8afe9abacc11009e2b">GET_DATA_TWO_BYTES</a>(linet, j);
<a name="l00136"></a>00136                 lined[j] = (<a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>)val;
<a name="l00137"></a>00137             }
<a name="l00138"></a>00138         }
<a name="l00139"></a>00139         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (d == 32) {
<a name="l00140"></a>00140             <span class="keywordflow">for</span> (j = 0; j &lt; w; j++) {
<a name="l00141"></a>00141                 uval = <a class="code" href="arrayaccess_8h.html#aa0d0c6816e0b1c2857cc1e59e6c4377e">GET_DATA_FOUR_BYTES</a>(linet, j);
<a name="l00142"></a>00142                 lined[j] = (<a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>)uval;
<a name="l00143"></a>00143             }
<a name="l00144"></a>00144         }
<a name="l00145"></a>00145     }
<a name="l00146"></a>00146 
<a name="l00147"></a>00147     <a class="code" href="leptprotos_8h.html#a1b238e61b64e4e5c62f44849cddb9658">pixDestroy</a>(&amp;pixt);
<a name="l00148"></a>00148     <span class="keywordflow">return</span> fpixd;
<a name="l00149"></a>00149 }
<a name="l00150"></a>00150 
<a name="l00151"></a>00151 <span class="comment"></span>
<a name="l00152"></a>00152 <span class="comment">/*!</span>
<a name="l00153"></a>00153 <span class="comment"> *  fpixConvertToPix()</span>
<a name="l00154"></a>00154 <span class="comment"> *</span>
<a name="l00155"></a>00155 <span class="comment"> *      Input:  fpixs</span>
<a name="l00156"></a>00156 <span class="comment"> *              outdepth (0, 8, 16 or 32 bpp)</span>
<a name="l00157"></a>00157 <span class="comment"> *              negvals (L_CLIP_TO_ZERO, L_TAKE_ABSVAL)</span>
<a name="l00158"></a>00158 <span class="comment"> *              errorflag (1 to output error stats; 0 otherwise)</span>
<a name="l00159"></a>00159 <span class="comment"> *      Return: pixd, or null on error</span>
<a name="l00160"></a>00160 <span class="comment"> *</span>
<a name="l00161"></a>00161 <span class="comment"> *  Notes:</span>
<a name="l00162"></a>00162 <span class="comment"> *      (1) Use @outdepth = 0 to programmatically determine the</span>
<a name="l00163"></a>00163 <span class="comment"> *          output depth.  If no values are greater than 255,</span>
<a name="l00164"></a>00164 <span class="comment"> *          it will set outdepth = 8; otherwise to 16 or 32.</span>
<a name="l00165"></a>00165 <span class="comment"> *      (2) Because we are converting a float to an unsigned int</span>
<a name="l00166"></a>00166 <span class="comment"> *          with a specified dynamic range (8, 16 or 32 bits), errors</span>
<a name="l00167"></a>00167 <span class="comment"> *          can occur.  If errorflag == TRUE, output the number</span>
<a name="l00168"></a>00168 <span class="comment"> *          of values out of range, both negative and positive.</span>
<a name="l00169"></a>00169 <span class="comment"> *      (3) If a pixel value is positive and out of range, clip to</span>
<a name="l00170"></a>00170 <span class="comment"> *          the maximum value represented at the outdepth of 8, 16</span>
<a name="l00171"></a>00171 <span class="comment"> *          or 32 bits.</span>
<a name="l00172"></a>00172 <span class="comment"> */</span>
<a name="l00173"></a>00173 <a class="code" href="struct_pix.html">PIX</a> *
<a name="l00174"></a><a class="code" href="leptprotos_8h.html#a59c13c0bb797e9e90439b89e97fef31b">00174</a> <a class="code" href="fpix2_8c.html#a0f1317ed5b324405a57796af5188ebae">fpixConvertToPix</a>(<a class="code" href="struct_f_pix.html">FPIX</a>    *fpixs,
<a name="l00175"></a>00175                  <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  outdepth,
<a name="l00176"></a>00176                  <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  negvals,
<a name="l00177"></a>00177                  <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  errorflag)
<a name="l00178"></a>00178 {
<a name="l00179"></a>00179 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>     w, h, i, j, wpls, wpld, maxval;
<a name="l00180"></a>00180 <a class="code" href="environ_8h.html#a4d4d7254020fc95aef5dde8884405358">l_uint32</a>    vald;
<a name="l00181"></a>00181 <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>   val;
<a name="l00182"></a>00182 <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>  *datas, *lines;
<a name="l00183"></a>00183 <a class="code" href="environ_8h.html#a4d4d7254020fc95aef5dde8884405358">l_uint32</a>   *datad, *lined;
<a name="l00184"></a>00184 <a class="code" href="struct_pix.html">PIX</a>        *<a class="code" href="struct_l___dewarp.html#afd72a93afe35ce1fc281b64e625f72cf">pixd</a>;
<a name="l00185"></a>00185 
<a name="l00186"></a>00186     <a class="code" href="environ_8h.html#a1a16952819bcbc526c998e3ac86f2e78">PROCNAME</a>(<span class="stringliteral">&quot;fpixConvertToPix&quot;</span>);
<a name="l00187"></a>00187 
<a name="l00188"></a>00188     <span class="keywordflow">if</span> (!fpixs)
<a name="l00189"></a>00189         <span class="keywordflow">return</span> (<a class="code" href="struct_pix.html">PIX</a> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;fpixs not defined&quot;</span>, procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00190"></a>00190     <span class="keywordflow">if</span> (negvals != <a class="code" href="pix_8h.html#afa9be5679ab03d785820f2474c5ccc6ea66f0a5214704295a07d009fd289ec69f">L_CLIP_TO_ZERO</a> &amp;&amp; negvals != <a class="code" href="pix_8h.html#afa9be5679ab03d785820f2474c5ccc6ea9703a9e8d757bd96b21fdca2633a9c6d">L_TAKE_ABSVAL</a>)
<a name="l00191"></a>00191         <span class="keywordflow">return</span> (<a class="code" href="struct_pix.html">PIX</a> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;invalid negvals&quot;</span>, procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00192"></a>00192     <span class="keywordflow">if</span> (outdepth != 0 &amp;&amp; outdepth != 8 &amp;&amp; outdepth != 16 &amp;&amp; outdepth != 32)
<a name="l00193"></a>00193         <span class="keywordflow">return</span> (<a class="code" href="struct_pix.html">PIX</a> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;outdepth not in {0,8,16,32}&quot;</span>, procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00194"></a>00194 
<a name="l00195"></a>00195     <a class="code" href="fpix1_8c.html#a4f225dfa8c1e081c7d32b60acccc3638">fpixGetDimensions</a>(fpixs, &amp;w, &amp;h);
<a name="l00196"></a>00196     datas = <a class="code" href="fpix1_8c.html#af27ae584a0480d0f65258e8d8465846b">fpixGetData</a>(fpixs);
<a name="l00197"></a>00197     wpls = <a class="code" href="fpix1_8c.html#ab7f19e7fb19716b478b16f5f20c059c3">fpixGetWpl</a>(fpixs);
<a name="l00198"></a>00198 
<a name="l00199"></a>00199         <span class="comment">/* Adaptive determination of output depth */</span>
<a name="l00200"></a>00200     <span class="keywordflow">if</span> (outdepth == 0) {
<a name="l00201"></a>00201         outdepth = 8;
<a name="l00202"></a>00202         <span class="keywordflow">for</span> (i = 0; i &lt; h; i++) {
<a name="l00203"></a>00203             lines = datas + i * wpls;
<a name="l00204"></a>00204             <span class="keywordflow">for</span> (j = 0; j &lt; w; j++) {
<a name="l00205"></a>00205                 <span class="keywordflow">if</span> (lines[j] &gt; 65535.5) {
<a name="l00206"></a>00206                     outdepth = 32;
<a name="l00207"></a>00207                     <span class="keywordflow">break</span>;
<a name="l00208"></a>00208                 }
<a name="l00209"></a>00209                 <span class="keywordflow">if</span> (lines[j] &gt; 255.5)
<a name="l00210"></a>00210                     outdepth = 16;
<a name="l00211"></a>00211             }
<a name="l00212"></a>00212             <span class="keywordflow">if</span> (outdepth == 32) <span class="keywordflow">break</span>;
<a name="l00213"></a>00213         }
<a name="l00214"></a>00214     }
<a name="l00215"></a>00215     maxval = (1 &lt;&lt; outdepth) - 1;
<a name="l00216"></a>00216 
<a name="l00217"></a>00217         <span class="comment">/* Gather statistics if @errorflag = TRUE */</span>
<a name="l00218"></a>00218     <span class="keywordflow">if</span> (errorflag) {
<a name="l00219"></a>00219         <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  negs = 0;
<a name="l00220"></a>00220         <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  overvals = 0;
<a name="l00221"></a>00221         <span class="keywordflow">for</span> (i = 0; i &lt; h; i++) {
<a name="l00222"></a>00222             lines = datas + i * wpls;
<a name="l00223"></a>00223             <span class="keywordflow">for</span> (j = 0; j &lt; w; j++) {
<a name="l00224"></a>00224                 val = lines[j];
<a name="l00225"></a>00225                 <span class="keywordflow">if</span> (val &lt; 0.0)
<a name="l00226"></a>00226                     negs++;
<a name="l00227"></a>00227                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (val &gt; maxval)
<a name="l00228"></a>00228                     overvals++;
<a name="l00229"></a>00229             }
<a name="l00230"></a>00230         }
<a name="l00231"></a>00231         <span class="keywordflow">if</span> (negs &gt; 0)
<a name="l00232"></a>00232             <a class="code" href="environ_8h.html#a767a355e364ba0980565242f9f076533">L_ERROR_INT</a>(<span class="stringliteral">&quot;Number of negative values: %d&quot;</span>, procName, negs);
<a name="l00233"></a>00233         <span class="keywordflow">if</span> (overvals &gt; 0)
<a name="l00234"></a>00234             <a class="code" href="environ_8h.html#a767a355e364ba0980565242f9f076533">L_ERROR_INT</a>(<span class="stringliteral">&quot;Number of too-large values: %d&quot;</span>, procName, overvals);
<a name="l00235"></a>00235     }
<a name="l00236"></a>00236 
<a name="l00237"></a>00237         <span class="comment">/* Make the pix and convert the data */</span>
<a name="l00238"></a>00238     <span class="keywordflow">if</span> ((pixd = <a class="code" href="leptprotos_8h.html#a009df4671d39f94b50a0368af210aebe">pixCreate</a>(w, h, outdepth)) == <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00239"></a>00239         <span class="keywordflow">return</span> (<a class="code" href="struct_pix.html">PIX</a> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;pixd not made&quot;</span>, procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00240"></a>00240     datad = <a class="code" href="leptprotos_8h.html#a44546f758f2cf71bb109bfc114e3ca7f">pixGetData</a>(pixd);
<a name="l00241"></a>00241     wpld = <a class="code" href="leptprotos_8h.html#af0b490472ab7999f208098dd37167d73">pixGetWpl</a>(pixd);
<a name="l00242"></a>00242     <span class="keywordflow">for</span> (i = 0; i &lt; h; i++) {
<a name="l00243"></a>00243         lines = datas + i * wpls;
<a name="l00244"></a>00244         lined = datad + i * wpld;
<a name="l00245"></a>00245         <span class="keywordflow">for</span> (j = 0; j &lt; w; j++) {
<a name="l00246"></a>00246             val = lines[j];
<a name="l00247"></a>00247             <span class="keywordflow">if</span> (val &gt;= 0.0)
<a name="l00248"></a>00248                 vald = (<a class="code" href="environ_8h.html#a4d4d7254020fc95aef5dde8884405358">l_uint32</a>)(val + 0.5);
<a name="l00249"></a>00249             <span class="keywordflow">else</span> {  <span class="comment">/* val &lt; 0.0 */</span>
<a name="l00250"></a>00250                 <span class="keywordflow">if</span> (negvals == <a class="code" href="pix_8h.html#afa9be5679ab03d785820f2474c5ccc6ea66f0a5214704295a07d009fd289ec69f">L_CLIP_TO_ZERO</a>)
<a name="l00251"></a>00251                     vald = 0;
<a name="l00252"></a>00252                 <span class="keywordflow">else</span>
<a name="l00253"></a>00253                     vald = (<a class="code" href="environ_8h.html#a4d4d7254020fc95aef5dde8884405358">l_uint32</a>)(-val + 0.5);
<a name="l00254"></a>00254             }
<a name="l00255"></a>00255             <span class="keywordflow">if</span> (vald &gt; maxval)
<a name="l00256"></a>00256                 vald = maxval;
<a name="l00257"></a>00257             <span class="keywordflow">if</span> (outdepth == 8)
<a name="l00258"></a>00258                 <a class="code" href="arrayaccess_8h.html#ab5257b730a14910443765f70e6c3d428">SET_DATA_BYTE</a>(lined, j, vald);
<a name="l00259"></a>00259             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (outdepth == 16)
<a name="l00260"></a>00260                 <a class="code" href="arrayaccess_8h.html#a69c67ec12d46eee91e6d94ee8077f281">SET_DATA_TWO_BYTES</a>(lined, j, vald);
<a name="l00261"></a>00261             <span class="keywordflow">else</span>  <span class="comment">/* outdepth == 32 */</span>
<a name="l00262"></a>00262                 <a class="code" href="arrayaccess_8h.html#a6d3b9ae87799c127c3d43b636230f1ab">SET_DATA_FOUR_BYTES</a>(lined, j, vald);
<a name="l00263"></a>00263         }
<a name="l00264"></a>00264     }
<a name="l00265"></a>00265 
<a name="l00266"></a>00266     <span class="keywordflow">return</span> <a class="code" href="struct_l___dewarp.html#afd72a93afe35ce1fc281b64e625f72cf">pixd</a>;
<a name="l00267"></a>00267 }
<a name="l00268"></a>00268 
<a name="l00269"></a>00269 <span class="comment"></span>
<a name="l00270"></a>00270 <span class="comment">/*!</span>
<a name="l00271"></a>00271 <span class="comment"> *  fpixDisplayMaxDynamicRange()</span>
<a name="l00272"></a>00272 <span class="comment"> *</span>
<a name="l00273"></a>00273 <span class="comment"> *      Input:  fpixs</span>
<a name="l00274"></a>00274 <span class="comment"> *      Return: pixd (8 bpp), or null on error</span>
<a name="l00275"></a>00275 <span class="comment"> */</span>
<a name="l00276"></a>00276 <a class="code" href="struct_pix.html">PIX</a> *
<a name="l00277"></a><a class="code" href="leptprotos_8h.html#addac47b78aca8891fb27994af92bb3fd">00277</a> <a class="code" href="fpix2_8c.html#a4738237ca2fd3dd7e12d4ed52944da29">fpixDisplayMaxDynamicRange</a>(<a class="code" href="struct_f_pix.html">FPIX</a>  *fpixs)
<a name="l00278"></a>00278 {
<a name="l00279"></a>00279 <a class="code" href="environ_8h.html#a7ed60554e7d6dd89aca643189b1e70ad">l_uint8</a>     dval;
<a name="l00280"></a>00280 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>     i, j, w, h, wpls, wpld;
<a name="l00281"></a>00281 <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>   factor, sval, maxval;
<a name="l00282"></a>00282 <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>  *lines, *datas;
<a name="l00283"></a>00283 <a class="code" href="environ_8h.html#a4d4d7254020fc95aef5dde8884405358">l_uint32</a>   *lined, *datad;
<a name="l00284"></a>00284 <a class="code" href="struct_pix.html">PIX</a>        *<a class="code" href="struct_l___dewarp.html#afd72a93afe35ce1fc281b64e625f72cf">pixd</a>;
<a name="l00285"></a>00285 
<a name="l00286"></a>00286     <a class="code" href="environ_8h.html#a1a16952819bcbc526c998e3ac86f2e78">PROCNAME</a>(<span class="stringliteral">&quot;fpixDisplayMaxDynamicRange&quot;</span>);
<a name="l00287"></a>00287 
<a name="l00288"></a>00288     <span class="keywordflow">if</span> (!fpixs)
<a name="l00289"></a>00289         <span class="keywordflow">return</span> (<a class="code" href="struct_pix.html">PIX</a> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;fpixs not defined&quot;</span>, procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00290"></a>00290 
<a name="l00291"></a>00291     <a class="code" href="fpix1_8c.html#a4f225dfa8c1e081c7d32b60acccc3638">fpixGetDimensions</a>(fpixs, &amp;w, &amp;h);
<a name="l00292"></a>00292     datas = <a class="code" href="fpix1_8c.html#af27ae584a0480d0f65258e8d8465846b">fpixGetData</a>(fpixs);
<a name="l00293"></a>00293     wpls = <a class="code" href="fpix1_8c.html#ab7f19e7fb19716b478b16f5f20c059c3">fpixGetWpl</a>(fpixs);
<a name="l00294"></a>00294 
<a name="l00295"></a>00295     maxval = 0.0;
<a name="l00296"></a>00296     <span class="keywordflow">for</span> (i = 0; i &lt; h; i++) {
<a name="l00297"></a>00297         lines = datas + i * wpls;
<a name="l00298"></a>00298         <span class="keywordflow">for</span> (j = 0; j &lt; w; j++) {
<a name="l00299"></a>00299             sval = *(lines + j);
<a name="l00300"></a>00300             <span class="keywordflow">if</span> (sval &gt; maxval)
<a name="l00301"></a>00301                 maxval = sval;
<a name="l00302"></a>00302         }
<a name="l00303"></a>00303     }
<a name="l00304"></a>00304 
<a name="l00305"></a>00305     pixd = <a class="code" href="leptprotos_8h.html#a009df4671d39f94b50a0368af210aebe">pixCreate</a>(w, h, 8);
<a name="l00306"></a>00306     <span class="keywordflow">if</span> (maxval == 0.0)
<a name="l00307"></a>00307         <span class="keywordflow">return</span> <a class="code" href="struct_l___dewarp.html#afd72a93afe35ce1fc281b64e625f72cf">pixd</a>;  <span class="comment">/* all pixels are 0 */</span>
<a name="l00308"></a>00308 
<a name="l00309"></a>00309     datad = <a class="code" href="leptprotos_8h.html#a44546f758f2cf71bb109bfc114e3ca7f">pixGetData</a>(pixd);
<a name="l00310"></a>00310     wpld = <a class="code" href="leptprotos_8h.html#af0b490472ab7999f208098dd37167d73">pixGetWpl</a>(pixd);
<a name="l00311"></a>00311     factor = 255. / maxval;
<a name="l00312"></a>00312     <span class="keywordflow">for</span> (i = 0; i &lt; h; i++) {
<a name="l00313"></a>00313         lines = datas + i * wpls;
<a name="l00314"></a>00314         lined = datad + i * wpld;
<a name="l00315"></a>00315         <span class="keywordflow">for</span> (j = 0; j &lt; w; j++) {
<a name="l00316"></a>00316             sval = *(lines + j);
<a name="l00317"></a>00317             <span class="keywordflow">if</span> (sval &lt; 0.0) sval = 0.0;
<a name="l00318"></a>00318             dval = (<a class="code" href="environ_8h.html#a7ed60554e7d6dd89aca643189b1e70ad">l_uint8</a>)(factor * sval + 0.5);
<a name="l00319"></a>00319             <a class="code" href="arrayaccess_8h.html#ab5257b730a14910443765f70e6c3d428">SET_DATA_BYTE</a>(lined, j, dval);
<a name="l00320"></a>00320         }
<a name="l00321"></a>00321     }
<a name="l00322"></a>00322 
<a name="l00323"></a>00323     <span class="keywordflow">return</span> <a class="code" href="struct_l___dewarp.html#afd72a93afe35ce1fc281b64e625f72cf">pixd</a>;
<a name="l00324"></a>00324 }
<a name="l00325"></a>00325 
<a name="l00326"></a>00326 
<a name="l00327"></a>00327 <span class="comment">/*--------------------------------------------------------------------*</span>
<a name="l00328"></a>00328 <span class="comment"> *                     FPix  &lt;--&gt;  DPix conversions                   *</span>
<a name="l00329"></a>00329 <span class="comment"> *--------------------------------------------------------------------*/</span><span class="comment"></span>
<a name="l00330"></a>00330 <span class="comment">/*!</span>
<a name="l00331"></a>00331 <span class="comment"> *  fpixConvertToDPix()</span>
<a name="l00332"></a>00332 <span class="comment"> *</span>
<a name="l00333"></a>00333 <span class="comment"> *      Input:  fpix</span>
<a name="l00334"></a>00334 <span class="comment"> *      Return: dpix, or null on error</span>
<a name="l00335"></a>00335 <span class="comment"> */</span>
<a name="l00336"></a>00336 <a class="code" href="struct_d_pix.html">DPIX</a> *
<a name="l00337"></a><a class="code" href="leptprotos_8h.html#afe75c7bb8a58fb33a6e038981e690c79">00337</a> <a class="code" href="fpix2_8c.html#a7aa81813ca2b0e92bbd9d9e2a619fdba">fpixConvertToDPix</a>(<a class="code" href="struct_f_pix.html">FPIX</a>  *fpix)
<a name="l00338"></a>00338 {
<a name="l00339"></a>00339 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>     w, h, i, j, wpls, wpld;
<a name="l00340"></a>00340 <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>   val;
<a name="l00341"></a>00341 <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>  *datas, *lines;
<a name="l00342"></a>00342 <a class="code" href="environ_8h.html#ab8d28dcce3b441bb0bb47f124ee3c252">l_float64</a>  *datad, *lined;
<a name="l00343"></a>00343 <a class="code" href="struct_d_pix.html">DPIX</a>       *dpix;
<a name="l00344"></a>00344 
<a name="l00345"></a>00345     <a class="code" href="environ_8h.html#a1a16952819bcbc526c998e3ac86f2e78">PROCNAME</a>(<span class="stringliteral">&quot;fpixConvertToDPix&quot;</span>);
<a name="l00346"></a>00346 
<a name="l00347"></a>00347     <span class="keywordflow">if</span> (!fpix)
<a name="l00348"></a>00348         <span class="keywordflow">return</span> (<a class="code" href="struct_d_pix.html">DPIX</a> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;fpix not defined&quot;</span>, procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00349"></a>00349 
<a name="l00350"></a>00350     <a class="code" href="fpix1_8c.html#a4f225dfa8c1e081c7d32b60acccc3638">fpixGetDimensions</a>(fpix, &amp;w, &amp;h);
<a name="l00351"></a>00351     <span class="keywordflow">if</span> ((dpix = <a class="code" href="fpix1_8c.html#a3ed74abab861b6ad0250d0ee1866e723">dpixCreate</a>(w, h)) == <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00352"></a>00352         <span class="keywordflow">return</span> (<a class="code" href="struct_d_pix.html">DPIX</a> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;dpix not made&quot;</span>, procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00353"></a>00353 
<a name="l00354"></a>00354     datas = <a class="code" href="fpix1_8c.html#af27ae584a0480d0f65258e8d8465846b">fpixGetData</a>(fpix);
<a name="l00355"></a>00355     datad = <a class="code" href="fpix1_8c.html#a725e2c82ef6848ee180ffe4793ab78dd">dpixGetData</a>(dpix);
<a name="l00356"></a>00356     wpls = <a class="code" href="fpix1_8c.html#ab7f19e7fb19716b478b16f5f20c059c3">fpixGetWpl</a>(fpix);
<a name="l00357"></a>00357     wpld = <a class="code" href="fpix1_8c.html#a35139a80097545ccb082a1b920e45c17">dpixGetWpl</a>(dpix);  <span class="comment">/* 8 byte words */</span>
<a name="l00358"></a>00358     <span class="keywordflow">for</span> (i = 0; i &lt; h; i++) {
<a name="l00359"></a>00359         lines = datas + i * wpls;
<a name="l00360"></a>00360         lined = datad + i * wpld;
<a name="l00361"></a>00361         <span class="keywordflow">for</span> (j = 0; j &lt; w; j++) {
<a name="l00362"></a>00362             val = lines[j];
<a name="l00363"></a>00363             lined[j] = val;
<a name="l00364"></a>00364         }
<a name="l00365"></a>00365     }
<a name="l00366"></a>00366 
<a name="l00367"></a>00367     <span class="keywordflow">return</span> dpix;
<a name="l00368"></a>00368 }
<a name="l00369"></a>00369 
<a name="l00370"></a>00370 <span class="comment"></span>
<a name="l00371"></a>00371 <span class="comment">/*!</span>
<a name="l00372"></a>00372 <span class="comment"> *  dpixConvertToFPix()</span>
<a name="l00373"></a>00373 <span class="comment"> *</span>
<a name="l00374"></a>00374 <span class="comment"> *      Input:  dpix</span>
<a name="l00375"></a>00375 <span class="comment"> *      Return: fpix, or null on error</span>
<a name="l00376"></a>00376 <span class="comment"> */</span>
<a name="l00377"></a>00377 <a class="code" href="struct_f_pix.html">FPIX</a> *
<a name="l00378"></a><a class="code" href="leptprotos_8h.html#a33102bbd06ba1dcad89f624d83105a7d">00378</a> <a class="code" href="fpix2_8c.html#ae96b121541eee4eeb04dffd9dc76ffef">dpixConvertToFPix</a>(<a class="code" href="struct_d_pix.html">DPIX</a>  *dpix)
<a name="l00379"></a>00379 {
<a name="l00380"></a>00380 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>     w, h, i, j, wpls, wpld;
<a name="l00381"></a>00381 <a class="code" href="environ_8h.html#ab8d28dcce3b441bb0bb47f124ee3c252">l_float64</a>   val;
<a name="l00382"></a>00382 <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>  *datad, *lined;
<a name="l00383"></a>00383 <a class="code" href="environ_8h.html#ab8d28dcce3b441bb0bb47f124ee3c252">l_float64</a>  *datas, *lines;
<a name="l00384"></a>00384 <a class="code" href="struct_f_pix.html">FPIX</a>       *fpix;
<a name="l00385"></a>00385 
<a name="l00386"></a>00386     <a class="code" href="environ_8h.html#a1a16952819bcbc526c998e3ac86f2e78">PROCNAME</a>(<span class="stringliteral">&quot;dpixConvertToFPix&quot;</span>);
<a name="l00387"></a>00387 
<a name="l00388"></a>00388     <span class="keywordflow">if</span> (!dpix)
<a name="l00389"></a>00389         <span class="keywordflow">return</span> (<a class="code" href="struct_f_pix.html">FPIX</a> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;dpix not defined&quot;</span>, procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00390"></a>00390 
<a name="l00391"></a>00391     <a class="code" href="fpix1_8c.html#a92b07ec1ebb7df0a4fe6379de2270cd1">dpixGetDimensions</a>(dpix, &amp;w, &amp;h);
<a name="l00392"></a>00392     <span class="keywordflow">if</span> ((fpix = <a class="code" href="fpix1_8c.html#adbbb61d64f5c6262dca09633b1693f4d">fpixCreate</a>(w, h)) == <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00393"></a>00393         <span class="keywordflow">return</span> (<a class="code" href="struct_f_pix.html">FPIX</a> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;fpix not made&quot;</span>, procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00394"></a>00394 
<a name="l00395"></a>00395     datas = <a class="code" href="fpix1_8c.html#a725e2c82ef6848ee180ffe4793ab78dd">dpixGetData</a>(dpix);
<a name="l00396"></a>00396     datad = <a class="code" href="fpix1_8c.html#af27ae584a0480d0f65258e8d8465846b">fpixGetData</a>(fpix);
<a name="l00397"></a>00397     wpls = <a class="code" href="fpix1_8c.html#a35139a80097545ccb082a1b920e45c17">dpixGetWpl</a>(dpix);  <span class="comment">/* 8 byte words */</span>
<a name="l00398"></a>00398     wpld = <a class="code" href="fpix1_8c.html#ab7f19e7fb19716b478b16f5f20c059c3">fpixGetWpl</a>(fpix);
<a name="l00399"></a>00399     <span class="keywordflow">for</span> (i = 0; i &lt; h; i++) {
<a name="l00400"></a>00400         lines = datas + i * wpls;
<a name="l00401"></a>00401         lined = datad + i * wpld;
<a name="l00402"></a>00402         <span class="keywordflow">for</span> (j = 0; j &lt; w; j++) {
<a name="l00403"></a>00403             val = lines[j];
<a name="l00404"></a>00404             lined[j] = (<a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>)val;
<a name="l00405"></a>00405         }
<a name="l00406"></a>00406     }
<a name="l00407"></a>00407 
<a name="l00408"></a>00408     <span class="keywordflow">return</span> fpix;
<a name="l00409"></a>00409 }
<a name="l00410"></a>00410 
<a name="l00411"></a>00411 
<a name="l00412"></a>00412 
<a name="l00413"></a>00413 <span class="comment">/*--------------------------------------------------------------------*</span>
<a name="l00414"></a>00414 <span class="comment"> *                           Min/max value                            *</span>
<a name="l00415"></a>00415 <span class="comment"> *--------------------------------------------------------------------*/</span><span class="comment"></span>
<a name="l00416"></a>00416 <span class="comment">/*!</span>
<a name="l00417"></a>00417 <span class="comment"> *  fpixGetMin()</span>
<a name="l00418"></a>00418 <span class="comment"> *</span>
<a name="l00419"></a>00419 <span class="comment"> *      Input:  fpix</span>
<a name="l00420"></a>00420 <span class="comment"> *              &amp;minval (&lt;optional return&gt; min value)</span>
<a name="l00421"></a>00421 <span class="comment"> *              &amp;xminloc (&lt;optional return&gt; x location of min)</span>
<a name="l00422"></a>00422 <span class="comment"> *              &amp;yminloc (&lt;optional return&gt; y location of min)</span>
<a name="l00423"></a>00423 <span class="comment"> *      Return: 0 if OK; 1 on error</span>
<a name="l00424"></a>00424 <span class="comment"> */</span>
<a name="l00425"></a>00425 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>
<a name="l00426"></a><a class="code" href="leptprotos_8h.html#a7c3e67e4c4b197d55f3746a31ba196cd">00426</a> <a class="code" href="fpix2_8c.html#a6fad1c0a6507ccff9fd2a81e0e8ff3e0">fpixGetMin</a>(<a class="code" href="struct_f_pix.html">FPIX</a>       *fpix,
<a name="l00427"></a>00427            <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>  *pminval,
<a name="l00428"></a>00428            <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>    *pxminloc,
<a name="l00429"></a>00429            <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>    *pyminloc)
<a name="l00430"></a>00430 {
<a name="l00431"></a>00431 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>     i, j, w, h, wpl, xminloc, yminloc;
<a name="l00432"></a>00432 <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>  *data, *line;
<a name="l00433"></a>00433 <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>   minval;
<a name="l00434"></a>00434 
<a name="l00435"></a>00435     <a class="code" href="environ_8h.html#a1a16952819bcbc526c998e3ac86f2e78">PROCNAME</a>(<span class="stringliteral">&quot;fpixGetMin&quot;</span>);
<a name="l00436"></a>00436 
<a name="l00437"></a>00437     <span class="keywordflow">if</span> (!pminval &amp;&amp; !pxminloc &amp;&amp; !pyminloc)
<a name="l00438"></a>00438         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;nothing to do&quot;</span>, procName, 1);
<a name="l00439"></a>00439     <span class="keywordflow">if</span> (pminval) *pminval = 0.0;
<a name="l00440"></a>00440     <span class="keywordflow">if</span> (pxminloc) *pxminloc = 0;
<a name="l00441"></a>00441     <span class="keywordflow">if</span> (pyminloc) *pyminloc = 0;
<a name="l00442"></a>00442     <span class="keywordflow">if</span> (!fpix)
<a name="l00443"></a>00443         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;fpix not defined&quot;</span>, procName, 1);
<a name="l00444"></a>00444 
<a name="l00445"></a>00445     minval = +1.0e20;
<a name="l00446"></a>00446     xminloc = 0;
<a name="l00447"></a>00447     yminloc = 0;
<a name="l00448"></a>00448     <a class="code" href="fpix1_8c.html#a4f225dfa8c1e081c7d32b60acccc3638">fpixGetDimensions</a>(fpix, &amp;w, &amp;h);
<a name="l00449"></a>00449     data = <a class="code" href="fpix1_8c.html#af27ae584a0480d0f65258e8d8465846b">fpixGetData</a>(fpix);
<a name="l00450"></a>00450     wpl = <a class="code" href="fpix1_8c.html#ab7f19e7fb19716b478b16f5f20c059c3">fpixGetWpl</a>(fpix);
<a name="l00451"></a>00451     <span class="keywordflow">for</span> (i = 0; i &lt; h; i++) {
<a name="l00452"></a>00452         line = data + i * wpl;
<a name="l00453"></a>00453         <span class="keywordflow">for</span> (j = 0; j &lt; w; j++) {
<a name="l00454"></a>00454             <span class="keywordflow">if</span> (line[j] &lt; minval) {
<a name="l00455"></a>00455                 minval = line[j];
<a name="l00456"></a>00456                 xminloc = j;
<a name="l00457"></a>00457                 yminloc = i;
<a name="l00458"></a>00458             }
<a name="l00459"></a>00459         }
<a name="l00460"></a>00460     }
<a name="l00461"></a>00461 
<a name="l00462"></a>00462     <span class="keywordflow">if</span> (pminval) *pminval = minval;
<a name="l00463"></a>00463     <span class="keywordflow">if</span> (pxminloc) *pxminloc = xminloc;
<a name="l00464"></a>00464     <span class="keywordflow">if</span> (pyminloc) *pyminloc = yminloc;
<a name="l00465"></a>00465     <span class="keywordflow">return</span> 0;
<a name="l00466"></a>00466 }
<a name="l00467"></a>00467 
<a name="l00468"></a>00468 <span class="comment"></span>
<a name="l00469"></a>00469 <span class="comment">/*!</span>
<a name="l00470"></a>00470 <span class="comment"> *  fpixGetMax()</span>
<a name="l00471"></a>00471 <span class="comment"> *</span>
<a name="l00472"></a>00472 <span class="comment"> *      Input:  fpix</span>
<a name="l00473"></a>00473 <span class="comment"> *              &amp;maxval (&lt;optional return&gt; max value)</span>
<a name="l00474"></a>00474 <span class="comment"> *              &amp;xmaxloc (&lt;optional return&gt; x location of max)</span>
<a name="l00475"></a>00475 <span class="comment"> *              &amp;ymaxloc (&lt;optional return&gt; y location of max)</span>
<a name="l00476"></a>00476 <span class="comment"> *      Return: 0 if OK; 1 on error</span>
<a name="l00477"></a>00477 <span class="comment"> */</span>
<a name="l00478"></a>00478 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>
<a name="l00479"></a><a class="code" href="leptprotos_8h.html#a414fd4cd7a171accb157b411da70db78">00479</a> <a class="code" href="fpix2_8c.html#aace24bc09af76007fb35751b371b3648">fpixGetMax</a>(<a class="code" href="struct_f_pix.html">FPIX</a>       *fpix,
<a name="l00480"></a>00480            <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>  *pmaxval,
<a name="l00481"></a>00481            <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>    *pxmaxloc,
<a name="l00482"></a>00482            <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>    *pymaxloc)
<a name="l00483"></a>00483 {
<a name="l00484"></a>00484 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>     i, j, w, h, wpl, xmaxloc, ymaxloc;
<a name="l00485"></a>00485 <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>  *data, *line;
<a name="l00486"></a>00486 <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>   maxval;
<a name="l00487"></a>00487 
<a name="l00488"></a>00488     <a class="code" href="environ_8h.html#a1a16952819bcbc526c998e3ac86f2e78">PROCNAME</a>(<span class="stringliteral">&quot;fpixGetMax&quot;</span>);
<a name="l00489"></a>00489 
<a name="l00490"></a>00490     <span class="keywordflow">if</span> (!pmaxval &amp;&amp; !pxmaxloc &amp;&amp; !pymaxloc)
<a name="l00491"></a>00491         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;nothing to do&quot;</span>, procName, 1);
<a name="l00492"></a>00492     <span class="keywordflow">if</span> (pmaxval) *pmaxval = 0.0;
<a name="l00493"></a>00493     <span class="keywordflow">if</span> (pxmaxloc) *pxmaxloc = 0;
<a name="l00494"></a>00494     <span class="keywordflow">if</span> (pymaxloc) *pymaxloc = 0;
<a name="l00495"></a>00495     <span class="keywordflow">if</span> (!fpix)
<a name="l00496"></a>00496         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;fpix not defined&quot;</span>, procName, 1);
<a name="l00497"></a>00497 
<a name="l00498"></a>00498     maxval = -1.0e20;
<a name="l00499"></a>00499     xmaxloc = 0;
<a name="l00500"></a>00500     ymaxloc = 0;
<a name="l00501"></a>00501     <a class="code" href="fpix1_8c.html#a4f225dfa8c1e081c7d32b60acccc3638">fpixGetDimensions</a>(fpix, &amp;w, &amp;h);
<a name="l00502"></a>00502     data = <a class="code" href="fpix1_8c.html#af27ae584a0480d0f65258e8d8465846b">fpixGetData</a>(fpix);
<a name="l00503"></a>00503     wpl = <a class="code" href="fpix1_8c.html#ab7f19e7fb19716b478b16f5f20c059c3">fpixGetWpl</a>(fpix);
<a name="l00504"></a>00504     <span class="keywordflow">for</span> (i = 0; i &lt; h; i++) {
<a name="l00505"></a>00505         line = data + i * wpl;
<a name="l00506"></a>00506         <span class="keywordflow">for</span> (j = 0; j &lt; w; j++) {
<a name="l00507"></a>00507             <span class="keywordflow">if</span> (line[j] &lt; maxval) {
<a name="l00508"></a>00508                 maxval = line[j];
<a name="l00509"></a>00509                 xmaxloc = j;
<a name="l00510"></a>00510                 ymaxloc = i;
<a name="l00511"></a>00511             }
<a name="l00512"></a>00512         }
<a name="l00513"></a>00513     }
<a name="l00514"></a>00514 
<a name="l00515"></a>00515     <span class="keywordflow">if</span> (pmaxval) *pmaxval = maxval;
<a name="l00516"></a>00516     <span class="keywordflow">if</span> (pxmaxloc) *pxmaxloc = xmaxloc;
<a name="l00517"></a>00517     <span class="keywordflow">if</span> (pymaxloc) *pymaxloc = ymaxloc;
<a name="l00518"></a>00518     <span class="keywordflow">return</span> 0;
<a name="l00519"></a>00519 }
<a name="l00520"></a>00520 
<a name="l00521"></a>00521 
<a name="l00522"></a>00522 <span class="comment">/*--------------------------------------------------------------------*</span>
<a name="l00523"></a>00523 <span class="comment"> *                          Border functions                          *</span>
<a name="l00524"></a>00524 <span class="comment"> *--------------------------------------------------------------------*/</span><span class="comment"></span>
<a name="l00525"></a>00525 <span class="comment">/*!</span>
<a name="l00526"></a>00526 <span class="comment"> *  fpixAddBorder()</span>
<a name="l00527"></a>00527 <span class="comment"> *</span>
<a name="l00528"></a>00528 <span class="comment"> *      Input:  fpixs</span>
<a name="l00529"></a>00529 <span class="comment"> *              left, right, top, bot (pixels on each side to be added)</span>
<a name="l00530"></a>00530 <span class="comment"> *      Return: fpixd, or null on error</span>
<a name="l00531"></a>00531 <span class="comment"> *</span>
<a name="l00532"></a>00532 <span class="comment"> *  Notes:</span>
<a name="l00533"></a>00533 <span class="comment"> *      (1) Adds border of &#39;0&#39; 32-bit pixels</span>
<a name="l00534"></a>00534 <span class="comment"> */</span>
<a name="l00535"></a>00535 <a class="code" href="struct_f_pix.html">FPIX</a> *
<a name="l00536"></a><a class="code" href="leptprotos_8h.html#a2ebb24bc89b4a7570cc648a41d49cdba">00536</a> <a class="code" href="fpix2_8c.html#aa23a8e36d6bbc0d2748089b83f6cad9d">fpixAddBorder</a>(<a class="code" href="struct_f_pix.html">FPIX</a>    *fpixs,
<a name="l00537"></a>00537               <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  left,
<a name="l00538"></a>00538               <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  right,
<a name="l00539"></a>00539               <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  top,
<a name="l00540"></a>00540               <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  bot)
<a name="l00541"></a>00541 {
<a name="l00542"></a>00542 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  ws, hs, wd, hd;
<a name="l00543"></a>00543 <a class="code" href="struct_f_pix.html">FPIX</a>    *fpixd;
<a name="l00544"></a>00544 
<a name="l00545"></a>00545     <a class="code" href="environ_8h.html#a1a16952819bcbc526c998e3ac86f2e78">PROCNAME</a>(<span class="stringliteral">&quot;fpixAddBorder&quot;</span>);
<a name="l00546"></a>00546 
<a name="l00547"></a>00547     <span class="keywordflow">if</span> (!fpixs)
<a name="l00548"></a>00548         <span class="keywordflow">return</span> (<a class="code" href="struct_f_pix.html">FPIX</a> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;fpixs not defined&quot;</span>, procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00549"></a>00549 
<a name="l00550"></a>00550     <span class="keywordflow">if</span> (left &lt;= 0 &amp;&amp; right &lt;= 0 &amp;&amp; top &lt;= 0 &amp;&amp; bot &lt;= 0)
<a name="l00551"></a>00551         <span class="keywordflow">return</span> <a class="code" href="fpix1_8c.html#a56336c678733d924db5a4a2eaf137e6f">fpixCopy</a>(<a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, fpixs);
<a name="l00552"></a>00552     <a class="code" href="fpix1_8c.html#a4f225dfa8c1e081c7d32b60acccc3638">fpixGetDimensions</a>(fpixs, &amp;ws, &amp;hs);
<a name="l00553"></a>00553     wd = ws + left + right;
<a name="l00554"></a>00554     hd = hs + top + bot;
<a name="l00555"></a>00555     <span class="keywordflow">if</span> ((fpixd = <a class="code" href="fpix1_8c.html#adbbb61d64f5c6262dca09633b1693f4d">fpixCreate</a>(wd, hd)) == <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00556"></a>00556         <span class="keywordflow">return</span> (<a class="code" href="struct_f_pix.html">FPIX</a> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;fpixd not made&quot;</span>, procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00557"></a>00557 
<a name="l00558"></a>00558     <a class="code" href="fpix1_8c.html#ad94cba9b348260a215cad0885ec126a8">fpixCopyResolution</a>(fpixd, fpixs);
<a name="l00559"></a>00559     <a class="code" href="fpix2_8c.html#a67a0b4218b30a7e0e84a07138ff043c3">fpixRasterop</a>(fpixd, left, top, ws, hs, fpixs, 0, 0);
<a name="l00560"></a>00560     <span class="keywordflow">return</span> fpixd;
<a name="l00561"></a>00561 }
<a name="l00562"></a>00562 
<a name="l00563"></a>00563 <span class="comment"></span>
<a name="l00564"></a>00564 <span class="comment">/*!</span>
<a name="l00565"></a>00565 <span class="comment"> *  fpixRemoveBorder()</span>
<a name="l00566"></a>00566 <span class="comment"> *</span>
<a name="l00567"></a>00567 <span class="comment"> *      Input:  fpixs</span>
<a name="l00568"></a>00568 <span class="comment"> *              left, right, top, bot (pixels on each side to be removed)</span>
<a name="l00569"></a>00569 <span class="comment"> *      Return: fpixd, or null on error</span>
<a name="l00570"></a>00570 <span class="comment"> */</span>
<a name="l00571"></a>00571 <a class="code" href="struct_f_pix.html">FPIX</a> *
<a name="l00572"></a><a class="code" href="leptprotos_8h.html#a3e449f54f649e74bc42f89ad65b7dbcf">00572</a> <a class="code" href="fpix2_8c.html#a6b624e428a85aea0f62a41cb01a8e1b2">fpixRemoveBorder</a>(<a class="code" href="struct_f_pix.html">FPIX</a>    *fpixs,
<a name="l00573"></a>00573                  <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  left,
<a name="l00574"></a>00574                  <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  right,
<a name="l00575"></a>00575                  <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  top,
<a name="l00576"></a>00576                  <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  bot)
<a name="l00577"></a>00577 {
<a name="l00578"></a>00578 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  ws, hs, wd, hd;
<a name="l00579"></a>00579 <a class="code" href="struct_f_pix.html">FPIX</a>    *fpixd;
<a name="l00580"></a>00580 
<a name="l00581"></a>00581     <a class="code" href="environ_8h.html#a1a16952819bcbc526c998e3ac86f2e78">PROCNAME</a>(<span class="stringliteral">&quot;fpixRemoveBorder&quot;</span>);
<a name="l00582"></a>00582 
<a name="l00583"></a>00583     <span class="keywordflow">if</span> (!fpixs)
<a name="l00584"></a>00584         <span class="keywordflow">return</span> (<a class="code" href="struct_f_pix.html">FPIX</a> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;fpixs not defined&quot;</span>, procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00585"></a>00585 
<a name="l00586"></a>00586     <span class="keywordflow">if</span> (left &lt;= 0 &amp;&amp; right &lt;= 0 &amp;&amp; top &lt;= 0 &amp;&amp; bot &lt;= 0)
<a name="l00587"></a>00587         <span class="keywordflow">return</span> <a class="code" href="fpix1_8c.html#a56336c678733d924db5a4a2eaf137e6f">fpixCopy</a>(<a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, fpixs);
<a name="l00588"></a>00588     <a class="code" href="fpix1_8c.html#a4f225dfa8c1e081c7d32b60acccc3638">fpixGetDimensions</a>(fpixs, &amp;ws, &amp;hs);
<a name="l00589"></a>00589     wd = ws - left - right;
<a name="l00590"></a>00590     hd = hs - top - bot;
<a name="l00591"></a>00591     <span class="keywordflow">if</span> (wd &lt;= 0 || hd &lt;= 0)
<a name="l00592"></a>00592         <span class="keywordflow">return</span> (<a class="code" href="struct_f_pix.html">FPIX</a> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;width &amp; height not both &gt; 0&quot;</span>, procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00593"></a>00593     <span class="keywordflow">if</span> ((fpixd = <a class="code" href="fpix1_8c.html#adbbb61d64f5c6262dca09633b1693f4d">fpixCreate</a>(wd, hd)) == <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00594"></a>00594         <span class="keywordflow">return</span> (<a class="code" href="struct_f_pix.html">FPIX</a> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;fpixd not made&quot;</span>, procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00595"></a>00595 
<a name="l00596"></a>00596     <a class="code" href="fpix1_8c.html#ad94cba9b348260a215cad0885ec126a8">fpixCopyResolution</a>(fpixd, fpixs);
<a name="l00597"></a>00597     <a class="code" href="fpix2_8c.html#a67a0b4218b30a7e0e84a07138ff043c3">fpixRasterop</a>(fpixd, 0, 0, wd, hd, fpixs, left, top);
<a name="l00598"></a>00598     <span class="keywordflow">return</span> fpixd;
<a name="l00599"></a>00599 }
<a name="l00600"></a>00600 
<a name="l00601"></a>00601 
<a name="l00602"></a>00602 <span class="comment"></span>
<a name="l00603"></a>00603 <span class="comment">/*!</span>
<a name="l00604"></a>00604 <span class="comment"> *  fpixAddMirroredBorder()</span>
<a name="l00605"></a>00605 <span class="comment"> *</span>
<a name="l00606"></a>00606 <span class="comment"> *      Input:  fpixs</span>
<a name="l00607"></a>00607 <span class="comment"> *              left, right, top, bot (pixels on each side to be added)</span>
<a name="l00608"></a>00608 <span class="comment"> *      Return: fpixd, or null on error</span>
<a name="l00609"></a>00609 <span class="comment"> *</span>
<a name="l00610"></a>00610 <span class="comment"> *  Notes:</span>
<a name="l00611"></a>00611 <span class="comment"> *      (1) See pixAddMirroredBorder() for situations of usage.</span>
<a name="l00612"></a>00612 <span class="comment"> */</span>
<a name="l00613"></a>00613 <a class="code" href="struct_f_pix.html">FPIX</a> *
<a name="l00614"></a><a class="code" href="leptprotos_8h.html#aa040c4b39dfb839b3adf3c7d91e9ab8e">00614</a> <a class="code" href="fpix2_8c.html#a0b97251b9ce237cd10ff45a02dd8ff92">fpixAddMirroredBorder</a>(<a class="code" href="struct_f_pix.html">FPIX</a>    *fpixs,
<a name="l00615"></a>00615                       <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  left,
<a name="l00616"></a>00616                       <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  right,
<a name="l00617"></a>00617                       <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  top,
<a name="l00618"></a>00618                       <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  bot)
<a name="l00619"></a>00619 {
<a name="l00620"></a>00620 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  i, j, w, h;
<a name="l00621"></a>00621 <a class="code" href="struct_f_pix.html">FPIX</a>    *fpixd;
<a name="l00622"></a>00622 
<a name="l00623"></a>00623     <a class="code" href="environ_8h.html#a1a16952819bcbc526c998e3ac86f2e78">PROCNAME</a>(<span class="stringliteral">&quot;fpixAddMirroredBorder&quot;</span>);
<a name="l00624"></a>00624 
<a name="l00625"></a>00625     <span class="keywordflow">if</span> (!fpixs)
<a name="l00626"></a>00626         <span class="keywordflow">return</span> (<a class="code" href="struct_f_pix.html">FPIX</a> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;fpixs not defined&quot;</span>, procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00627"></a>00627 
<a name="l00628"></a>00628     fpixd = <a class="code" href="fpix2_8c.html#aa23a8e36d6bbc0d2748089b83f6cad9d">fpixAddBorder</a>(fpixs, left, right, top, bot);
<a name="l00629"></a>00629     <a class="code" href="fpix1_8c.html#a4f225dfa8c1e081c7d32b60acccc3638">fpixGetDimensions</a>(fpixs, &amp;w, &amp;h);
<a name="l00630"></a>00630     <span class="keywordflow">for</span> (j = 0; j &lt; left; j++)
<a name="l00631"></a>00631         <a class="code" href="fpix2_8c.html#a67a0b4218b30a7e0e84a07138ff043c3">fpixRasterop</a>(fpixd, left - 1 - j, top, 1, h,
<a name="l00632"></a>00632                      fpixd, left + j, top);
<a name="l00633"></a>00633     <span class="keywordflow">for</span> (j = 0; j &lt; right; j++)
<a name="l00634"></a>00634         <a class="code" href="fpix2_8c.html#a67a0b4218b30a7e0e84a07138ff043c3">fpixRasterop</a>(fpixd, left + w + j, top, 1, h,
<a name="l00635"></a>00635                      fpixd, left + w - 1 - j, top);
<a name="l00636"></a>00636     <span class="keywordflow">for</span> (i = 0; i &lt; top; i++)
<a name="l00637"></a>00637         <a class="code" href="fpix2_8c.html#a67a0b4218b30a7e0e84a07138ff043c3">fpixRasterop</a>(fpixd, 0, top - 1 - i, left + w + right, 1,
<a name="l00638"></a>00638                      fpixd, 0, top + i);
<a name="l00639"></a>00639     <span class="keywordflow">for</span> (i = 0; i &lt; bot; i++)
<a name="l00640"></a>00640         <a class="code" href="fpix2_8c.html#a67a0b4218b30a7e0e84a07138ff043c3">fpixRasterop</a>(fpixd, 0, top + h + i, left + w + right, 1,
<a name="l00641"></a>00641                      fpixd, 0, top + h - 1 - i);
<a name="l00642"></a>00642 
<a name="l00643"></a>00643     <span class="keywordflow">return</span> fpixd;
<a name="l00644"></a>00644 }
<a name="l00645"></a>00645 
<a name="l00646"></a>00646 
<a name="l00647"></a>00647 <span class="comment">/*--------------------------------------------------------------------*</span>
<a name="l00648"></a>00648 <span class="comment"> *                          Simple rasterop                           *</span>
<a name="l00649"></a>00649 <span class="comment"> *--------------------------------------------------------------------*/</span><span class="comment"></span>
<a name="l00650"></a>00650 <span class="comment">/*!</span>
<a name="l00651"></a>00651 <span class="comment"> *  fpixRasterop()</span>
<a name="l00652"></a>00652 <span class="comment"> *</span>
<a name="l00653"></a>00653 <span class="comment"> *      Input:  fpixd  (dest fpix)</span>
<a name="l00654"></a>00654 <span class="comment"> *              dx     (x val of UL corner of dest rectangle)</span>
<a name="l00655"></a>00655 <span class="comment"> *              dy     (y val of UL corner of dest rectangle)</span>
<a name="l00656"></a>00656 <span class="comment"> *              dw     (width of dest rectangle)</span>
<a name="l00657"></a>00657 <span class="comment"> *              dh     (height of dest rectangle)</span>
<a name="l00658"></a>00658 <span class="comment"> *              fpixs  (src fpix)</span>
<a name="l00659"></a>00659 <span class="comment"> *              sx     (x val of UL corner of src rectangle)</span>
<a name="l00660"></a>00660 <span class="comment"> *              sy     (y val of UL corner of src rectangle)</span>
<a name="l00661"></a>00661 <span class="comment"> *      Return: 0 if OK; 1 on error.</span>
<a name="l00662"></a>00662 <span class="comment"> *</span>
<a name="l00663"></a>00663 <span class="comment"> *  Notes:</span>
<a name="l00664"></a>00664 <span class="comment"> *      (1) This is similiar in structure to pixRasterop(), except</span>
<a name="l00665"></a>00665 <span class="comment"> *          it only allows copying from the source into the destination.</span>
<a name="l00666"></a>00666 <span class="comment"> *          For that reason, no op code is necessary.  Additionally,</span>
<a name="l00667"></a>00667 <span class="comment"> *          all pixels are 32 bit words (float values), which makes</span>
<a name="l00668"></a>00668 <span class="comment"> *          the copy very simple.</span>
<a name="l00669"></a>00669 <span class="comment"> *      (2) Clipping of both src and dest fpix are done automatically.</span>
<a name="l00670"></a>00670 <span class="comment"> *      (3) This allows in-place copying, without checking to see if</span>
<a name="l00671"></a>00671 <span class="comment"> *          the result is valid:  use for in-place with caution!</span>
<a name="l00672"></a>00672 <span class="comment"> */</span>
<a name="l00673"></a>00673 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>
<a name="l00674"></a><a class="code" href="leptprotos_8h.html#a18bbd9dd86f3a266f4389bd6e8d9f0be">00674</a> <a class="code" href="fpix2_8c.html#a67a0b4218b30a7e0e84a07138ff043c3">fpixRasterop</a>(<a class="code" href="struct_f_pix.html">FPIX</a>    *fpixd,
<a name="l00675"></a>00675              <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  dx,
<a name="l00676"></a>00676              <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  dy,
<a name="l00677"></a>00677              <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  dw,
<a name="l00678"></a>00678              <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  dh,
<a name="l00679"></a>00679              <a class="code" href="struct_f_pix.html">FPIX</a>    *fpixs,
<a name="l00680"></a>00680              <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  sx,
<a name="l00681"></a>00681              <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  sy)
<a name="l00682"></a>00682 {
<a name="l00683"></a>00683 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>     fsw, fsh, fdw, fdh, dhangw, shangw, dhangh, shangh;
<a name="l00684"></a>00684 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>     i, j, wpls, wpld;
<a name="l00685"></a>00685 <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>  *datas, *datad, *lines, *lined;
<a name="l00686"></a>00686 
<a name="l00687"></a>00687     <a class="code" href="environ_8h.html#a1a16952819bcbc526c998e3ac86f2e78">PROCNAME</a>(<span class="stringliteral">&quot;fpixRasterop&quot;</span>);
<a name="l00688"></a>00688 
<a name="l00689"></a>00689     <span class="keywordflow">if</span> (!fpixs)
<a name="l00690"></a>00690         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;fpixs not defined&quot;</span>, procName, 1);
<a name="l00691"></a>00691     <span class="keywordflow">if</span> (!fpixd)
<a name="l00692"></a>00692         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;fpixd not defined&quot;</span>, procName, 1);
<a name="l00693"></a>00693 
<a name="l00694"></a>00694     <span class="comment">/* -------------------------------------------------------- *</span>
<a name="l00695"></a>00695 <span class="comment">     *      Clip to maximum rectangle with both src and dest    *</span>
<a name="l00696"></a>00696 <span class="comment">     * -------------------------------------------------------- */</span>
<a name="l00697"></a>00697     <a class="code" href="fpix1_8c.html#a4f225dfa8c1e081c7d32b60acccc3638">fpixGetDimensions</a>(fpixs, &amp;fsw, &amp;fsh);
<a name="l00698"></a>00698     <a class="code" href="fpix1_8c.html#a4f225dfa8c1e081c7d32b60acccc3638">fpixGetDimensions</a>(fpixd, &amp;fdw, &amp;fdh);
<a name="l00699"></a>00699 
<a name="l00700"></a>00700         <span class="comment">/* First clip horizontally (sx, dx, dw) */</span>
<a name="l00701"></a>00701     <span class="keywordflow">if</span> (dx &lt; 0) {
<a name="l00702"></a>00702         sx -= dx;  <span class="comment">/* increase sx */</span>
<a name="l00703"></a>00703         dw += dx;  <span class="comment">/* reduce dw */</span>
<a name="l00704"></a>00704         dx = 0;
<a name="l00705"></a>00705     }
<a name="l00706"></a>00706     <span class="keywordflow">if</span> (sx &lt; 0) {
<a name="l00707"></a>00707         dx -= sx;  <span class="comment">/* increase dx */</span>
<a name="l00708"></a>00708         dw += sx;  <span class="comment">/* reduce dw */</span>
<a name="l00709"></a>00709         sx = 0;
<a name="l00710"></a>00710     }
<a name="l00711"></a>00711     dhangw = dx + dw - fdw;  <span class="comment">/* rect overhang of dest to right */</span>
<a name="l00712"></a>00712     <span class="keywordflow">if</span> (dhangw &gt; 0)
<a name="l00713"></a>00713         dw -= dhangw;  <span class="comment">/* reduce dw */</span>
<a name="l00714"></a>00714     shangw = sx + dw - fsw;   <span class="comment">/* rect overhang of src to right */</span>
<a name="l00715"></a>00715     <span class="keywordflow">if</span> (shangw &gt; 0)
<a name="l00716"></a>00716         dw -= shangw;  <span class="comment">/* reduce dw */</span>
<a name="l00717"></a>00717 
<a name="l00718"></a>00718         <span class="comment">/* Then clip vertically (sy, dy, dh) */</span>
<a name="l00719"></a>00719     <span class="keywordflow">if</span> (dy &lt; 0) {
<a name="l00720"></a>00720         sy -= dy;  <span class="comment">/* increase sy */</span>
<a name="l00721"></a>00721         dh += dy;  <span class="comment">/* reduce dh */</span>
<a name="l00722"></a>00722         dy = 0;
<a name="l00723"></a>00723     }
<a name="l00724"></a>00724     <span class="keywordflow">if</span> (sy &lt; 0) {
<a name="l00725"></a>00725         dy -= sy;  <span class="comment">/* increase dy */</span>
<a name="l00726"></a>00726         dh += sy;  <span class="comment">/* reduce dh */</span>
<a name="l00727"></a>00727         sy = 0;
<a name="l00728"></a>00728     }
<a name="l00729"></a>00729     dhangh = dy + dh - fdh;  <span class="comment">/* rect overhang of dest below */</span>
<a name="l00730"></a>00730     <span class="keywordflow">if</span> (dhangh &gt; 0)
<a name="l00731"></a>00731         dh -= dhangh;  <span class="comment">/* reduce dh */</span>
<a name="l00732"></a>00732     shangh = sy + dh - fsh;  <span class="comment">/* rect overhang of src below */</span>
<a name="l00733"></a>00733     <span class="keywordflow">if</span> (shangh &gt; 0)
<a name="l00734"></a>00734         dh -= shangh;  <span class="comment">/* reduce dh */</span>
<a name="l00735"></a>00735 
<a name="l00736"></a>00736         <span class="comment">/* if clipped entirely, quit */</span>
<a name="l00737"></a>00737     <span class="keywordflow">if</span> ((dw &lt;= 0) || (dh &lt;= 0))
<a name="l00738"></a>00738         <span class="keywordflow">return</span> 0;
<a name="l00739"></a>00739 
<a name="l00740"></a>00740     <span class="comment">/* -------------------------------------------------------- *</span>
<a name="l00741"></a>00741 <span class="comment">     *                    Copy block of data                    *</span>
<a name="l00742"></a>00742 <span class="comment">     * -------------------------------------------------------- */</span>
<a name="l00743"></a>00743     datas = <a class="code" href="fpix1_8c.html#af27ae584a0480d0f65258e8d8465846b">fpixGetData</a>(fpixs);
<a name="l00744"></a>00744     datad = <a class="code" href="fpix1_8c.html#af27ae584a0480d0f65258e8d8465846b">fpixGetData</a>(fpixd);
<a name="l00745"></a>00745     wpls = <a class="code" href="fpix1_8c.html#ab7f19e7fb19716b478b16f5f20c059c3">fpixGetWpl</a>(fpixs);
<a name="l00746"></a>00746     wpld = <a class="code" href="fpix1_8c.html#ab7f19e7fb19716b478b16f5f20c059c3">fpixGetWpl</a>(fpixd);
<a name="l00747"></a>00747     datas += sy * wpls + sx;  <span class="comment">/* at UL corner of block */</span>
<a name="l00748"></a>00748     datad += dy * wpld + dx;  <span class="comment">/* at UL corner of block */</span>
<a name="l00749"></a>00749     <span class="keywordflow">for</span> (i = 0; i &lt; dh; i++) {
<a name="l00750"></a>00750         lines = datas + i * wpls;
<a name="l00751"></a>00751         lined = datad + i * wpld;
<a name="l00752"></a>00752         <span class="keywordflow">for</span> (j = 0; j &lt; dw; j++) {
<a name="l00753"></a>00753             *lined = *lines;
<a name="l00754"></a>00754             lines++;
<a name="l00755"></a>00755             lined++;
<a name="l00756"></a>00756         }
<a name="l00757"></a>00757     }
<a name="l00758"></a>00758 
<a name="l00759"></a>00759     <span class="keywordflow">return</span> 0;
<a name="l00760"></a>00760 }
<a name="l00761"></a>00761 
<a name="l00762"></a>00762 
<a name="l00763"></a>00763 <span class="comment">/*--------------------------------------------------------------------*</span>
<a name="l00764"></a>00764 <span class="comment"> *                       Special integer scaling                      *</span>
<a name="l00765"></a>00765 <span class="comment"> *--------------------------------------------------------------------*/</span><span class="comment"></span>
<a name="l00766"></a>00766 <span class="comment">/*!</span>
<a name="l00767"></a>00767 <span class="comment"> *  fpixScaleByInteger()</span>
<a name="l00768"></a>00768 <span class="comment"> *</span>
<a name="l00769"></a>00769 <span class="comment"> *      Input:  fpixs (low resolution, subsampled)</span>
<a name="l00770"></a>00770 <span class="comment"> *              factor (scaling factor)</span>
<a name="l00771"></a>00771 <span class="comment"> *      Return: fpixd (interpolated result), or null on error</span>
<a name="l00772"></a>00772 <span class="comment"> *</span>
<a name="l00773"></a>00773 <span class="comment"> *  Notes:</span>
<a name="l00774"></a>00774 <span class="comment"> *      (1) The width wd of fpixd is related to ws of fpixs by:</span>
<a name="l00775"></a>00775 <span class="comment"> *              wd = factor * (ws - 1) + 1   (and ditto for the height)</span>
<a name="l00776"></a>00776 <span class="comment"> *          We avoid special-casing boundary pixels in the interpolation</span>
<a name="l00777"></a>00777 <span class="comment"> *          by constructing fpixd by inserting (factor - 1) interpolated</span>
<a name="l00778"></a>00778 <span class="comment"> *          pixels between each pixel in fpixs.  Then</span>
<a name="l00779"></a>00779 <span class="comment"> *               wd = ws + (ws - 1) * (factor - 1)    (same as above)</span>
<a name="l00780"></a>00780 <span class="comment"> *          This also has the advantage that if we subsample by @factor,</span>
<a name="l00781"></a>00781 <span class="comment"> *          throwing out all the interpolated pixels, we regain the</span>
<a name="l00782"></a>00782 <span class="comment"> *          original low resolution fpix.</span>
<a name="l00783"></a>00783 <span class="comment"> */</span>
<a name="l00784"></a>00784 <a class="code" href="struct_f_pix.html">FPIX</a> *
<a name="l00785"></a><a class="code" href="leptprotos_8h.html#a9f54bda4b0e5ee92eeab4ed5aa864d48">00785</a> <a class="code" href="fpix2_8c.html#a690224e54566b71d17b95f90244935ab">fpixScaleByInteger</a>(<a class="code" href="struct_f_pix.html">FPIX</a>    *fpixs,
<a name="l00786"></a>00786                    <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  factor)
<a name="l00787"></a>00787 {
<a name="l00788"></a>00788 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>     i, j, k, m, ws, hs, wd, hd, wpls, wpld;
<a name="l00789"></a>00789 <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>   val0, val1, val2, val3;
<a name="l00790"></a>00790 <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>  *datas, *datad, *lines, *lined, *fract;
<a name="l00791"></a>00791 <a class="code" href="struct_f_pix.html">FPIX</a>       *fpixd;
<a name="l00792"></a>00792 
<a name="l00793"></a>00793     <a class="code" href="environ_8h.html#a1a16952819bcbc526c998e3ac86f2e78">PROCNAME</a>(<span class="stringliteral">&quot;fpixScaleByInteger&quot;</span>);
<a name="l00794"></a>00794 
<a name="l00795"></a>00795     <span class="keywordflow">if</span> (!fpixs)
<a name="l00796"></a>00796         <span class="keywordflow">return</span> (<a class="code" href="struct_f_pix.html">FPIX</a> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;fpixs not defined&quot;</span>, procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00797"></a>00797 
<a name="l00798"></a>00798     <a class="code" href="fpix1_8c.html#a4f225dfa8c1e081c7d32b60acccc3638">fpixGetDimensions</a>(fpixs, &amp;ws, &amp;hs);
<a name="l00799"></a>00799     wd = factor * (ws - 1) + 1;
<a name="l00800"></a>00800     hd = factor * (hs - 1) + 1;
<a name="l00801"></a>00801     fpixd = <a class="code" href="fpix1_8c.html#adbbb61d64f5c6262dca09633b1693f4d">fpixCreate</a>(wd, hd);
<a name="l00802"></a>00802     datas = <a class="code" href="fpix1_8c.html#af27ae584a0480d0f65258e8d8465846b">fpixGetData</a>(fpixs);
<a name="l00803"></a>00803     datad = <a class="code" href="fpix1_8c.html#af27ae584a0480d0f65258e8d8465846b">fpixGetData</a>(fpixd);
<a name="l00804"></a>00804     wpls = <a class="code" href="fpix1_8c.html#ab7f19e7fb19716b478b16f5f20c059c3">fpixGetWpl</a>(fpixs);
<a name="l00805"></a>00805     wpld = <a class="code" href="fpix1_8c.html#ab7f19e7fb19716b478b16f5f20c059c3">fpixGetWpl</a>(fpixd);
<a name="l00806"></a>00806     fract = (<a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a> *)<a class="code" href="environ_8h.html#abc24891c647be0bd23e233d013175da0">CALLOC</a>(factor, <span class="keyword">sizeof</span>(<a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>));
<a name="l00807"></a>00807     <span class="keywordflow">for</span> (i = 0; i &lt; factor; i++)
<a name="l00808"></a>00808         fract[i] = i / (<a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>)factor;
<a name="l00809"></a>00809     <span class="keywordflow">for</span> (i = 0; i &lt; hs - 1; i++) {
<a name="l00810"></a>00810         lines = datas + i * wpls;
<a name="l00811"></a>00811         <span class="keywordflow">for</span> (j = 0; j &lt; ws - 1; j++) {
<a name="l00812"></a>00812             val0 = lines[j];
<a name="l00813"></a>00813             val1 = lines[j + 1];
<a name="l00814"></a>00814             val2 = lines[wpls + j];
<a name="l00815"></a>00815             val3 = lines[wpls + j + 1];
<a name="l00816"></a>00816             <span class="keywordflow">for</span> (k = 0; k &lt; factor; k++) {  <span class="comment">/* rows of sub-block */</span>
<a name="l00817"></a>00817                 lined = datad + (i * factor + k) * wpld;
<a name="l00818"></a>00818                 <span class="keywordflow">for</span> (m = 0; m &lt; factor; m++) {  <span class="comment">/* cols of sub-block */</span>
<a name="l00819"></a>00819                      *(lined + j * factor + m) =
<a name="l00820"></a>00820                             val0 * (1.0 - fract[m]) * (1.0 - fract[k]) +
<a name="l00821"></a>00821                             val1 * fract[m] * (1.0 - fract[k]) +
<a name="l00822"></a>00822                             val2 * (1.0 - fract[m]) * fract[k] +
<a name="l00823"></a>00823                             val3 * fract[m] * fract[k];
<a name="l00824"></a>00824                 }
<a name="l00825"></a>00825             }
<a name="l00826"></a>00826         }
<a name="l00827"></a>00827     }
<a name="l00828"></a>00828 
<a name="l00829"></a>00829         <span class="comment">/* Do the right-most column of fpixd, skipping LR corner */</span>
<a name="l00830"></a>00830     <span class="keywordflow">for</span> (i = 0; i &lt; hs - 1; i++) {
<a name="l00831"></a>00831         lines = datas + i * wpls;
<a name="l00832"></a>00832         val0 = lines[ws - 1];
<a name="l00833"></a>00833         val1 = lines[wpls + ws - 1];
<a name="l00834"></a>00834         <span class="keywordflow">for</span> (k = 0; k &lt; factor; k++) {
<a name="l00835"></a>00835             lined = datad + (i * factor + k) * wpld;
<a name="l00836"></a>00836             lined[wd - 1] = val0 * (1.0 - fract[k]) + val1 * fract[k];
<a name="l00837"></a>00837         }
<a name="l00838"></a>00838     }
<a name="l00839"></a>00839 
<a name="l00840"></a>00840         <span class="comment">/* Do the bottom-most row of fpixd */</span>
<a name="l00841"></a>00841     lines = datas + (hs - 1) * wpls;
<a name="l00842"></a>00842     lined = datad + (hd - 1) * wpld;
<a name="l00843"></a>00843     <span class="keywordflow">for</span> (j = 0; j &lt; ws - 1; j++) {
<a name="l00844"></a>00844         val0 = lines[j];
<a name="l00845"></a>00845         val1 = lines[j + 1];
<a name="l00846"></a>00846         <span class="keywordflow">for</span> (m = 0; m &lt; factor; m++)
<a name="l00847"></a>00847             lined[j * factor + m] = val0 * (1.0 - fract[m]) + val1 * fract[m];
<a name="l00848"></a>00848         lined[wd - 1] = lines[ws - 1];  <span class="comment">/* LR corner */</span>
<a name="l00849"></a>00849     }
<a name="l00850"></a>00850 
<a name="l00851"></a>00851     <a class="code" href="environ_8h.html#a105949c59c998e38aad80266afac92bf">FREE</a>(fract);
<a name="l00852"></a>00852     <span class="keywordflow">return</span> fpixd;
<a name="l00853"></a>00853 }
<a name="l00854"></a>00854 
<a name="l00855"></a>00855 <span class="comment"></span>
<a name="l00856"></a>00856 <span class="comment">/*!</span>
<a name="l00857"></a>00857 <span class="comment"> *  dpixScaleByInteger()</span>
<a name="l00858"></a>00858 <span class="comment"> *</span>
<a name="l00859"></a>00859 <span class="comment"> *      Input:  dpixs (low resolution, subsampled)</span>
<a name="l00860"></a>00860 <span class="comment"> *              factor (scaling factor)</span>
<a name="l00861"></a>00861 <span class="comment"> *      Return: dpixd (interpolated result), or null on error</span>
<a name="l00862"></a>00862 <span class="comment"> *</span>
<a name="l00863"></a>00863 <span class="comment"> *  Notes:</span>
<a name="l00864"></a>00864 <span class="comment"> *      (1) The width wd of dpixd is related to ws of dpixs by:</span>
<a name="l00865"></a>00865 <span class="comment"> *              wd = factor * (ws - 1) + 1   (and ditto for the height)</span>
<a name="l00866"></a>00866 <span class="comment"> *          We avoid special-casing boundary pixels in the interpolation</span>
<a name="l00867"></a>00867 <span class="comment"> *          by constructing fpixd by inserting (factor - 1) interpolated</span>
<a name="l00868"></a>00868 <span class="comment"> *          pixels between each pixel in fpixs.  Then</span>
<a name="l00869"></a>00869 <span class="comment"> *               wd = ws + (ws - 1) * (factor - 1)    (same as above)</span>
<a name="l00870"></a>00870 <span class="comment"> *          This also has the advantage that if we subsample by @factor,</span>
<a name="l00871"></a>00871 <span class="comment"> *          throwing out all the interpolated pixels, we regain the</span>
<a name="l00872"></a>00872 <span class="comment"> *          original low resolution dpix.</span>
<a name="l00873"></a>00873 <span class="comment"> */</span>
<a name="l00874"></a>00874 <a class="code" href="struct_d_pix.html">DPIX</a> *
<a name="l00875"></a><a class="code" href="leptprotos_8h.html#ad940d68037d3ed4205714cc07c8999b4">00875</a> <a class="code" href="fpix2_8c.html#a09f55a8702578e5414b79f73c7316665">dpixScaleByInteger</a>(<a class="code" href="struct_d_pix.html">DPIX</a>    *dpixs,
<a name="l00876"></a>00876                    <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  factor)
<a name="l00877"></a>00877 {
<a name="l00878"></a>00878 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>     i, j, k, m, ws, hs, wd, hd, wpls, wpld;
<a name="l00879"></a>00879 <a class="code" href="environ_8h.html#ab8d28dcce3b441bb0bb47f124ee3c252">l_float64</a>   val0, val1, val2, val3;
<a name="l00880"></a>00880 <a class="code" href="environ_8h.html#ab8d28dcce3b441bb0bb47f124ee3c252">l_float64</a>  *datas, *datad, *lines, *lined, *fract;
<a name="l00881"></a>00881 <a class="code" href="struct_d_pix.html">DPIX</a>       *dpixd;
<a name="l00882"></a>00882 
<a name="l00883"></a>00883     <a class="code" href="environ_8h.html#a1a16952819bcbc526c998e3ac86f2e78">PROCNAME</a>(<span class="stringliteral">&quot;dpixScaleByInteger&quot;</span>);
<a name="l00884"></a>00884 
<a name="l00885"></a>00885     <span class="keywordflow">if</span> (!dpixs)
<a name="l00886"></a>00886         <span class="keywordflow">return</span> (<a class="code" href="struct_d_pix.html">DPIX</a> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;dpixs not defined&quot;</span>, procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00887"></a>00887 
<a name="l00888"></a>00888     <a class="code" href="fpix1_8c.html#a92b07ec1ebb7df0a4fe6379de2270cd1">dpixGetDimensions</a>(dpixs, &amp;ws, &amp;hs);
<a name="l00889"></a>00889     wd = factor * (ws - 1) + 1;
<a name="l00890"></a>00890     hd = factor * (hs - 1) + 1;
<a name="l00891"></a>00891     dpixd = <a class="code" href="fpix1_8c.html#a3ed74abab861b6ad0250d0ee1866e723">dpixCreate</a>(wd, hd);
<a name="l00892"></a>00892     datas = <a class="code" href="fpix1_8c.html#a725e2c82ef6848ee180ffe4793ab78dd">dpixGetData</a>(dpixs);
<a name="l00893"></a>00893     datad = <a class="code" href="fpix1_8c.html#a725e2c82ef6848ee180ffe4793ab78dd">dpixGetData</a>(dpixd);
<a name="l00894"></a>00894     wpls = <a class="code" href="fpix1_8c.html#a35139a80097545ccb082a1b920e45c17">dpixGetWpl</a>(dpixs);
<a name="l00895"></a>00895     wpld = <a class="code" href="fpix1_8c.html#a35139a80097545ccb082a1b920e45c17">dpixGetWpl</a>(dpixd);
<a name="l00896"></a>00896     fract = (<a class="code" href="environ_8h.html#ab8d28dcce3b441bb0bb47f124ee3c252">l_float64</a> *)<a class="code" href="environ_8h.html#abc24891c647be0bd23e233d013175da0">CALLOC</a>(factor, <span class="keyword">sizeof</span>(<a class="code" href="environ_8h.html#ab8d28dcce3b441bb0bb47f124ee3c252">l_float64</a>));
<a name="l00897"></a>00897     <span class="keywordflow">for</span> (i = 0; i &lt; factor; i++)
<a name="l00898"></a>00898         fract[i] = i / (<a class="code" href="environ_8h.html#ab8d28dcce3b441bb0bb47f124ee3c252">l_float64</a>)factor;
<a name="l00899"></a>00899     <span class="keywordflow">for</span> (i = 0; i &lt; hs - 1; i++) {
<a name="l00900"></a>00900         lines = datas + i * wpls;
<a name="l00901"></a>00901         <span class="keywordflow">for</span> (j = 0; j &lt; ws - 1; j++) {
<a name="l00902"></a>00902             val0 = lines[j];
<a name="l00903"></a>00903             val1 = lines[j + 1];
<a name="l00904"></a>00904             val2 = lines[wpls + j];
<a name="l00905"></a>00905             val3 = lines[wpls + j + 1];
<a name="l00906"></a>00906             <span class="keywordflow">for</span> (k = 0; k &lt; factor; k++) {  <span class="comment">/* rows of sub-block */</span>
<a name="l00907"></a>00907                 lined = datad + (i * factor + k) * wpld;
<a name="l00908"></a>00908                 <span class="keywordflow">for</span> (m = 0; m &lt; factor; m++) {  <span class="comment">/* cols of sub-block */</span>
<a name="l00909"></a>00909                      *(lined + j * factor + m) =
<a name="l00910"></a>00910                             val0 * (1.0 - fract[m]) * (1.0 - fract[k]) +
<a name="l00911"></a>00911                             val1 * fract[m] * (1.0 - fract[k]) +
<a name="l00912"></a>00912                             val2 * (1.0 - fract[m]) * fract[k] +
<a name="l00913"></a>00913                             val3 * fract[m] * fract[k];
<a name="l00914"></a>00914                 }
<a name="l00915"></a>00915             }
<a name="l00916"></a>00916         }
<a name="l00917"></a>00917     }
<a name="l00918"></a>00918 
<a name="l00919"></a>00919         <span class="comment">/* Do the right-most column of dpixd, skipping LR corner */</span>
<a name="l00920"></a>00920     <span class="keywordflow">for</span> (i = 0; i &lt; hs - 1; i++) {
<a name="l00921"></a>00921         lines = datas + i * wpls;
<a name="l00922"></a>00922         val0 = lines[ws - 1];
<a name="l00923"></a>00923         val1 = lines[wpls + ws - 1];
<a name="l00924"></a>00924         <span class="keywordflow">for</span> (k = 0; k &lt; factor; k++) {
<a name="l00925"></a>00925             lined = datad + (i * factor + k) * wpld;
<a name="l00926"></a>00926             lined[wd - 1] = val0 * (1.0 - fract[k]) + val1 * fract[k];
<a name="l00927"></a>00927         }
<a name="l00928"></a>00928     }
<a name="l00929"></a>00929 
<a name="l00930"></a>00930         <span class="comment">/* Do the bottom-most row of dpixd */</span>
<a name="l00931"></a>00931     lines = datas + (hs - 1) * wpls;
<a name="l00932"></a>00932     lined = datad + (hd - 1) * wpld;
<a name="l00933"></a>00933     <span class="keywordflow">for</span> (j = 0; j &lt; ws - 1; j++) {
<a name="l00934"></a>00934         val0 = lines[j];
<a name="l00935"></a>00935         val1 = lines[j + 1];
<a name="l00936"></a>00936         <span class="keywordflow">for</span> (m = 0; m &lt; factor; m++)
<a name="l00937"></a>00937             lined[j * factor + m] = val0 * (1.0 - fract[m]) + val1 * fract[m];
<a name="l00938"></a>00938         lined[wd - 1] = lines[ws - 1];  <span class="comment">/* LR corner */</span>
<a name="l00939"></a>00939     }
<a name="l00940"></a>00940 
<a name="l00941"></a>00941     <a class="code" href="environ_8h.html#a105949c59c998e38aad80266afac92bf">FREE</a>(fract);
<a name="l00942"></a>00942     <span class="keywordflow">return</span> dpixd;
<a name="l00943"></a>00943 }
<a name="l00944"></a>00944 
<a name="l00945"></a>00945 
<a name="l00946"></a>00946 <span class="comment">/*--------------------------------------------------------------------*</span>
<a name="l00947"></a>00947 <span class="comment"> *                        Arithmetic operations                       *</span>
<a name="l00948"></a>00948 <span class="comment"> *--------------------------------------------------------------------*/</span><span class="comment"></span>
<a name="l00949"></a>00949 <span class="comment">/*!</span>
<a name="l00950"></a>00950 <span class="comment"> *  fpixLinearCombo()</span>
<a name="l00951"></a>00951 <span class="comment"> *</span>
<a name="l00952"></a>00952 <span class="comment"> *      Input:  fpixd (&lt;optional&gt;; this can be null, equal to fpixs1, or</span>
<a name="l00953"></a>00953 <span class="comment"> *                     different from fpixs1)</span>
<a name="l00954"></a>00954 <span class="comment"> *              fpixs1 (can be == to fpixd)</span>
<a name="l00955"></a>00955 <span class="comment"> *              fpixs2</span>
<a name="l00956"></a>00956 <span class="comment"> *      Return: pixd always</span>
<a name="l00957"></a>00957 <span class="comment"> *</span>
<a name="l00958"></a>00958 <span class="comment"> *  Notes:</span>
<a name="l00959"></a>00959 <span class="comment"> *      (1) Computes pixelwise linear combination: a * src1 + b * src2</span>
<a name="l00960"></a>00960 <span class="comment"> *      (2) Alignment is to UL corner.</span>
<a name="l00961"></a>00961 <span class="comment"> *      (3) There are 3 cases.  The result can go to a new dest,</span>
<a name="l00962"></a>00962 <span class="comment"> *          in-place to fpixs1, or to an existing input dest:</span>
<a name="l00963"></a>00963 <span class="comment"> *          * fpixd == null:   (src1 + src2) --&gt; new fpixd</span>
<a name="l00964"></a>00964 <span class="comment"> *          * fpixd == fpixs1:  (src1 + src2) --&gt; src1  (in-place)</span>
<a name="l00965"></a>00965 <span class="comment"> *          * fpixd != fpixs1: (src1 + src2) --&gt; input fpixd</span>
<a name="l00966"></a>00966 <span class="comment"> *      (4) fpixs2 must be different from both fpixd and fpixs1.</span>
<a name="l00967"></a>00967 <span class="comment"> */</span>
<a name="l00968"></a>00968 <a class="code" href="struct_f_pix.html">FPIX</a> *
<a name="l00969"></a><a class="code" href="leptprotos_8h.html#a6bddaab96e6a73d5df8b37876e5b9723">00969</a> <a class="code" href="fpix2_8c.html#aaea34e236ace0d7e0a9572bf2dc4f870">fpixLinearCombination</a>(<a class="code" href="struct_f_pix.html">FPIX</a>      *fpixd,
<a name="l00970"></a>00970                       <a class="code" href="struct_f_pix.html">FPIX</a>      *fpixs1,
<a name="l00971"></a>00971                       <a class="code" href="struct_f_pix.html">FPIX</a>      *fpixs2,
<a name="l00972"></a>00972                       <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>  a,
<a name="l00973"></a>00973                       <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>  b)
<a name="l00974"></a>00974 {
<a name="l00975"></a>00975 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>     i, j, ws, hs, w, h, wpls, wpld;
<a name="l00976"></a>00976 <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>   val;
<a name="l00977"></a>00977 <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>  *datas, *datad, *lines, *lined;
<a name="l00978"></a>00978 
<a name="l00979"></a>00979     <a class="code" href="environ_8h.html#a1a16952819bcbc526c998e3ac86f2e78">PROCNAME</a>(<span class="stringliteral">&quot;fpixLinearCombination&quot;</span>);
<a name="l00980"></a>00980 
<a name="l00981"></a>00981     <span class="keywordflow">if</span> (!fpixs1)
<a name="l00982"></a>00982         <span class="keywordflow">return</span> (<a class="code" href="struct_f_pix.html">FPIX</a> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;fpixs1 not defined&quot;</span>, procName, fpixd);
<a name="l00983"></a>00983     <span class="keywordflow">if</span> (!fpixs2)
<a name="l00984"></a>00984         <span class="keywordflow">return</span> (<a class="code" href="struct_f_pix.html">FPIX</a> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;fpixs2 not defined&quot;</span>, procName, fpixd);
<a name="l00985"></a>00985     <span class="keywordflow">if</span> (fpixs1 == fpixs2)
<a name="l00986"></a>00986         <span class="keywordflow">return</span> (<a class="code" href="struct_f_pix.html">FPIX</a> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;fpixs1 == fpixs2&quot;</span>, procName, fpixd);
<a name="l00987"></a>00987     <span class="keywordflow">if</span> (fpixs2 == fpixd)
<a name="l00988"></a>00988         <span class="keywordflow">return</span> (<a class="code" href="struct_f_pix.html">FPIX</a> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;fpixs2 == fpixd&quot;</span>, procName, fpixd);
<a name="l00989"></a>00989 
<a name="l00990"></a>00990     <span class="keywordflow">if</span> (fpixs1 != fpixd)
<a name="l00991"></a>00991         fpixd = <a class="code" href="fpix1_8c.html#a56336c678733d924db5a4a2eaf137e6f">fpixCopy</a>(fpixd, fpixs1);
<a name="l00992"></a>00992 
<a name="l00993"></a>00993     datas = <a class="code" href="fpix1_8c.html#af27ae584a0480d0f65258e8d8465846b">fpixGetData</a>(fpixs2);
<a name="l00994"></a>00994     datad = <a class="code" href="fpix1_8c.html#af27ae584a0480d0f65258e8d8465846b">fpixGetData</a>(fpixd);
<a name="l00995"></a>00995     wpls = <a class="code" href="fpix1_8c.html#ab7f19e7fb19716b478b16f5f20c059c3">fpixGetWpl</a>(fpixs2);
<a name="l00996"></a>00996     wpld = <a class="code" href="fpix1_8c.html#ab7f19e7fb19716b478b16f5f20c059c3">fpixGetWpl</a>(fpixd);
<a name="l00997"></a>00997     <a class="code" href="fpix1_8c.html#a4f225dfa8c1e081c7d32b60acccc3638">fpixGetDimensions</a>(fpixs2, &amp;ws, &amp;hs);
<a name="l00998"></a>00998     <a class="code" href="fpix1_8c.html#a4f225dfa8c1e081c7d32b60acccc3638">fpixGetDimensions</a>(fpixd, &amp;w, &amp;h);
<a name="l00999"></a>00999     w = <a class="code" href="environ_8h.html#a67d588ee5ca71be19990efb07fa2ce72">L_MIN</a>(ws, w);
<a name="l01000"></a>01000     h = <a class="code" href="environ_8h.html#a67d588ee5ca71be19990efb07fa2ce72">L_MIN</a>(hs, h);
<a name="l01001"></a>01001     <span class="keywordflow">for</span> (i = 0; i &lt; h; i++) {
<a name="l01002"></a>01002         lines = datas + i * wpls;
<a name="l01003"></a>01003         lined = datad + i * wpld;
<a name="l01004"></a>01004         <span class="keywordflow">if</span> (a == 1.0 &amp;&amp; b == 1.0) {  <span class="comment">/* sum */</span>
<a name="l01005"></a>01005             <span class="keywordflow">for</span> (j = 0; j &lt; w; j++)
<a name="l01006"></a>01006                 *(lined + j) += *(lines + j);
<a name="l01007"></a>01007         }
<a name="l01008"></a>01008         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (a == 1.0 &amp;&amp; b == -1.0) {  <span class="comment">/* diff */</span>
<a name="l01009"></a>01009             <span class="keywordflow">for</span> (j = 0; j &lt; w; j++)
<a name="l01010"></a>01010                 *(lined + j) -= *(lines + j);
<a name="l01011"></a>01011         }
<a name="l01012"></a>01012         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (a == -1.0 &amp;&amp; b == 1.0) {  <span class="comment">/* diff */</span>
<a name="l01013"></a>01013             <span class="keywordflow">for</span> (j = 0; j &lt; w; j++) {
<a name="l01014"></a>01014                 val = *(lined + j);
<a name="l01015"></a>01015                 *(lined + j) = -val + *(lines + j);
<a name="l01016"></a>01016             }
<a name="l01017"></a>01017         }
<a name="l01018"></a>01018         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (a == -1.0 &amp;&amp; b == -1.0) {
<a name="l01019"></a>01019             <span class="keywordflow">for</span> (j = 0; j &lt; w; j++) {
<a name="l01020"></a>01020                 val = *(lined + j);
<a name="l01021"></a>01021                 *(lined + j) = -val - *(lines + j);
<a name="l01022"></a>01022             }
<a name="l01023"></a>01023         }
<a name="l01024"></a>01024         <span class="keywordflow">else</span> {
<a name="l01025"></a>01025             <span class="keywordflow">for</span> (j = 0; j &lt; w; j++)
<a name="l01026"></a>01026                 *(lined + j) = a * lined[j] + b * lines[j];
<a name="l01027"></a>01027         }
<a name="l01028"></a>01028     }
<a name="l01029"></a>01029 
<a name="l01030"></a>01030     <span class="keywordflow">return</span> fpixd;
<a name="l01031"></a>01031 }
<a name="l01032"></a>01032 
<a name="l01033"></a>01033 <span class="comment"></span>
<a name="l01034"></a>01034 <span class="comment">/*!</span>
<a name="l01035"></a>01035 <span class="comment"> *  fpixAddMultConstant()</span>
<a name="l01036"></a>01036 <span class="comment"> *</span>
<a name="l01037"></a>01037 <span class="comment"> *      Input:  fpix</span>
<a name="l01038"></a>01038 <span class="comment"> *              addc  (use 0.0 to skip the operation)</span>
<a name="l01039"></a>01039 <span class="comment"> *              multc (use 1.0 to skip the operation)</span>
<a name="l01040"></a>01040 <span class="comment"> *      Return: 0 if OK, 1 on error</span>
<a name="l01041"></a>01041 <span class="comment"> *</span>
<a name="l01042"></a>01042 <span class="comment"> *  Notes:</span>
<a name="l01043"></a>01043 <span class="comment"> *      (1) This is an in-place operation.</span>
<a name="l01044"></a>01044 <span class="comment"> *      (2) It can be used to multiply each pixel by a constant,</span>
<a name="l01045"></a>01045 <span class="comment"> *          and also to add a constant to each pixel.  Multiplication</span>
<a name="l01046"></a>01046 <span class="comment"> *          is done first.</span>
<a name="l01047"></a>01047 <span class="comment"> */</span>
<a name="l01048"></a>01048 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>
<a name="l01049"></a><a class="code" href="leptprotos_8h.html#ab7ec9b04931aa7c21daf5232346ffe70">01049</a> <a class="code" href="fpix2_8c.html#a3502e500c9e2fbcdcfe2751207049ab7">fpixAddMultConstant</a>(<a class="code" href="struct_f_pix.html">FPIX</a>      *fpix,
<a name="l01050"></a>01050                     <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>  addc,
<a name="l01051"></a>01051                     <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>  multc)
<a name="l01052"></a>01052 {
<a name="l01053"></a>01053 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>     i, j, w, h, wpl;
<a name="l01054"></a>01054 <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>   val;
<a name="l01055"></a>01055 <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>  *line, *data;
<a name="l01056"></a>01056 
<a name="l01057"></a>01057     <a class="code" href="environ_8h.html#a1a16952819bcbc526c998e3ac86f2e78">PROCNAME</a>(<span class="stringliteral">&quot;fpixAddMultConstant&quot;</span>);
<a name="l01058"></a>01058 
<a name="l01059"></a>01059     <span class="keywordflow">if</span> (!fpix)
<a name="l01060"></a>01060         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;fpix not defined&quot;</span>, procName, 1);
<a name="l01061"></a>01061 
<a name="l01062"></a>01062     <span class="keywordflow">if</span> (addc == 0.0 &amp;&amp; multc == 1.0)
<a name="l01063"></a>01063         <span class="keywordflow">return</span> 0;
<a name="l01064"></a>01064 
<a name="l01065"></a>01065     <a class="code" href="fpix1_8c.html#a4f225dfa8c1e081c7d32b60acccc3638">fpixGetDimensions</a>(fpix, &amp;w, &amp;h);
<a name="l01066"></a>01066     data = <a class="code" href="fpix1_8c.html#af27ae584a0480d0f65258e8d8465846b">fpixGetData</a>(fpix);
<a name="l01067"></a>01067     wpl = <a class="code" href="fpix1_8c.html#ab7f19e7fb19716b478b16f5f20c059c3">fpixGetWpl</a>(fpix);
<a name="l01068"></a>01068     <span class="keywordflow">for</span> (i = 0; i &lt; h; i++) {
<a name="l01069"></a>01069         line = data + i * wpl;
<a name="l01070"></a>01070         <span class="keywordflow">if</span> (addc == 0.0) {
<a name="l01071"></a>01071             <span class="keywordflow">for</span> (j = 0; j &lt; w; j++)
<a name="l01072"></a>01072                 *(line + j) *= multc;
<a name="l01073"></a>01073         }
<a name="l01074"></a>01074         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (multc == 1.0) {
<a name="l01075"></a>01075             <span class="keywordflow">for</span> (j = 0; j &lt; w; j++)
<a name="l01076"></a>01076                 *(line + j) += addc;
<a name="l01077"></a>01077         }
<a name="l01078"></a>01078         <span class="keywordflow">else</span>  {
<a name="l01079"></a>01079             <span class="keywordflow">for</span> (j = 0; j &lt; w; j++) {
<a name="l01080"></a>01080                 val = *(line + j);
<a name="l01081"></a>01081                 *(line + j) = multc * val + addc;
<a name="l01082"></a>01082             }
<a name="l01083"></a>01083         }
<a name="l01084"></a>01084     }
<a name="l01085"></a>01085 
<a name="l01086"></a>01086     <span class="keywordflow">return</span> 0;
<a name="l01087"></a>01087 }
<a name="l01088"></a>01088 
</pre></div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="fpix2_8c.html">fpix2.c</a>      </li>
      <li class="footer">Generated by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </li>
    </ul>
  </div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


</body>
</html>
