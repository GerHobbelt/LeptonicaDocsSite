<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Leptonica: prog/ioformats_reg.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<script type="text/javascript">
function hasClass(ele,cls) {
  return ele.className.match(new RegExp('(\\s|^)'+cls+'(\\s|$)'));
}

function addClass(ele,cls) {
  if (!this.hasClass(ele,cls)) ele.className += " "+cls;
}

function removeClass(ele,cls) {
  if (hasClass(ele,cls)) {
    var reg = new RegExp('(\\s|^)'+cls+'(\\s|$)');
    ele.className=ele.className.replace(reg,' ');
  }
}

function toggleVisibility(linkObj) {
 var base = linkObj.getAttribute('id');
 var summary = document.getElementById(base + '-summary');
 var content = document.getElementById(base + '-content');
 var trigger = document.getElementById(base + '-trigger');
 if ( hasClass(linkObj,'closed') ) {
   summary.style.display = 'none';
   content.style.display = 'block';
   trigger.src = 'open.png';
   removeClass(linkObj,'closed');
   addClass(linkObj,'opened');
 } else if ( hasClass(linkObj,'opened') ) {
   summary.style.display = 'block';
   content.style.display = 'none';
   trigger.src = 'closed.png';
   removeClass(linkObj,'opened');
   addClass(linkObj,'closed');
 }
 return false;
}
</script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="moller52-tiny.jpg"></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Leptonica&#160;<span id="projectnumber">1.68</span></div>
   <div id="projectbrief">C Image Processing Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('ioformats__reg_8c.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<h1>ioformats_reg.c</h1>  </div>
</div>
<div class="contents">
<a href="ioformats__reg_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*====================================================================*</span>
<a name="l00002"></a>00002 <span class="comment"> -  Copyright (C) 2001 Leptonica.  All rights reserved.</span>
<a name="l00003"></a>00003 <span class="comment"> -  This software is distributed in the hope that it will be</span>
<a name="l00004"></a>00004 <span class="comment"> -  useful, but with NO WARRANTY OF ANY KIND.</span>
<a name="l00005"></a>00005 <span class="comment"> -  No author or distributor accepts responsibility to anyone for the</span>
<a name="l00006"></a>00006 <span class="comment"> -  consequences of using this software, or for whether it serves any</span>
<a name="l00007"></a>00007 <span class="comment"> -  particular purpose or works at all, unless he or she says so in</span>
<a name="l00008"></a>00008 <span class="comment"> -  writing.  Everyone is granted permission to copy, modify and</span>
<a name="l00009"></a>00009 <span class="comment"> -  redistribute this source code, for commercial or non-commercial</span>
<a name="l00010"></a>00010 <span class="comment"> -  purposes, with the following restrictions: (1) the origin of this</span>
<a name="l00011"></a>00011 <span class="comment"> -  source code must not be misrepresented; (2) modified versions must</span>
<a name="l00012"></a>00012 <span class="comment"> -  be plainly marked as such; and (3) this notice may not be removed</span>
<a name="l00013"></a>00013 <span class="comment"> -  or altered from any source or modified source distribution.</span>
<a name="l00014"></a>00014 <span class="comment"> *====================================================================*/</span>
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 
<a name="l00017"></a>00017 <span class="comment">/*</span>
<a name="l00018"></a>00018 <span class="comment"> * ioformats_reg.c</span>
<a name="l00019"></a>00019 <span class="comment"> *</span>
<a name="l00020"></a>00020 <span class="comment"> *    !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<a name="l00021"></a>00021 <span class="comment"> *    This is the primary Leptonica regression test for lossless</span>
<a name="l00022"></a>00022 <span class="comment"> *    read/write I/O to standard image files (png, tiff, bmp, etc.)</span>
<a name="l00023"></a>00023 <span class="comment"> *    !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<a name="l00024"></a>00024 <span class="comment"> *</span>
<a name="l00025"></a>00025 <span class="comment"> *    This tests reading and writing of images in different formats</span>
<a name="l00026"></a>00026 <span class="comment"> *    It should work properly on input images of any depth, with</span>
<a name="l00027"></a>00027 <span class="comment"> *    and without colormaps.</span>
<a name="l00028"></a>00028 <span class="comment"> *</span>
<a name="l00029"></a>00029 <span class="comment"> *    The first part of the test works by doing a write/read and</span>
<a name="l00030"></a>00030 <span class="comment"> *    testing the result for equality.  We only test the lossless</span>
<a name="l00031"></a>00031 <span class="comment"> *    file formats, with pix of various depths, both with and</span>
<a name="l00032"></a>00032 <span class="comment"> *    without colormaps.  Because jpeg works fine on grayscale</span>
<a name="l00033"></a>00033 <span class="comment"> *    and rgb, there is no need for explicit tests on jpeg</span>
<a name="l00034"></a>00034 <span class="comment"> *    compression here.</span>
<a name="l00035"></a>00035 <span class="comment"> *</span>
<a name="l00036"></a>00036 <span class="comment"> *    The second part tests all different tiff compressions, for</span>
<a name="l00037"></a>00037 <span class="comment"> *    read/write that is backed both by file and by memory.</span>
<a name="l00038"></a>00038 <span class="comment"> *    For r/w to file, it is actually redundant with the first part.)</span>
<a name="l00039"></a>00039 <span class="comment"> *</span>
<a name="l00040"></a>00040 <span class="comment"> *    This test is dependent on the following external libraries:</span>
<a name="l00041"></a>00041 <span class="comment"> *        libjpeg, libtiff, libpng, libz</span>
<a name="l00042"></a>00042 <span class="comment"> *</span>
<a name="l00043"></a>00043 <span class="comment"> *    TODO (1/28/11): Set up a jpegio_reg.c set of tests</span>
<a name="l00044"></a>00044 <span class="comment"> *    and include the following:</span>
<a name="l00045"></a>00045 <span class="comment"> *      (1) different color spaces; e.g., CYYK</span>
<a name="l00046"></a>00046 <span class="comment"> *      (2) colormapped images, which jpeg can handle</span>
<a name="l00047"></a>00047 <span class="comment"> *      (3) no chroma subsampling</span>
<a name="l00048"></a>00048 <span class="comment"> */</span>
<a name="l00049"></a>00049 
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;allheaders.h&quot;</span>
<a name="l00051"></a>00051 
<a name="l00052"></a>00052     <span class="comment">/* Needed for checking libraries and HAVE_FMEMOPEN */</span>
<a name="l00053"></a>00053 <span class="preprocessor">#ifdef HAVE_CONFIG_H</span>
<a name="l00054"></a>00054 <span class="preprocessor"></span><span class="preprocessor">#include &lt;config_auto.h&gt;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#endif </span><span class="comment">/* HAVE_CONFIG_H */</span>
<a name="l00056"></a>00056 
<a name="l00057"></a><a class="code" href="ioformats__reg_8c.html#a4b9bcb6c82625a2e95f9a072aa341de9">00057</a> <span class="preprocessor">#define   BMP_FILE      &quot;test1.bmp&quot;</span>
<a name="l00058"></a><a class="code" href="ioformats__reg_8c.html#afc1dddee32fc2ec926ae00abd17c7098">00058</a> <span class="preprocessor"></span><span class="preprocessor">#define   FILE_1BPP     &quot;feyn.tif&quot;</span>
<a name="l00059"></a><a class="code" href="ioformats__reg_8c.html#a0b0f64825c76f3999070e68c70af4dbb">00059</a> <span class="preprocessor"></span><span class="preprocessor">#define   FILE_2BPP     &quot;speckle2.png&quot;</span>
<a name="l00060"></a><a class="code" href="ioformats__reg_8c.html#a4a7f4aed15e45acf42678bb7e4226cbf">00060</a> <span class="preprocessor"></span><span class="preprocessor">#define   FILE_2BPP_C   &quot;weasel2.4g.png&quot;</span>
<a name="l00061"></a><a class="code" href="ioformats__reg_8c.html#a7c93d799fd358aaaec75d10ebb6ef8ea">00061</a> <span class="preprocessor"></span><span class="preprocessor">#define   FILE_4BPP     &quot;speckle4.png&quot;</span>
<a name="l00062"></a><a class="code" href="ioformats__reg_8c.html#a9a76a8dbe9a6e52171430acc44191c3f">00062</a> <span class="preprocessor"></span><span class="preprocessor">#define   FILE_4BPP_C   &quot;weasel4.16c.png&quot;</span>
<a name="l00063"></a><a class="code" href="ioformats__reg_8c.html#a669a421ea544c0b7081f425a6ad82da4">00063</a> <span class="preprocessor"></span><span class="preprocessor">#define   FILE_8BPP_1   &quot;dreyfus8.png&quot;</span>
<a name="l00064"></a><a class="code" href="ioformats__reg_8c.html#aa63b828d29fba84b26be4cf0ee3725e4">00064</a> <span class="preprocessor"></span><span class="preprocessor">#define   FILE_8BPP_2   &quot;weasel8.240c.png&quot;</span>
<a name="l00065"></a><a class="code" href="ioformats__reg_8c.html#a6d846523e9a15d36d4c82c3a9ebc15d8">00065</a> <span class="preprocessor"></span><span class="preprocessor">#define   FILE_8BPP_3   &quot;test8.jpg&quot;</span>
<a name="l00066"></a><a class="code" href="ioformats__reg_8c.html#a9061bdecaa03d0766a193bbca3d08ce7">00066</a> <span class="preprocessor"></span><span class="preprocessor">#define   FILE_16BPP    &quot;test16.tif&quot;</span>
<a name="l00067"></a><a class="code" href="ioformats__reg_8c.html#a9af43aea76e4b2db894d3745d372250e">00067</a> <span class="preprocessor"></span><span class="preprocessor">#define   FILE_32BPP    &quot;marge.jpg&quot;</span>
<a name="l00068"></a>00068 <span class="preprocessor"></span>
<a name="l00069"></a>00069 <span class="keyword">static</span> <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a> <a class="code" href="ioformats__reg_8c.html#aba414cb94ac191a108964c103191d601">testcomp</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="pixserial__reg_8c.html#acbe1cede344a3bc567aea2d2e2ec0b20">filename</a>, <a class="code" href="struct_pix.html">PIX</a> *pix, <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a> comptype);
<a name="l00070"></a>00070 <span class="keyword">static</span> <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a> <a class="code" href="ioformats__reg_8c.html#a7023b0d8873734c388bc8eeaa2543d50">testcomp_mem</a>(<a class="code" href="struct_pix.html">PIX</a> *pixs, <a class="code" href="struct_pix.html">PIX</a> **ppixt, <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a> index,
<a name="l00071"></a>00071                             <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a> format);
<a name="l00072"></a>00072 <span class="keyword">static</span> <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a> <a class="code" href="ioformats__reg_8c.html#aa1767647474fbb60b2a6cb7d25e2ee58">test_writemem</a>(<a class="code" href="struct_pix.html">PIX</a> *pixs, <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a> format, <span class="keywordtype">char</span> *psfile);
<a name="l00073"></a>00073 <span class="keyword">static</span> <a class="code" href="struct_pix.html">PIX</a> *<a class="code" href="ioformats__reg_8c.html#aa1a66ea392c07421751d886020302b7b">make_24_bpp_pix</a>(<a class="code" href="struct_pix.html">PIX</a> *pixs);
<a name="l00074"></a>00074 <span class="keyword">static</span> <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a> <a class="code" href="ioformats__reg_8c.html#a8cc335a218d16cb56d7738169468a2b4">get_header_data</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="pixserial__reg_8c.html#acbe1cede344a3bc567aea2d2e2ec0b20">filename</a>, <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a> true_format);
<a name="l00075"></a>00075 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ioformats__reg_8c.html#a2d0f732e19f15d3d5dfdd7504906a2b8">get_tiff_compression_name</a>(<span class="keywordtype">char</span> *<a class="code" href="otsutest1_8c.html#a866e3eea299e33d1f7cdc6e46e65835f">buf</a>, <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a> format);
<a name="l00076"></a>00076 
<a name="l00077"></a>00077 <a class="code" href="environ_8h.html#af1bfe482f20b05b4163a452cd795e66e">LEPT_DLL</a> <span class="keyword">extern</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="pix1_8c.html#a65db7b5cece58497d4ecbd3cfa1002cc">ImageFileFormatExtensions</a>[];
<a name="l00078"></a>00078 
<a name="l00079"></a><a class="code" href="ioformats__reg_8c.html#a5ea466849f21e6c2be4ef9b2eb8868d3">00079</a> <a class="code" href="src_2endiantest_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>(<span class="keywordtype">int</span>    argc,
<a name="l00080"></a>00080      <span class="keywordtype">char</span> **argv)
<a name="l00081"></a>00081 {
<a name="l00082"></a>00082 <span class="preprocessor">#if HAVE_FMEMOPEN</span>
<a name="l00083"></a>00083 <span class="preprocessor"></span><span class="keywordtype">char</span>          psname[256];
<a name="l00084"></a>00084 <span class="preprocessor">#endif  </span><span class="comment">/* HAVE_FMEMOPEN */</span>
<a name="l00085"></a>00085 <span class="keywordtype">char</span>         *tempname;
<a name="l00086"></a>00086 <a class="code" href="environ_8h.html#a7ed60554e7d6dd89aca643189b1e70ad">l_uint8</a>      *data;
<a name="l00087"></a>00087 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>       i, d, n, success, failure, same;
<a name="l00088"></a>00088 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>       w, h, bps, spp;
<a name="l00089"></a>00089 <span class="keywordtype">size_t</span>        <a class="code" href="warper__reg_8c.html#a711275dc7bbe85bb6fa721bc60b8637c">size</a>, nbytes;
<a name="l00090"></a>00090 <a class="code" href="struct_pix.html">PIX</a>          *pix1, *pix2, *pix4, *pix8, *pix16, *pix32;
<a name="l00091"></a>00091 <a class="code" href="struct_pix.html">PIX</a>          *pix, *pixt, *pixd;
<a name="l00092"></a>00092 <a class="code" href="struct_pixa.html">PIXA</a>         *pixa;
<a name="l00093"></a>00093 <a class="code" href="struct_l___reg_params.html">L_REGPARAMS</a>  *rp;
<a name="l00094"></a>00094 
<a name="l00095"></a>00095 <span class="preprocessor">#if  !HAVE_LIBJPEG</span>
<a name="l00096"></a>00096 <span class="preprocessor"></span>    fprintf(stderr, <span class="stringliteral">&quot;Omitting libjpeg tests in ioformats_reg\n&quot;</span>);
<a name="l00097"></a>00097 <span class="preprocessor">#endif  </span><span class="comment">/* !HAVE_LIBJPEG */</span>
<a name="l00098"></a>00098 
<a name="l00099"></a>00099 <span class="preprocessor">#if  !HAVE_LIBTIFF</span>
<a name="l00100"></a>00100 <span class="preprocessor"></span>    fprintf(stderr, <span class="stringliteral">&quot;Omitting libtiff tests in ioformats_reg\n&quot;</span>);
<a name="l00101"></a>00101 <span class="preprocessor">#endif  </span><span class="comment">/* !HAVE_LIBTIFF */</span>
<a name="l00102"></a>00102 
<a name="l00103"></a>00103 <span class="preprocessor">#if  !HAVE_LIBPNG || !HAVE_LIBZ</span>
<a name="l00104"></a>00104 <span class="preprocessor"></span>    fprintf(stderr, <span class="stringliteral">&quot;Omitting libpng tests in ioformats_reg\n&quot;</span>);
<a name="l00105"></a>00105 <span class="preprocessor">#endif  </span><span class="comment">/* !HAVE_LIBPNG || !HAVE_LIBZ */</span>
<a name="l00106"></a>00106 
<a name="l00107"></a>00107     <span class="keywordflow">if</span> (<a class="code" href="leptprotos_8h.html#ae0217b9c267e3898440aaf6a026efb8d">regTestSetup</a>(argc, argv, &amp;rp))
<a name="l00108"></a>00108         <span class="keywordflow">return</span> 1;
<a name="l00109"></a>00109 
<a name="l00110"></a>00110     <span class="comment">/* --------- Part 1: Test all lossless formats for r/w to file ---------*/</span>
<a name="l00111"></a>00111 
<a name="l00112"></a>00112     failure = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00113"></a>00113     success = <a class="code" href="environ_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00114"></a>00114     fprintf(stderr, <span class="stringliteral">&quot;Test bmp 1 bpp file:\n&quot;</span>);
<a name="l00115"></a>00115     <span class="keywordflow">if</span> (<a class="code" href="leptprotos_8h.html#a927f7c8e4936b8a0017e38e28da19adc">ioFormatTest</a>(<a class="code" href="ioformats__reg_8c.html#a4b9bcb6c82625a2e95f9a072aa341de9">BMP_FILE</a>)) success = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00116"></a>00116 
<a name="l00117"></a>00117 
<a name="l00118"></a>00118 <span class="preprocessor">#if  HAVE_LIBTIFF</span>
<a name="l00119"></a>00119 <span class="preprocessor"></span>    fprintf(stderr, <span class="stringliteral">&quot;\nTest other 1 bpp file:\n&quot;</span>);
<a name="l00120"></a>00120     <span class="keywordflow">if</span> (<a class="code" href="leptprotos_8h.html#a927f7c8e4936b8a0017e38e28da19adc">ioFormatTest</a>(<a class="code" href="ioformats__reg_8c.html#afc1dddee32fc2ec926ae00abd17c7098">FILE_1BPP</a>)) success = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00121"></a>00121 <span class="preprocessor">#endif  </span><span class="comment">/* HAVE_LIBTIFF */</span>
<a name="l00122"></a>00122 
<a name="l00123"></a>00123 <span class="preprocessor">#if  HAVE_LIBPNG</span>
<a name="l00124"></a>00124 <span class="preprocessor"></span>    fprintf(stderr, <span class="stringliteral">&quot;\nTest 2 bpp file:\n&quot;</span>);
<a name="l00125"></a>00125     <span class="keywordflow">if</span> (<a class="code" href="leptprotos_8h.html#a927f7c8e4936b8a0017e38e28da19adc">ioFormatTest</a>(<a class="code" href="ioformats__reg_8c.html#a0b0f64825c76f3999070e68c70af4dbb">FILE_2BPP</a>)) success = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00126"></a>00126     fprintf(stderr, <span class="stringliteral">&quot;\nTest 2 bpp file with cmap:\n&quot;</span>);
<a name="l00127"></a>00127     <span class="keywordflow">if</span> (<a class="code" href="leptprotos_8h.html#a927f7c8e4936b8a0017e38e28da19adc">ioFormatTest</a>(<a class="code" href="ioformats__reg_8c.html#a4a7f4aed15e45acf42678bb7e4226cbf">FILE_2BPP_C</a>)) success = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00128"></a>00128     fprintf(stderr, <span class="stringliteral">&quot;\nTest 4 bpp file:\n&quot;</span>);
<a name="l00129"></a>00129     <span class="keywordflow">if</span> (<a class="code" href="leptprotos_8h.html#a927f7c8e4936b8a0017e38e28da19adc">ioFormatTest</a>(<a class="code" href="ioformats__reg_8c.html#a7c93d799fd358aaaec75d10ebb6ef8ea">FILE_4BPP</a>)) success = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00130"></a>00130     fprintf(stderr, <span class="stringliteral">&quot;\nTest 4 bpp file with cmap:\n&quot;</span>);
<a name="l00131"></a>00131     <span class="keywordflow">if</span> (<a class="code" href="leptprotos_8h.html#a927f7c8e4936b8a0017e38e28da19adc">ioFormatTest</a>(<a class="code" href="ioformats__reg_8c.html#a9a76a8dbe9a6e52171430acc44191c3f">FILE_4BPP_C</a>)) success = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00132"></a>00132     fprintf(stderr, <span class="stringliteral">&quot;\nTest 8 bpp grayscale file with cmap:\n&quot;</span>);
<a name="l00133"></a>00133     <span class="keywordflow">if</span> (<a class="code" href="leptprotos_8h.html#a927f7c8e4936b8a0017e38e28da19adc">ioFormatTest</a>(<a class="code" href="ioformats__reg_8c.html#a669a421ea544c0b7081f425a6ad82da4">FILE_8BPP_1</a>)) success = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00134"></a>00134     fprintf(stderr, <span class="stringliteral">&quot;\nTest 8 bpp color file with cmap:\n&quot;</span>);
<a name="l00135"></a>00135     <span class="keywordflow">if</span> (<a class="code" href="leptprotos_8h.html#a927f7c8e4936b8a0017e38e28da19adc">ioFormatTest</a>(<a class="code" href="ioformats__reg_8c.html#aa63b828d29fba84b26be4cf0ee3725e4">FILE_8BPP_2</a>)) success = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00136"></a>00136 <span class="preprocessor">#endif  </span><span class="comment">/* HAVE_LIBPNG */</span>
<a name="l00137"></a>00137 
<a name="l00138"></a>00138 <span class="preprocessor">#if  HAVE_LIBJPEG</span>
<a name="l00139"></a>00139 <span class="preprocessor"></span>    fprintf(stderr, <span class="stringliteral">&quot;\nTest 8 bpp file without cmap:\n&quot;</span>);
<a name="l00140"></a>00140     <span class="keywordflow">if</span> (<a class="code" href="leptprotos_8h.html#a927f7c8e4936b8a0017e38e28da19adc">ioFormatTest</a>(<a class="code" href="ioformats__reg_8c.html#a6d846523e9a15d36d4c82c3a9ebc15d8">FILE_8BPP_3</a>)) success = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00141"></a>00141 <span class="preprocessor">#endif  </span><span class="comment">/* HAVE_LIBJPEG */</span>
<a name="l00142"></a>00142 
<a name="l00143"></a>00143 <span class="preprocessor">#if  HAVE_LIBTIFF</span>
<a name="l00144"></a>00144 <span class="preprocessor"></span>    fprintf(stderr, <span class="stringliteral">&quot;\nTest 16 bpp file:\n&quot;</span>);
<a name="l00145"></a>00145     <span class="keywordflow">if</span> (<a class="code" href="leptprotos_8h.html#a927f7c8e4936b8a0017e38e28da19adc">ioFormatTest</a>(<a class="code" href="ioformats__reg_8c.html#a9061bdecaa03d0766a193bbca3d08ce7">FILE_16BPP</a>)) success = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00146"></a>00146 <span class="preprocessor">#endif  </span><span class="comment">/* HAVE_LIBTIFF */</span>
<a name="l00147"></a>00147 
<a name="l00148"></a>00148 <span class="preprocessor">#if  HAVE_LIBJPEG</span>
<a name="l00149"></a>00149 <span class="preprocessor"></span>    fprintf(stderr, <span class="stringliteral">&quot;\nTest 32 bpp file:\n&quot;</span>);
<a name="l00150"></a>00150     <span class="keywordflow">if</span> (<a class="code" href="leptprotos_8h.html#a927f7c8e4936b8a0017e38e28da19adc">ioFormatTest</a>(<a class="code" href="ioformats__reg_8c.html#a9af43aea76e4b2db894d3745d372250e">FILE_32BPP</a>)) success = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00151"></a>00151 <span class="preprocessor">#endif  </span><span class="comment">/* HAVE_LIBJPEG */</span>
<a name="l00152"></a>00152 
<a name="l00153"></a>00153     <span class="keywordflow">if</span> (success)
<a name="l00154"></a>00154         fprintf(stderr,
<a name="l00155"></a>00155             <span class="stringliteral">&quot;\n  ********** Success on all i/o format tests *********\n&quot;</span>);
<a name="l00156"></a>00156     <span class="keywordflow">else</span>
<a name="l00157"></a>00157         fprintf(stderr,
<a name="l00158"></a>00158             <span class="stringliteral">&quot;\n  ******* Failure on at least one i/o format test ******\n&quot;</span>);
<a name="l00159"></a>00159     <span class="keywordflow">if</span> (!success) failure = <a class="code" href="environ_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00160"></a>00160 
<a name="l00161"></a>00161 
<a name="l00162"></a>00162     <span class="comment">/* ------------------ Part 2: Test tiff r/w to file ------------------- */</span>
<a name="l00163"></a>00163 <span class="preprocessor">#if  !HAVE_LIBTIFF</span>
<a name="l00164"></a>00164 <span class="preprocessor"></span>    <span class="keywordflow">goto</span> part6;
<a name="l00165"></a>00165 <span class="preprocessor">#endif  </span><span class="comment">/* !HAVE_LIBTIFF */</span>
<a name="l00166"></a>00166 
<a name="l00167"></a>00167     fprintf(stderr, <span class="stringliteral">&quot;\nTest tiff r/w and format extraction\n&quot;</span>);
<a name="l00168"></a>00168     pixa = <a class="code" href="leptprotos_8h.html#a7a6d1b9b5457c3dc9bc8f77a39a81147">pixaCreate</a>(6);
<a name="l00169"></a>00169     pix1 = <a class="code" href="leptprotos_8h.html#a84634846cbb5e01df667d6e9241dfc53">pixRead</a>(<a class="code" href="ioformats__reg_8c.html#a4b9bcb6c82625a2e95f9a072aa341de9">BMP_FILE</a>);
<a name="l00170"></a>00170     pix2 = <a class="code" href="leptprotos_8h.html#a5b3cf59edc39c9b75011ac60932f105a">pixConvert1To2</a>(<a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, pix1, 3, 0);
<a name="l00171"></a>00171     pix4 = <a class="code" href="leptprotos_8h.html#ace50e7c745481f832ef84c98bcfe995c">pixConvert1To4</a>(<a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, pix1, 15, 0);
<a name="l00172"></a>00172     pix16 = <a class="code" href="leptprotos_8h.html#a84634846cbb5e01df667d6e9241dfc53">pixRead</a>(<a class="code" href="ioformats__reg_8c.html#a9061bdecaa03d0766a193bbca3d08ce7">FILE_16BPP</a>);
<a name="l00173"></a>00173     fprintf(stderr, <span class="stringliteral">&quot;Input format: %d\n&quot;</span>, <a class="code" href="leptprotos_8h.html#af854ba4d6f3babd8f2b6881f85468904">pixGetInputFormat</a>(pix16));
<a name="l00174"></a>00174     pix8 = <a class="code" href="leptprotos_8h.html#a8c50b152deda980871a5eaee18609519">pixConvert16To8</a>(pix16, 1);
<a name="l00175"></a>00175     pix32 = <a class="code" href="leptprotos_8h.html#a84634846cbb5e01df667d6e9241dfc53">pixRead</a>(<a class="code" href="ioformats__reg_8c.html#a9af43aea76e4b2db894d3745d372250e">FILE_32BPP</a>);
<a name="l00176"></a>00176     <a class="code" href="leptprotos_8h.html#a4dd659e18d878e2f3b900c2565b61ccc">pixaAddPix</a>(pixa, pix1, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fac1bdfee98ef4dbb3637c7d329cc460a3">L_INSERT</a>);
<a name="l00177"></a>00177     <a class="code" href="leptprotos_8h.html#a4dd659e18d878e2f3b900c2565b61ccc">pixaAddPix</a>(pixa, pix2, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fac1bdfee98ef4dbb3637c7d329cc460a3">L_INSERT</a>);
<a name="l00178"></a>00178     <a class="code" href="leptprotos_8h.html#a4dd659e18d878e2f3b900c2565b61ccc">pixaAddPix</a>(pixa, pix4, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fac1bdfee98ef4dbb3637c7d329cc460a3">L_INSERT</a>);
<a name="l00179"></a>00179     <a class="code" href="leptprotos_8h.html#a4dd659e18d878e2f3b900c2565b61ccc">pixaAddPix</a>(pixa, pix8, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fac1bdfee98ef4dbb3637c7d329cc460a3">L_INSERT</a>);
<a name="l00180"></a>00180     <a class="code" href="leptprotos_8h.html#a4dd659e18d878e2f3b900c2565b61ccc">pixaAddPix</a>(pixa, pix16, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fac1bdfee98ef4dbb3637c7d329cc460a3">L_INSERT</a>);
<a name="l00181"></a>00181     <a class="code" href="leptprotos_8h.html#a4dd659e18d878e2f3b900c2565b61ccc">pixaAddPix</a>(pixa, pix32, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fac1bdfee98ef4dbb3637c7d329cc460a3">L_INSERT</a>);
<a name="l00182"></a>00182     n = <a class="code" href="leptprotos_8h.html#a098d32e94acc16c5d6e91a930a4b45ff">pixaGetCount</a>(pixa);
<a name="l00183"></a>00183 
<a name="l00184"></a>00184     success = <a class="code" href="environ_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00185"></a>00185     <span class="keywordflow">for</span> (i = 0; i &lt; n; i++) {
<a name="l00186"></a>00186         pix = <a class="code" href="leptprotos_8h.html#a3f62a77cf11114981267a6cf9918fc45">pixaGetPix</a>(pixa, i, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa890051b4927a821110da74bae0d3c529">L_CLONE</a>);
<a name="l00187"></a>00187         d = <a class="code" href="leptprotos_8h.html#a1646270a1eae38cd7af74c68351ce513">pixGetDepth</a>(pix);
<a name="l00188"></a>00188         fprintf(stderr, <span class="stringliteral">&quot;%d bpp\n&quot;</span>, d);
<a name="l00189"></a>00189         <span class="keywordflow">if</span> (i == 0) {   <span class="comment">/* 1 bpp */</span>
<a name="l00190"></a>00190             <a class="code" href="leptprotos_8h.html#a5a9a534e77de5e57d74ff3d678ca59e0">pixWrite</a>(<span class="stringliteral">&quot;/tmp/junkg3.tif&quot;</span>, pix, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a20a19f6a17ef80a4bc3592d8577ec015">IFF_TIFF_G3</a>);
<a name="l00191"></a>00191             <a class="code" href="leptprotos_8h.html#a5a9a534e77de5e57d74ff3d678ca59e0">pixWrite</a>(<span class="stringliteral">&quot;/tmp/junkg4.tif&quot;</span>, pix, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a663de6dc5bd3417a37675d0187f7bd03">IFF_TIFF_G4</a>);
<a name="l00192"></a>00192             <a class="code" href="leptprotos_8h.html#a5a9a534e77de5e57d74ff3d678ca59e0">pixWrite</a>(<span class="stringliteral">&quot;/tmp/junkrle.tif&quot;</span>, pix, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635aca51795c367578f3106a6c4d42d62a89">IFF_TIFF_RLE</a>);
<a name="l00193"></a>00193             <a class="code" href="leptprotos_8h.html#a5a9a534e77de5e57d74ff3d678ca59e0">pixWrite</a>(<span class="stringliteral">&quot;/tmp/junkpb.tif&quot;</span>, pix, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a65df02ca29472d41ee38f72db9d312f9">IFF_TIFF_PACKBITS</a>);
<a name="l00194"></a>00194             <span class="keywordflow">if</span> (<a class="code" href="ioformats__reg_8c.html#aba414cb94ac191a108964c103191d601">testcomp</a>(<span class="stringliteral">&quot;/tmp/junkg3.tif&quot;</span>, pix, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a20a19f6a17ef80a4bc3592d8577ec015">IFF_TIFF_G3</a>)) success = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00195"></a>00195             <span class="keywordflow">if</span> (<a class="code" href="ioformats__reg_8c.html#aba414cb94ac191a108964c103191d601">testcomp</a>(<span class="stringliteral">&quot;/tmp/junkg4.tif&quot;</span>, pix, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a663de6dc5bd3417a37675d0187f7bd03">IFF_TIFF_G4</a>)) success = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00196"></a>00196             <span class="keywordflow">if</span> (<a class="code" href="ioformats__reg_8c.html#aba414cb94ac191a108964c103191d601">testcomp</a>(<span class="stringliteral">&quot;/tmp/junkrle.tif&quot;</span>, pix, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635aca51795c367578f3106a6c4d42d62a89">IFF_TIFF_RLE</a>))
<a name="l00197"></a>00197                 success = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00198"></a>00198             <span class="keywordflow">if</span> (<a class="code" href="ioformats__reg_8c.html#aba414cb94ac191a108964c103191d601">testcomp</a>(<span class="stringliteral">&quot;/tmp/junkpb.tif&quot;</span>, pix, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a65df02ca29472d41ee38f72db9d312f9">IFF_TIFF_PACKBITS</a>))
<a name="l00199"></a>00199                 success = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00200"></a>00200         }
<a name="l00201"></a>00201         <a class="code" href="leptprotos_8h.html#a5a9a534e77de5e57d74ff3d678ca59e0">pixWrite</a>(<span class="stringliteral">&quot;/tmp/junklzw.tif&quot;</span>, pix, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a3eabcf217f57689b3799f8b881d1666f">IFF_TIFF_LZW</a>);
<a name="l00202"></a>00202         <a class="code" href="leptprotos_8h.html#a5a9a534e77de5e57d74ff3d678ca59e0">pixWrite</a>(<span class="stringliteral">&quot;/tmp/junkzip.tif&quot;</span>, pix, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635af8e00c57cf7d6267639641ef491c650b">IFF_TIFF_ZIP</a>);
<a name="l00203"></a>00203         <a class="code" href="leptprotos_8h.html#a5a9a534e77de5e57d74ff3d678ca59e0">pixWrite</a>(<span class="stringliteral">&quot;/tmp/junknon.tif&quot;</span>, pix, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a896f3a013494bd8cbbf10cafc193bbdb">IFF_TIFF</a>);
<a name="l00204"></a>00204         <span class="keywordflow">if</span> (<a class="code" href="ioformats__reg_8c.html#aba414cb94ac191a108964c103191d601">testcomp</a>(<span class="stringliteral">&quot;/tmp/junklzw.tif&quot;</span>, pix, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a3eabcf217f57689b3799f8b881d1666f">IFF_TIFF_LZW</a>)) success = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00205"></a>00205         <span class="keywordflow">if</span> (<a class="code" href="ioformats__reg_8c.html#aba414cb94ac191a108964c103191d601">testcomp</a>(<span class="stringliteral">&quot;/tmp/junkzip.tif&quot;</span>, pix, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635af8e00c57cf7d6267639641ef491c650b">IFF_TIFF_ZIP</a>)) success = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00206"></a>00206         <span class="keywordflow">if</span> (<a class="code" href="ioformats__reg_8c.html#aba414cb94ac191a108964c103191d601">testcomp</a>(<span class="stringliteral">&quot;/tmp/junknon.tif&quot;</span>, pix, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a896f3a013494bd8cbbf10cafc193bbdb">IFF_TIFF</a>)) success = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00207"></a>00207         <a class="code" href="leptprotos_8h.html#a1b238e61b64e4e5c62f44849cddb9658">pixDestroy</a>(&amp;pix);
<a name="l00208"></a>00208     }
<a name="l00209"></a>00209     <span class="keywordflow">if</span> (success)
<a name="l00210"></a>00210         fprintf(stderr,
<a name="l00211"></a>00211             <span class="stringliteral">&quot;\n  ********** Success on tiff r/w to file *********\n\n&quot;</span>);
<a name="l00212"></a>00212     <span class="keywordflow">else</span>
<a name="l00213"></a>00213         fprintf(stderr,
<a name="l00214"></a>00214             <span class="stringliteral">&quot;\n  ******* Failure on at least one tiff r/w to file ******\n\n&quot;</span>);
<a name="l00215"></a>00215     <span class="keywordflow">if</span> (!success) failure = <a class="code" href="environ_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00216"></a>00216 
<a name="l00217"></a>00217     <span class="comment">/* ------------------ Part 3: Test tiff r/w to memory ----------------- */</span>
<a name="l00218"></a>00218 
<a name="l00219"></a>00219     success = <a class="code" href="environ_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00220"></a>00220     <span class="keywordflow">for</span> (i = 0; i &lt; n; i++) {
<a name="l00221"></a>00221         pix = <a class="code" href="leptprotos_8h.html#a3f62a77cf11114981267a6cf9918fc45">pixaGetPix</a>(pixa, i, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa890051b4927a821110da74bae0d3c529">L_CLONE</a>);
<a name="l00222"></a>00222         d = <a class="code" href="leptprotos_8h.html#a1646270a1eae38cd7af74c68351ce513">pixGetDepth</a>(pix);
<a name="l00223"></a>00223         fprintf(stderr, <span class="stringliteral">&quot;%d bpp\n&quot;</span>, d);
<a name="l00224"></a>00224         <span class="keywordflow">if</span> (i == 0) {   <span class="comment">/* 1 bpp */</span>
<a name="l00225"></a>00225             <a class="code" href="leptprotos_8h.html#a32f0b2dedb0dea539cc23d9a0b7fdcac">pixWriteMemTiff</a>(&amp;data, &amp;size, pix, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a20a19f6a17ef80a4bc3592d8577ec015">IFF_TIFF_G3</a>);
<a name="l00226"></a>00226             nbytes = <a class="code" href="leptprotos_8h.html#ae5e93328f830c77f5b4124d2baea1d9f">nbytesInFile</a>(<span class="stringliteral">&quot;/tmp/junkg3.tif&quot;</span>);
<a name="l00227"></a>00227             fprintf(stderr, <span class="stringliteral">&quot;nbytes = %ld, size = %ld\n&quot;</span>, nbytes, size);
<a name="l00228"></a>00228             pixt = <a class="code" href="leptprotos_8h.html#a41b0d139a28351a7c42222eb46a8a03d">pixReadMemTiff</a>(data, size, 0);
<a name="l00229"></a>00229             <span class="keywordflow">if</span> (<a class="code" href="ioformats__reg_8c.html#a7023b0d8873734c388bc8eeaa2543d50">testcomp_mem</a>(pix, &amp;pixt, i, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a20a19f6a17ef80a4bc3592d8577ec015">IFF_TIFF_G3</a>)) success = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00230"></a>00230             <a class="code" href="leptprotos_8h.html#ab57b50a91a79dab1cb178eea577c58c8">lept_free</a>(data);
<a name="l00231"></a>00231             <a class="code" href="leptprotos_8h.html#a32f0b2dedb0dea539cc23d9a0b7fdcac">pixWriteMemTiff</a>(&amp;data, &amp;size, pix, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a663de6dc5bd3417a37675d0187f7bd03">IFF_TIFF_G4</a>);
<a name="l00232"></a>00232             nbytes = <a class="code" href="leptprotos_8h.html#ae5e93328f830c77f5b4124d2baea1d9f">nbytesInFile</a>(<span class="stringliteral">&quot;/tmp/junkg4.tif&quot;</span>);
<a name="l00233"></a>00233             fprintf(stderr, <span class="stringliteral">&quot;nbytes = %ld, size = %ld\n&quot;</span>, nbytes, size);
<a name="l00234"></a>00234             pixt = <a class="code" href="leptprotos_8h.html#a41b0d139a28351a7c42222eb46a8a03d">pixReadMemTiff</a>(data, size, 0);
<a name="l00235"></a>00235             <span class="keywordflow">if</span> (<a class="code" href="ioformats__reg_8c.html#a7023b0d8873734c388bc8eeaa2543d50">testcomp_mem</a>(pix, &amp;pixt, i, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a663de6dc5bd3417a37675d0187f7bd03">IFF_TIFF_G4</a>)) success = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00236"></a>00236             <a class="code" href="leptprotos_8h.html#afbba705ff3823d99596c70a3ad00064e">readHeaderMemTiff</a>(data, size, 0, &amp;w, &amp;h, &amp;bps, &amp;spp,
<a name="l00237"></a>00237                               <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00238"></a>00238             fprintf(stderr, <span class="stringliteral">&quot;(w,h,bps,spp) = (%d,%d,%d,%d)\n&quot;</span>, w, h, bps, spp);
<a name="l00239"></a>00239             <a class="code" href="leptprotos_8h.html#ab57b50a91a79dab1cb178eea577c58c8">lept_free</a>(data);
<a name="l00240"></a>00240             <a class="code" href="leptprotos_8h.html#a32f0b2dedb0dea539cc23d9a0b7fdcac">pixWriteMemTiff</a>(&amp;data, &amp;size, pix, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635aca51795c367578f3106a6c4d42d62a89">IFF_TIFF_RLE</a>);
<a name="l00241"></a>00241             nbytes = <a class="code" href="leptprotos_8h.html#ae5e93328f830c77f5b4124d2baea1d9f">nbytesInFile</a>(<span class="stringliteral">&quot;/tmp/junkrle.tif&quot;</span>);
<a name="l00242"></a>00242             fprintf(stderr, <span class="stringliteral">&quot;nbytes = %ld, size = %ld\n&quot;</span>, nbytes, size);
<a name="l00243"></a>00243             pixt = <a class="code" href="leptprotos_8h.html#a41b0d139a28351a7c42222eb46a8a03d">pixReadMemTiff</a>(data, size, 0);
<a name="l00244"></a>00244             <span class="keywordflow">if</span> (<a class="code" href="ioformats__reg_8c.html#a7023b0d8873734c388bc8eeaa2543d50">testcomp_mem</a>(pix, &amp;pixt, i, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635aca51795c367578f3106a6c4d42d62a89">IFF_TIFF_RLE</a>)) success = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00245"></a>00245             <a class="code" href="leptprotos_8h.html#ab57b50a91a79dab1cb178eea577c58c8">lept_free</a>(data);
<a name="l00246"></a>00246             <a class="code" href="leptprotos_8h.html#a32f0b2dedb0dea539cc23d9a0b7fdcac">pixWriteMemTiff</a>(&amp;data, &amp;size, pix, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a65df02ca29472d41ee38f72db9d312f9">IFF_TIFF_PACKBITS</a>);
<a name="l00247"></a>00247             nbytes = <a class="code" href="leptprotos_8h.html#ae5e93328f830c77f5b4124d2baea1d9f">nbytesInFile</a>(<span class="stringliteral">&quot;/tmp/junkpb.tif&quot;</span>);
<a name="l00248"></a>00248             fprintf(stderr, <span class="stringliteral">&quot;nbytes = %ld, size = %ld\n&quot;</span>, nbytes, size);
<a name="l00249"></a>00249             pixt = <a class="code" href="leptprotos_8h.html#a41b0d139a28351a7c42222eb46a8a03d">pixReadMemTiff</a>(data, size, 0);
<a name="l00250"></a>00250             <span class="keywordflow">if</span> (<a class="code" href="ioformats__reg_8c.html#a7023b0d8873734c388bc8eeaa2543d50">testcomp_mem</a>(pix, &amp;pixt, i, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a65df02ca29472d41ee38f72db9d312f9">IFF_TIFF_PACKBITS</a>)) success = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00251"></a>00251             <a class="code" href="leptprotos_8h.html#ab57b50a91a79dab1cb178eea577c58c8">lept_free</a>(data);
<a name="l00252"></a>00252         }
<a name="l00253"></a>00253         <a class="code" href="leptprotos_8h.html#a32f0b2dedb0dea539cc23d9a0b7fdcac">pixWriteMemTiff</a>(&amp;data, &amp;size, pix, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a3eabcf217f57689b3799f8b881d1666f">IFF_TIFF_LZW</a>);
<a name="l00254"></a>00254         pixt = <a class="code" href="leptprotos_8h.html#a41b0d139a28351a7c42222eb46a8a03d">pixReadMemTiff</a>(data, size, 0);
<a name="l00255"></a>00255         <span class="keywordflow">if</span> (<a class="code" href="ioformats__reg_8c.html#a7023b0d8873734c388bc8eeaa2543d50">testcomp_mem</a>(pix, &amp;pixt, i, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a3eabcf217f57689b3799f8b881d1666f">IFF_TIFF_LZW</a>)) success = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00256"></a>00256         <a class="code" href="leptprotos_8h.html#ab57b50a91a79dab1cb178eea577c58c8">lept_free</a>(data);
<a name="l00257"></a>00257         <a class="code" href="leptprotos_8h.html#a32f0b2dedb0dea539cc23d9a0b7fdcac">pixWriteMemTiff</a>(&amp;data, &amp;size, pix, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635af8e00c57cf7d6267639641ef491c650b">IFF_TIFF_ZIP</a>);
<a name="l00258"></a>00258         pixt = <a class="code" href="leptprotos_8h.html#a41b0d139a28351a7c42222eb46a8a03d">pixReadMemTiff</a>(data, size, 0);
<a name="l00259"></a>00259         <span class="keywordflow">if</span> (<a class="code" href="ioformats__reg_8c.html#a7023b0d8873734c388bc8eeaa2543d50">testcomp_mem</a>(pix, &amp;pixt, i, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635af8e00c57cf7d6267639641ef491c650b">IFF_TIFF_ZIP</a>)) success = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00260"></a>00260         <a class="code" href="leptprotos_8h.html#afbba705ff3823d99596c70a3ad00064e">readHeaderMemTiff</a>(data, size, 0, &amp;w, &amp;h, &amp;bps, &amp;spp, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00261"></a>00261         fprintf(stderr, <span class="stringliteral">&quot;(w,h,bps,spp) = (%d,%d,%d,%d)\n&quot;</span>, w, h, bps, spp);
<a name="l00262"></a>00262         <a class="code" href="leptprotos_8h.html#ab57b50a91a79dab1cb178eea577c58c8">lept_free</a>(data);
<a name="l00263"></a>00263         <a class="code" href="leptprotos_8h.html#a32f0b2dedb0dea539cc23d9a0b7fdcac">pixWriteMemTiff</a>(&amp;data, &amp;size, pix, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a896f3a013494bd8cbbf10cafc193bbdb">IFF_TIFF</a>);
<a name="l00264"></a>00264         pixt = <a class="code" href="leptprotos_8h.html#a41b0d139a28351a7c42222eb46a8a03d">pixReadMemTiff</a>(data, size, 0);
<a name="l00265"></a>00265         <span class="keywordflow">if</span> (<a class="code" href="ioformats__reg_8c.html#a7023b0d8873734c388bc8eeaa2543d50">testcomp_mem</a>(pix, &amp;pixt, i, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a896f3a013494bd8cbbf10cafc193bbdb">IFF_TIFF</a>)) success = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00266"></a>00266         <a class="code" href="leptprotos_8h.html#ab57b50a91a79dab1cb178eea577c58c8">lept_free</a>(data);
<a name="l00267"></a>00267         <a class="code" href="leptprotos_8h.html#a1b238e61b64e4e5c62f44849cddb9658">pixDestroy</a>(&amp;pix);
<a name="l00268"></a>00268     }
<a name="l00269"></a>00269     <span class="keywordflow">if</span> (success)
<a name="l00270"></a>00270         fprintf(stderr,
<a name="l00271"></a>00271             <span class="stringliteral">&quot;\n  ********** Success on tiff r/w to memory *********\n\n&quot;</span>);
<a name="l00272"></a>00272     <span class="keywordflow">else</span>
<a name="l00273"></a>00273         fprintf(stderr,
<a name="l00274"></a>00274             <span class="stringliteral">&quot;\n  ******* Failure on at least one tiff r/w to memory ******\n\n&quot;</span>);
<a name="l00275"></a>00275     <span class="keywordflow">if</span> (!success) failure = <a class="code" href="environ_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00276"></a>00276 
<a name="l00277"></a>00277 
<a name="l00278"></a>00278     <span class="comment">/* ---------------- Part 4: Test non-tiff r/w to memory ---------------- */</span>
<a name="l00279"></a>00279 
<a name="l00280"></a>00280 <span class="preprocessor">#if HAVE_FMEMOPEN</span>
<a name="l00281"></a>00281 <span class="preprocessor"></span>    <a class="code" href="leptprotos_8h.html#a5f7e20d7f986e81b5caa47e38def8985">pixDisplayWrite</a>(<a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, -1);
<a name="l00282"></a>00282     success = <a class="code" href="environ_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00283"></a>00283     <span class="keywordflow">for</span> (i = 0; i &lt; n; i++) {
<a name="l00284"></a>00284         pix = <a class="code" href="leptprotos_8h.html#a3f62a77cf11114981267a6cf9918fc45">pixaGetPix</a>(pixa, i, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa890051b4927a821110da74bae0d3c529">L_CLONE</a>);
<a name="l00285"></a>00285         d = <a class="code" href="leptprotos_8h.html#a1646270a1eae38cd7af74c68351ce513">pixGetDepth</a>(pix);
<a name="l00286"></a>00286         sprintf(psname, <span class="stringliteral">&quot;/tmp/junkps.%d&quot;</span>, d);
<a name="l00287"></a>00287         fprintf(stderr, <span class="stringliteral">&quot;%d bpp\n&quot;</span>, d);
<a name="l00288"></a>00288         <span class="keywordflow">if</span> (d != 16) {
<a name="l00289"></a>00289             <span class="keywordflow">if</span> (<a class="code" href="ioformats__reg_8c.html#aa1767647474fbb60b2a6cb7d25e2ee58">test_writemem</a>(pix, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a2ec77ead70eea85c6d7cc7372ea7394e">IFF_PNG</a>, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) success = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00290"></a>00290             <span class="keywordflow">if</span> (<a class="code" href="ioformats__reg_8c.html#aa1767647474fbb60b2a6cb7d25e2ee58">test_writemem</a>(pix, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a950bb53327657f8701d5cead4144d780">IFF_BMP</a>, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) success = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00291"></a>00291         }
<a name="l00292"></a>00292         <span class="keywordflow">if</span> (<a class="code" href="ioformats__reg_8c.html#aa1767647474fbb60b2a6cb7d25e2ee58">test_writemem</a>(pix, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635ac33278083e5bc66c865dc2830efe3255">IFF_PNM</a>, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) success = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00293"></a>00293         <span class="keywordflow">if</span> (<a class="code" href="ioformats__reg_8c.html#aa1767647474fbb60b2a6cb7d25e2ee58">test_writemem</a>(pix, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635abe5eea8e1774e62940f69db8f6c91305">IFF_PS</a>, psname)) success = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00294"></a>00294         <span class="keywordflow">if</span> (d == 8 || d == 32)
<a name="l00295"></a>00295             <span class="keywordflow">if</span> (<a class="code" href="ioformats__reg_8c.html#aa1767647474fbb60b2a6cb7d25e2ee58">test_writemem</a>(pix, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635af0d248e8c70ac2d66a436f0967d6663e">IFF_JFIF_JPEG</a>, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) success = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00296"></a>00296         <a class="code" href="leptprotos_8h.html#a1b238e61b64e4e5c62f44849cddb9658">pixDestroy</a>(&amp;pix);
<a name="l00297"></a>00297     }
<a name="l00298"></a>00298     <span class="keywordflow">if</span> (success)
<a name="l00299"></a>00299         fprintf(stderr,
<a name="l00300"></a>00300             <span class="stringliteral">&quot;\n  ********** Success on non-tiff r/w to memory *********\n\n&quot;</span>);
<a name="l00301"></a>00301     <span class="keywordflow">else</span>
<a name="l00302"></a>00302         fprintf(stderr,
<a name="l00303"></a>00303             <span class="stringliteral">&quot;\n  **** Failure on at least one non-tiff r/w to memory *****\n\n&quot;</span>);
<a name="l00304"></a>00304     <span class="keywordflow">if</span> (!success) failure = <a class="code" href="environ_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00305"></a>00305 <span class="preprocessor">#else</span>
<a name="l00306"></a>00306 <span class="preprocessor"></span>        fprintf(stderr,
<a name="l00307"></a>00307             <span class="stringliteral">&quot;\n  ***** Non-tiff r/w to memory not enabled *****\n\n&quot;</span>);
<a name="l00308"></a>00308 <span class="preprocessor">#endif  </span><span class="comment">/*  HAVE_FMEMOPEN  */</span>
<a name="l00309"></a>00309 
<a name="l00310"></a>00310     <a class="code" href="leptprotos_8h.html#a6775cff91fdef2336a3f3037f7bb55f3">pixaDestroy</a>(&amp;pixa);
<a name="l00311"></a>00311 
<a name="l00312"></a>00312     <span class="comment">/* ------------ Part 5: Test multipage tiff r/w to memory ------------ */</span>
<a name="l00313"></a>00313 
<a name="l00314"></a>00314         <span class="comment">/* Make a multipage tiff file, and read it back into memory */</span>
<a name="l00315"></a>00315     success = <a class="code" href="environ_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00316"></a>00316     pix = <a class="code" href="leptprotos_8h.html#a84634846cbb5e01df667d6e9241dfc53">pixRead</a>(<span class="stringliteral">&quot;feyn.tif&quot;</span>);
<a name="l00317"></a>00317     pixa = <a class="code" href="leptprotos_8h.html#a5e3f965e552c7531c215fb194d792b6c">pixaSplitPix</a>(pix, 3, 3, 0, 0);
<a name="l00318"></a>00318     <span class="keywordflow">for</span> (i = 0; i &lt; 9; i++) {
<a name="l00319"></a>00319         pixt = <a class="code" href="leptprotos_8h.html#a3f62a77cf11114981267a6cf9918fc45">pixaGetPix</a>(pixa, i, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa890051b4927a821110da74bae0d3c529">L_CLONE</a>);
<a name="l00320"></a>00320         <span class="keywordflow">if</span> (i == 0)
<a name="l00321"></a>00321             <a class="code" href="leptprotos_8h.html#ac2aca639c4b5c84de35ccc617383f233">pixWriteTiff</a>(<span class="stringliteral">&quot;/tmp/junktiffmpage.tif&quot;</span>, pixt, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a663de6dc5bd3417a37675d0187f7bd03">IFF_TIFF_G4</a>, <span class="stringliteral">&quot;w&quot;</span>);
<a name="l00322"></a>00322         <span class="keywordflow">else</span>
<a name="l00323"></a>00323             <a class="code" href="leptprotos_8h.html#ac2aca639c4b5c84de35ccc617383f233">pixWriteTiff</a>(<span class="stringliteral">&quot;/tmp/junktiffmpage.tif&quot;</span>, pixt, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a663de6dc5bd3417a37675d0187f7bd03">IFF_TIFF_G4</a>, <span class="stringliteral">&quot;a&quot;</span>);
<a name="l00324"></a>00324         <a class="code" href="leptprotos_8h.html#a1b238e61b64e4e5c62f44849cddb9658">pixDestroy</a>(&amp;pixt);
<a name="l00325"></a>00325     }
<a name="l00326"></a>00326     data = <a class="code" href="leptprotos_8h.html#a3c6cc030405a520b5ad850c80c9211ae">l_binaryRead</a>(<span class="stringliteral">&quot;/tmp/junktiffmpage.tif&quot;</span>, &amp;nbytes);
<a name="l00327"></a>00327     <a class="code" href="leptprotos_8h.html#a6775cff91fdef2336a3f3037f7bb55f3">pixaDestroy</a>(&amp;pixa);
<a name="l00328"></a>00328 
<a name="l00329"></a>00329         <span class="comment">/* Read the individual pages from memory to a pix */</span>
<a name="l00330"></a>00330     pixa = <a class="code" href="leptprotos_8h.html#a7a6d1b9b5457c3dc9bc8f77a39a81147">pixaCreate</a>(9);
<a name="l00331"></a>00331     <span class="keywordflow">for</span> (i = 0; i &lt; 9; i++) {
<a name="l00332"></a>00332         pixt = <a class="code" href="leptprotos_8h.html#a41b0d139a28351a7c42222eb46a8a03d">pixReadMemTiff</a>(data, nbytes, i);
<a name="l00333"></a>00333         <a class="code" href="leptprotos_8h.html#a4dd659e18d878e2f3b900c2565b61ccc">pixaAddPix</a>(pixa, pixt, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fac1bdfee98ef4dbb3637c7d329cc460a3">L_INSERT</a>);
<a name="l00334"></a>00334     }
<a name="l00335"></a>00335     <a class="code" href="leptprotos_8h.html#ab57b50a91a79dab1cb178eea577c58c8">lept_free</a>(data);
<a name="l00336"></a>00336 
<a name="l00337"></a>00337         <span class="comment">/* Un-tile the pix in the pixa back to the original image */</span>
<a name="l00338"></a>00338     pixt = <a class="code" href="leptprotos_8h.html#adaf20e900c37c2f622254b2868d30d17">pixaDisplayUnsplit</a>(pixa, 3, 3, 0, 0);
<a name="l00339"></a>00339     <a class="code" href="leptprotos_8h.html#a6775cff91fdef2336a3f3037f7bb55f3">pixaDestroy</a>(&amp;pixa);
<a name="l00340"></a>00340 
<a name="l00341"></a>00341         <span class="comment">/* Clip to foreground to remove any extra rows or columns */</span>
<a name="l00342"></a>00342     <a class="code" href="leptprotos_8h.html#a98f6daaf4affed436b8f2da85967e06d">pixClipToForeground</a>(pix, &amp;pix1, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00343"></a>00343     <a class="code" href="leptprotos_8h.html#a98f6daaf4affed436b8f2da85967e06d">pixClipToForeground</a>(pixt, &amp;pix2, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00344"></a>00344     <a class="code" href="compare_8c.html#a1c9bd362d963e6bd000573717472bfd0">pixEqual</a>(pix1, pix2, &amp;same); 
<a name="l00345"></a>00345     <span class="keywordflow">if</span> (same)
<a name="l00346"></a>00346         fprintf(stderr,
<a name="l00347"></a>00347             <span class="stringliteral">&quot;\n  ******* Success on tiff multipage read from memory ******\n\n&quot;</span>);
<a name="l00348"></a>00348     <span class="keywordflow">else</span>
<a name="l00349"></a>00349         fprintf(stderr,
<a name="l00350"></a>00350             <span class="stringliteral">&quot;\n  ******* Failure on tiff multipage read from memory ******\n\n&quot;</span>);
<a name="l00351"></a>00351     <span class="keywordflow">if</span> (!same) failure = <a class="code" href="environ_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00352"></a>00352 
<a name="l00353"></a>00353     <a class="code" href="leptprotos_8h.html#a1b238e61b64e4e5c62f44849cddb9658">pixDestroy</a>(&amp;pix);
<a name="l00354"></a>00354     <a class="code" href="leptprotos_8h.html#a1b238e61b64e4e5c62f44849cddb9658">pixDestroy</a>(&amp;pixt);
<a name="l00355"></a>00355     <a class="code" href="leptprotos_8h.html#a1b238e61b64e4e5c62f44849cddb9658">pixDestroy</a>(&amp;pix1);
<a name="l00356"></a>00356     <a class="code" href="leptprotos_8h.html#a1b238e61b64e4e5c62f44849cddb9658">pixDestroy</a>(&amp;pix2);
<a name="l00357"></a>00357 
<a name="l00358"></a>00358     <span class="comment">/* ------------ Part 6: Test 24 bpp writing ------------ */</span>
<a name="l00359"></a>00359 <span class="preprocessor">#if  !HAVE_LIBTIFF</span>
<a name="l00360"></a>00360 <span class="preprocessor"></span>part6:
<a name="l00361"></a>00361 <span class="preprocessor">#endif  </span><span class="comment">/* !HAVE_LIBTIFF */</span>
<a name="l00362"></a>00362 
<a name="l00363"></a>00363 <span class="preprocessor">#if  !HAVE_LIBPNG || !HAVE_LIBJPEG || !HAVE_LIBTIFF</span>
<a name="l00364"></a>00364 <span class="preprocessor"></span>    <span class="keywordflow">goto</span> finish;
<a name="l00365"></a>00365 <span class="preprocessor">#endif  </span><span class="comment">/* !HAVE_LIBPNG || !HAVE_LIBJPEG || !HAVE_LIBTIFF */</span>
<a name="l00366"></a>00366 
<a name="l00367"></a>00367         <span class="comment">/* Generate a 24 bpp (not 32 bpp !!) rgb pix and write it out */</span>
<a name="l00368"></a>00368     success = <a class="code" href="environ_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00369"></a>00369     pix = <a class="code" href="leptprotos_8h.html#a84634846cbb5e01df667d6e9241dfc53">pixRead</a>(<span class="stringliteral">&quot;marge.jpg&quot;</span>);
<a name="l00370"></a>00370     pixt = <a class="code" href="ioformats__reg_8c.html#aa1a66ea392c07421751d886020302b7b">make_24_bpp_pix</a>(pix);
<a name="l00371"></a>00371     <a class="code" href="leptprotos_8h.html#a5a9a534e77de5e57d74ff3d678ca59e0">pixWrite</a>(<span class="stringliteral">&quot;/tmp/junk24.png&quot;</span>, pixt, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a2ec77ead70eea85c6d7cc7372ea7394e">IFF_PNG</a>);
<a name="l00372"></a>00372     <a class="code" href="leptprotos_8h.html#a5a9a534e77de5e57d74ff3d678ca59e0">pixWrite</a>(<span class="stringliteral">&quot;/tmp/junk24.jpg&quot;</span>, pixt, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635af0d248e8c70ac2d66a436f0967d6663e">IFF_JFIF_JPEG</a>);
<a name="l00373"></a>00373     <a class="code" href="leptprotos_8h.html#a5a9a534e77de5e57d74ff3d678ca59e0">pixWrite</a>(<span class="stringliteral">&quot;/tmp/junk24.tif&quot;</span>, pixt, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a896f3a013494bd8cbbf10cafc193bbdb">IFF_TIFF</a>);
<a name="l00374"></a>00374     pixd = <a class="code" href="leptprotos_8h.html#a84634846cbb5e01df667d6e9241dfc53">pixRead</a>(<span class="stringliteral">&quot;/tmp/junk24.png&quot;</span>);
<a name="l00375"></a>00375     <a class="code" href="compare_8c.html#a1c9bd362d963e6bd000573717472bfd0">pixEqual</a>(pix, pixd, &amp;same);
<a name="l00376"></a>00376     <span class="keywordflow">if</span> (!same) success = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00377"></a>00377     <a class="code" href="leptprotos_8h.html#a1b238e61b64e4e5c62f44849cddb9658">pixDestroy</a>(&amp;pixd);
<a name="l00378"></a>00378     pixd = <a class="code" href="leptprotos_8h.html#a84634846cbb5e01df667d6e9241dfc53">pixRead</a>(<span class="stringliteral">&quot;/tmp/junk24.jpg&quot;</span>);
<a name="l00379"></a>00379     <a class="code" href="leptprotos_8h.html#a6b6399dc2d0c609eba15c0d4540001ea">regTestCompareSimilarPix</a>(rp, pix, pixd, 10, 0.0002, 0);
<a name="l00380"></a>00380     <a class="code" href="leptprotos_8h.html#a1b238e61b64e4e5c62f44849cddb9658">pixDestroy</a>(&amp;pixd);
<a name="l00381"></a>00381     pixd = <a class="code" href="leptprotos_8h.html#a84634846cbb5e01df667d6e9241dfc53">pixRead</a>(<span class="stringliteral">&quot;/tmp/junk24.tif&quot;</span>);
<a name="l00382"></a>00382     <a class="code" href="compare_8c.html#a1c9bd362d963e6bd000573717472bfd0">pixEqual</a>(pix, pixd, &amp;same);
<a name="l00383"></a>00383     <span class="keywordflow">if</span> (!same) success = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00384"></a>00384     <a class="code" href="leptprotos_8h.html#a1b238e61b64e4e5c62f44849cddb9658">pixDestroy</a>(&amp;pixd);
<a name="l00385"></a>00385     <span class="keywordflow">if</span> (success)
<a name="l00386"></a>00386         fprintf(stderr,
<a name="l00387"></a>00387             <span class="stringliteral">&quot;\n  ******* Success on 24 bpp rgb writing *******\n\n&quot;</span>);
<a name="l00388"></a>00388     <span class="keywordflow">else</span>
<a name="l00389"></a>00389         fprintf(stderr,
<a name="l00390"></a>00390             <span class="stringliteral">&quot;\n  ******* Failure on 24 bpp rgb writing *******\n\n&quot;</span>);
<a name="l00391"></a>00391     <span class="keywordflow">if</span> (!success) failure = <a class="code" href="environ_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00392"></a>00392     <a class="code" href="leptprotos_8h.html#a1b238e61b64e4e5c62f44849cddb9658">pixDestroy</a>(&amp;pix);
<a name="l00393"></a>00393     <a class="code" href="leptprotos_8h.html#a1b238e61b64e4e5c62f44849cddb9658">pixDestroy</a>(&amp;pixt);
<a name="l00394"></a>00394 
<a name="l00395"></a>00395     <span class="comment">/* -------------- Part 7: Read header information -------------- */</span>
<a name="l00396"></a>00396     success = <a class="code" href="environ_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00397"></a>00397     <span class="keywordflow">if</span> (<a class="code" href="ioformats__reg_8c.html#a8cc335a218d16cb56d7738169468a2b4">get_header_data</a>(<a class="code" href="ioformats__reg_8c.html#afc1dddee32fc2ec926ae00abd17c7098">FILE_1BPP</a>, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a663de6dc5bd3417a37675d0187f7bd03">IFF_TIFF_G4</a>)) success = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00398"></a>00398     <span class="keywordflow">if</span> (<a class="code" href="ioformats__reg_8c.html#a8cc335a218d16cb56d7738169468a2b4">get_header_data</a>(<a class="code" href="ioformats__reg_8c.html#a0b0f64825c76f3999070e68c70af4dbb">FILE_2BPP</a>, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a2ec77ead70eea85c6d7cc7372ea7394e">IFF_PNG</a>)) success = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00399"></a>00399     <span class="keywordflow">if</span> (<a class="code" href="ioformats__reg_8c.html#a8cc335a218d16cb56d7738169468a2b4">get_header_data</a>(<a class="code" href="ioformats__reg_8c.html#a4a7f4aed15e45acf42678bb7e4226cbf">FILE_2BPP_C</a>, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a2ec77ead70eea85c6d7cc7372ea7394e">IFF_PNG</a>)) success = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00400"></a>00400     <span class="keywordflow">if</span> (<a class="code" href="ioformats__reg_8c.html#a8cc335a218d16cb56d7738169468a2b4">get_header_data</a>(<a class="code" href="ioformats__reg_8c.html#a7c93d799fd358aaaec75d10ebb6ef8ea">FILE_4BPP</a>, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a2ec77ead70eea85c6d7cc7372ea7394e">IFF_PNG</a>)) success = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00401"></a>00401     <span class="keywordflow">if</span> (<a class="code" href="ioformats__reg_8c.html#a8cc335a218d16cb56d7738169468a2b4">get_header_data</a>(<a class="code" href="ioformats__reg_8c.html#a9a76a8dbe9a6e52171430acc44191c3f">FILE_4BPP_C</a>, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a2ec77ead70eea85c6d7cc7372ea7394e">IFF_PNG</a>)) success = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00402"></a>00402     <span class="keywordflow">if</span> (<a class="code" href="ioformats__reg_8c.html#a8cc335a218d16cb56d7738169468a2b4">get_header_data</a>(<a class="code" href="ioformats__reg_8c.html#a669a421ea544c0b7081f425a6ad82da4">FILE_8BPP_1</a>, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a2ec77ead70eea85c6d7cc7372ea7394e">IFF_PNG</a>)) success = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00403"></a>00403     <span class="keywordflow">if</span> (<a class="code" href="ioformats__reg_8c.html#a8cc335a218d16cb56d7738169468a2b4">get_header_data</a>(<a class="code" href="ioformats__reg_8c.html#aa63b828d29fba84b26be4cf0ee3725e4">FILE_8BPP_2</a>, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a2ec77ead70eea85c6d7cc7372ea7394e">IFF_PNG</a>)) success = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00404"></a>00404     <span class="keywordflow">if</span> (<a class="code" href="ioformats__reg_8c.html#a8cc335a218d16cb56d7738169468a2b4">get_header_data</a>(<a class="code" href="ioformats__reg_8c.html#a6d846523e9a15d36d4c82c3a9ebc15d8">FILE_8BPP_3</a>, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635af0d248e8c70ac2d66a436f0967d6663e">IFF_JFIF_JPEG</a>)) success = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00405"></a>00405     <span class="keywordflow">if</span> (<a class="code" href="ioformats__reg_8c.html#a8cc335a218d16cb56d7738169468a2b4">get_header_data</a>(<a class="code" href="ioformats__reg_8c.html#a9061bdecaa03d0766a193bbca3d08ce7">FILE_16BPP</a>, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635af8e00c57cf7d6267639641ef491c650b">IFF_TIFF_ZIP</a>)) success = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00406"></a>00406     <span class="keywordflow">if</span> (<a class="code" href="ioformats__reg_8c.html#a8cc335a218d16cb56d7738169468a2b4">get_header_data</a>(<a class="code" href="ioformats__reg_8c.html#a9af43aea76e4b2db894d3745d372250e">FILE_32BPP</a>, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635af0d248e8c70ac2d66a436f0967d6663e">IFF_JFIF_JPEG</a>)) success = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00407"></a>00407 
<a name="l00408"></a>00408 <span class="preprocessor">#if HAVE_FMEMOPEN</span>
<a name="l00409"></a>00409 <span class="preprocessor"></span>    pix = <a class="code" href="leptprotos_8h.html#a84634846cbb5e01df667d6e9241dfc53">pixRead</a>(<a class="code" href="ioformats__reg_8c.html#a669a421ea544c0b7081f425a6ad82da4">FILE_8BPP_1</a>);
<a name="l00410"></a>00410     tempname = <a class="code" href="leptprotos_8h.html#a42aaf4f1511e9cb01e7f6c7b5ddf12a6">genTempFilename</a>((<span class="keyword">const</span> <span class="keywordtype">char</span> *)<span class="stringliteral">&quot;/tmp&quot;</span>, (<span class="keyword">const</span> <span class="keywordtype">char</span> *)<span class="stringliteral">&quot;.pnm&quot;</span>,
<a name="l00411"></a>00411                                1, 1);
<a name="l00412"></a>00412     <a class="code" href="leptprotos_8h.html#a5a9a534e77de5e57d74ff3d678ca59e0">pixWrite</a>(tempname, pix, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635ac33278083e5bc66c865dc2830efe3255">IFF_PNM</a>);
<a name="l00413"></a>00413     <span class="keywordflow">if</span> (<a class="code" href="ioformats__reg_8c.html#a8cc335a218d16cb56d7738169468a2b4">get_header_data</a>(tempname, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635ac33278083e5bc66c865dc2830efe3255">IFF_PNM</a>)) success = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00414"></a>00414     <a class="code" href="leptprotos_8h.html#a1b238e61b64e4e5c62f44849cddb9658">pixDestroy</a>(&amp;pix);
<a name="l00415"></a>00415     <a class="code" href="leptprotos_8h.html#ab57b50a91a79dab1cb178eea577c58c8">lept_free</a>(tempname);
<a name="l00416"></a>00416 <span class="preprocessor">#endif  </span><span class="comment">/* HAVE_FMEMOPEN */</span>
<a name="l00417"></a>00417 
<a name="l00418"></a>00418     pix = <a class="code" href="leptprotos_8h.html#a84634846cbb5e01df667d6e9241dfc53">pixRead</a>(<a class="code" href="ioformats__reg_8c.html#afc1dddee32fc2ec926ae00abd17c7098">FILE_1BPP</a>);
<a name="l00419"></a>00419     tempname = <a class="code" href="leptprotos_8h.html#a42aaf4f1511e9cb01e7f6c7b5ddf12a6">genTempFilename</a>((<span class="keyword">const</span> <span class="keywordtype">char</span> *)<span class="stringliteral">&quot;/tmp&quot;</span>, (<span class="keyword">const</span> <span class="keywordtype">char</span> *)<span class="stringliteral">&quot;.tif&quot;</span>,
<a name="l00420"></a>00420                                1, 1);
<a name="l00421"></a>00421     <a class="code" href="leptprotos_8h.html#a5a9a534e77de5e57d74ff3d678ca59e0">pixWrite</a>(tempname, pix, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a20a19f6a17ef80a4bc3592d8577ec015">IFF_TIFF_G3</a>);
<a name="l00422"></a>00422     <span class="keywordflow">if</span> (<a class="code" href="ioformats__reg_8c.html#a8cc335a218d16cb56d7738169468a2b4">get_header_data</a>(tempname, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a20a19f6a17ef80a4bc3592d8577ec015">IFF_TIFF_G3</a>)) success = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00423"></a>00423     <a class="code" href="leptprotos_8h.html#a5a9a534e77de5e57d74ff3d678ca59e0">pixWrite</a>(tempname, pix, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a663de6dc5bd3417a37675d0187f7bd03">IFF_TIFF_G4</a>);
<a name="l00424"></a>00424     <span class="keywordflow">if</span> (<a class="code" href="ioformats__reg_8c.html#a8cc335a218d16cb56d7738169468a2b4">get_header_data</a>(tempname, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a663de6dc5bd3417a37675d0187f7bd03">IFF_TIFF_G4</a>)) success = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00425"></a>00425     <a class="code" href="leptprotos_8h.html#a5a9a534e77de5e57d74ff3d678ca59e0">pixWrite</a>(tempname, pix, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a65df02ca29472d41ee38f72db9d312f9">IFF_TIFF_PACKBITS</a>);
<a name="l00426"></a>00426     <span class="keywordflow">if</span> (<a class="code" href="ioformats__reg_8c.html#a8cc335a218d16cb56d7738169468a2b4">get_header_data</a>(tempname, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a65df02ca29472d41ee38f72db9d312f9">IFF_TIFF_PACKBITS</a>)) success = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00427"></a>00427     <a class="code" href="leptprotos_8h.html#a5a9a534e77de5e57d74ff3d678ca59e0">pixWrite</a>(tempname, pix, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635aca51795c367578f3106a6c4d42d62a89">IFF_TIFF_RLE</a>);
<a name="l00428"></a>00428     <span class="keywordflow">if</span> (<a class="code" href="ioformats__reg_8c.html#a8cc335a218d16cb56d7738169468a2b4">get_header_data</a>(tempname, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635aca51795c367578f3106a6c4d42d62a89">IFF_TIFF_RLE</a>)) success = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00429"></a>00429     <a class="code" href="leptprotos_8h.html#a5a9a534e77de5e57d74ff3d678ca59e0">pixWrite</a>(tempname, pix, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a3eabcf217f57689b3799f8b881d1666f">IFF_TIFF_LZW</a>);
<a name="l00430"></a>00430     <span class="keywordflow">if</span> (<a class="code" href="ioformats__reg_8c.html#a8cc335a218d16cb56d7738169468a2b4">get_header_data</a>(tempname, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a3eabcf217f57689b3799f8b881d1666f">IFF_TIFF_LZW</a>)) success = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00431"></a>00431     <a class="code" href="leptprotos_8h.html#a5a9a534e77de5e57d74ff3d678ca59e0">pixWrite</a>(tempname, pix, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635af8e00c57cf7d6267639641ef491c650b">IFF_TIFF_ZIP</a>);
<a name="l00432"></a>00432     <span class="keywordflow">if</span> (<a class="code" href="ioformats__reg_8c.html#a8cc335a218d16cb56d7738169468a2b4">get_header_data</a>(tempname, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635af8e00c57cf7d6267639641ef491c650b">IFF_TIFF_ZIP</a>)) success = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00433"></a>00433     <a class="code" href="leptprotos_8h.html#a5a9a534e77de5e57d74ff3d678ca59e0">pixWrite</a>(tempname, pix, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a896f3a013494bd8cbbf10cafc193bbdb">IFF_TIFF</a>);
<a name="l00434"></a>00434     <span class="keywordflow">if</span> (<a class="code" href="ioformats__reg_8c.html#a8cc335a218d16cb56d7738169468a2b4">get_header_data</a>(tempname, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a896f3a013494bd8cbbf10cafc193bbdb">IFF_TIFF</a>)) success = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00435"></a>00435     <a class="code" href="leptprotos_8h.html#a1b238e61b64e4e5c62f44849cddb9658">pixDestroy</a>(&amp;pix);
<a name="l00436"></a>00436     <a class="code" href="leptprotos_8h.html#ab57b50a91a79dab1cb178eea577c58c8">lept_free</a>(tempname);
<a name="l00437"></a>00437 
<a name="l00438"></a>00438     <span class="keywordflow">if</span> (success)
<a name="l00439"></a>00439         fprintf(stderr,
<a name="l00440"></a>00440             <span class="stringliteral">&quot;\n  ******* Success on reading headers *******\n\n&quot;</span>);
<a name="l00441"></a>00441     <span class="keywordflow">else</span>
<a name="l00442"></a>00442         fprintf(stderr,
<a name="l00443"></a>00443             <span class="stringliteral">&quot;\n  ******* Failure on reading headers *******\n\n&quot;</span>);
<a name="l00444"></a>00444     <span class="keywordflow">if</span> (!success) failure = <a class="code" href="environ_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00445"></a>00445 
<a name="l00446"></a>00446 <span class="preprocessor">#if  !HAVE_LIBPNG || !HAVE_LIBJPEG || !HAVE_LIBTIFF</span>
<a name="l00447"></a>00447 <span class="preprocessor"></span>finish:
<a name="l00448"></a>00448 <span class="preprocessor">#endif  </span><span class="comment">/* !HAVE_LIBPNG || !HAVE_LIBJPEG || !HAVE_LIBTIFF */</span>
<a name="l00449"></a>00449 
<a name="l00450"></a>00450     <span class="keywordflow">if</span> (!failure)
<a name="l00451"></a>00451         fprintf(stderr,
<a name="l00452"></a>00452             <span class="stringliteral">&quot;  ******* Success on all tests *******\n\n&quot;</span>);
<a name="l00453"></a>00453     <span class="keywordflow">else</span>
<a name="l00454"></a>00454         fprintf(stderr,
<a name="l00455"></a>00455             <span class="stringliteral">&quot;  ******* Failure on at least one test *******\n\n&quot;</span>);
<a name="l00456"></a>00456 
<a name="l00457"></a>00457     <a class="code" href="leptprotos_8h.html#aaa96f119e2744e286fdb1cab5562673a">regTestCleanup</a>(rp);
<a name="l00458"></a>00458     <span class="keywordflow">return</span> 0;
<a name="l00459"></a>00459 }
<a name="l00460"></a>00460 
<a name="l00461"></a>00461 
<a name="l00462"></a>00462     <span class="comment">/* Returns 1 on error */</span>
<a name="l00463"></a>00463 <span class="keyword">static</span> <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>
<a name="l00464"></a><a class="code" href="ioformats__reg_8c.html#aba414cb94ac191a108964c103191d601">00464</a> <a class="code" href="ioformats__reg_8c.html#aba414cb94ac191a108964c103191d601">testcomp</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>  *<a class="code" href="pixserial__reg_8c.html#acbe1cede344a3bc567aea2d2e2ec0b20">filename</a>,
<a name="l00465"></a>00465          <a class="code" href="struct_pix.html">PIX</a>         *pix,
<a name="l00466"></a>00466          <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>      comptype)
<a name="l00467"></a>00467 {
<a name="l00468"></a>00468 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  format, sameformat, sameimage;
<a name="l00469"></a>00469 FILE    *fp;
<a name="l00470"></a>00470 <a class="code" href="struct_pix.html">PIX</a>     *pixt;
<a name="l00471"></a>00471 
<a name="l00472"></a>00472     fp = <a class="code" href="leptprotos_8h.html#a68aadbbcd35203a6e67d1747a7c83b72">lept_fopen</a>(filename, <span class="stringliteral">&quot;rb&quot;</span>);
<a name="l00473"></a>00473     <a class="code" href="leptprotos_8h.html#a13e4c41df3a94df5a0ff1a35c31580bb">findFileFormatStream</a>(fp, &amp;format);
<a name="l00474"></a>00474     sameformat = <a class="code" href="environ_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00475"></a>00475     <span class="keywordflow">if</span> (format != comptype) {
<a name="l00476"></a>00476         fprintf(stderr, <span class="stringliteral">&quot;File %s has format %d, not comptype %d\n&quot;</span>,
<a name="l00477"></a>00477                 filename, format, comptype);
<a name="l00478"></a>00478         sameformat = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00479"></a>00479     }
<a name="l00480"></a>00480     <a class="code" href="leptprotos_8h.html#a83bddee119771cec7c202422f27b9695">lept_fclose</a>(fp);
<a name="l00481"></a>00481     pixt = <a class="code" href="leptprotos_8h.html#a84634846cbb5e01df667d6e9241dfc53">pixRead</a>(filename);
<a name="l00482"></a>00482     <a class="code" href="compare_8c.html#a1c9bd362d963e6bd000573717472bfd0">pixEqual</a>(pix, pixt, &amp;sameimage);
<a name="l00483"></a>00483     <a class="code" href="leptprotos_8h.html#a1b238e61b64e4e5c62f44849cddb9658">pixDestroy</a>(&amp;pixt);
<a name="l00484"></a>00484     <span class="keywordflow">if</span> (!sameimage)
<a name="l00485"></a>00485         fprintf(stderr, <span class="stringliteral">&quot;Write/read fail for file %s with format %d\n&quot;</span>,
<a name="l00486"></a>00486                 filename, format);
<a name="l00487"></a>00487     <span class="keywordflow">return</span> (!sameformat || !sameimage);
<a name="l00488"></a>00488 }
<a name="l00489"></a>00489 
<a name="l00490"></a>00490 
<a name="l00491"></a>00491     <span class="comment">/* Returns 1 on error */</span>
<a name="l00492"></a>00492 <span class="keyword">static</span> <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>
<a name="l00493"></a><a class="code" href="ioformats__reg_8c.html#a7023b0d8873734c388bc8eeaa2543d50">00493</a> <a class="code" href="ioformats__reg_8c.html#a7023b0d8873734c388bc8eeaa2543d50">testcomp_mem</a>(<a class="code" href="struct_pix.html">PIX</a>     *pixs,
<a name="l00494"></a>00494              <a class="code" href="struct_pix.html">PIX</a>    **ppixt,
<a name="l00495"></a>00495              <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  index,
<a name="l00496"></a>00496              <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  format)
<a name="l00497"></a>00497 {
<a name="l00498"></a>00498 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  sameimage;
<a name="l00499"></a>00499 <a class="code" href="struct_pix.html">PIX</a>     *pixt;
<a name="l00500"></a>00500 
<a name="l00501"></a>00501     pixt = *ppixt;
<a name="l00502"></a>00502     <a class="code" href="compare_8c.html#a1c9bd362d963e6bd000573717472bfd0">pixEqual</a>(pixs, pixt, &amp;sameimage);
<a name="l00503"></a>00503     <span class="keywordflow">if</span> (!sameimage)
<a name="l00504"></a>00504         fprintf(stderr, <span class="stringliteral">&quot;Mem Write/read fail for file %d with format %d\n&quot;</span>,
<a name="l00505"></a>00505                 index, format);
<a name="l00506"></a>00506     <a class="code" href="leptprotos_8h.html#a1b238e61b64e4e5c62f44849cddb9658">pixDestroy</a>(&amp;pixt);
<a name="l00507"></a>00507     *ppixt = <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00508"></a>00508     <span class="keywordflow">return</span> (!sameimage);
<a name="l00509"></a>00509 }
<a name="l00510"></a>00510 
<a name="l00511"></a>00511 
<a name="l00512"></a>00512     <span class="comment">/* Returns 1 on error */</span>
<a name="l00513"></a>00513 <span class="keyword">static</span> <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>
<a name="l00514"></a><a class="code" href="ioformats__reg_8c.html#aa1767647474fbb60b2a6cb7d25e2ee58">00514</a> <a class="code" href="ioformats__reg_8c.html#aa1767647474fbb60b2a6cb7d25e2ee58">test_writemem</a>(<a class="code" href="struct_pix.html">PIX</a>      *pixs,
<a name="l00515"></a>00515               <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>   format,
<a name="l00516"></a>00516               <span class="keywordtype">char</span>     *psfile)
<a name="l00517"></a>00517 {
<a name="l00518"></a>00518 <a class="code" href="environ_8h.html#a7ed60554e7d6dd89aca643189b1e70ad">l_uint8</a>  *data = <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00519"></a>00519 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>   same;
<a name="l00520"></a>00520 <span class="keywordtype">size_t</span>    <a class="code" href="warper__reg_8c.html#a711275dc7bbe85bb6fa721bc60b8637c">size</a> = 0;
<a name="l00521"></a>00521 <a class="code" href="struct_pix.html">PIX</a>      *pixd = <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00522"></a>00522 
<a name="l00523"></a>00523     <span class="keywordflow">if</span> (format == <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635abe5eea8e1774e62940f69db8f6c91305">IFF_PS</a>) {
<a name="l00524"></a>00524         <a class="code" href="leptprotos_8h.html#a4d4565d71820b5865f721d43c71e0bdd">pixWriteMemPS</a>(&amp;data, &amp;size, pixs, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, 1.0);
<a name="l00525"></a>00525         <a class="code" href="leptprotos_8h.html#aebc18ee4e11cf721b8d2eb46b4f20a83">l_binaryWrite</a>(psfile, <span class="stringliteral">&quot;w&quot;</span>, data, size);
<a name="l00526"></a>00526         <a class="code" href="leptprotos_8h.html#ab57b50a91a79dab1cb178eea577c58c8">lept_free</a>(data);
<a name="l00527"></a>00527         <span class="keywordflow">return</span> 0;
<a name="l00528"></a>00528     }
<a name="l00529"></a>00529 
<a name="l00530"></a>00530     <span class="comment">/* Fail silently if library is not available */</span>
<a name="l00531"></a>00531 <span class="preprocessor">#if !HAVE_LIBJPEG</span>
<a name="l00532"></a>00532 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (format == <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635af0d248e8c70ac2d66a436f0967d6663e">IFF_JFIF_JPEG</a>)
<a name="l00533"></a>00533         <span class="keywordflow">return</span> 0;
<a name="l00534"></a>00534 <span class="preprocessor">#endif  </span><span class="comment">/* !HAVE_LIBJPEG */</span>
<a name="l00535"></a>00535 <span class="preprocessor">#if !HAVE_LIBPNG</span>
<a name="l00536"></a>00536 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (format == <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a2ec77ead70eea85c6d7cc7372ea7394e">IFF_PNG</a>)
<a name="l00537"></a>00537         <span class="keywordflow">return</span> 0;
<a name="l00538"></a>00538 <span class="preprocessor">#endif  </span><span class="comment">/* !HAVE_LIBPNG */</span>
<a name="l00539"></a>00539 <span class="preprocessor">#if !HAVE_LIBTIFF</span>
<a name="l00540"></a>00540 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (format == <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a896f3a013494bd8cbbf10cafc193bbdb">IFF_TIFF</a>)
<a name="l00541"></a>00541         <span class="keywordflow">return</span> 0;
<a name="l00542"></a>00542 <span class="preprocessor">#endif  </span><span class="comment">/* !HAVE_LIBTIFF */</span>
<a name="l00543"></a>00543 
<a name="l00544"></a>00544     <span class="keywordflow">if</span> (<a class="code" href="leptprotos_8h.html#a85c946d975a30bd258dbd451315ffe08">pixWriteMem</a>(&amp;data, &amp;size, pixs, format)) {
<a name="l00545"></a>00545         fprintf(stderr, <span class="stringliteral">&quot;Mem write fail for format %d\n&quot;</span>, format);
<a name="l00546"></a>00546         <span class="keywordflow">return</span> 1;
<a name="l00547"></a>00547     }
<a name="l00548"></a>00548     <span class="keywordflow">if</span> ((pixd = <a class="code" href="leptprotos_8h.html#a027a927dc3438192e3bdae8c219d7f6a">pixReadMem</a>(data, size)) == <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00549"></a>00549         fprintf(stderr, <span class="stringliteral">&quot;Mem read fail for format %d\n&quot;</span>, format);
<a name="l00550"></a>00550         <a class="code" href="leptprotos_8h.html#ab57b50a91a79dab1cb178eea577c58c8">lept_free</a>(data);
<a name="l00551"></a>00551         <span class="keywordflow">return</span> 1;
<a name="l00552"></a>00552     }
<a name="l00553"></a>00553     <span class="keywordflow">if</span> (format == <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635af0d248e8c70ac2d66a436f0967d6663e">IFF_JFIF_JPEG</a>) {
<a name="l00554"></a>00554         fprintf(stderr, <span class="stringliteral">&quot;jpeg size = %ld\n&quot;</span>, size);
<a name="l00555"></a>00555         <a class="code" href="leptprotos_8h.html#a5f7e20d7f986e81b5caa47e38def8985">pixDisplayWrite</a>(pixd, 1);
<a name="l00556"></a>00556         same = <a class="code" href="environ_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00557"></a>00557     }
<a name="l00558"></a>00558     <span class="keywordflow">else</span> {
<a name="l00559"></a>00559         <a class="code" href="compare_8c.html#a1c9bd362d963e6bd000573717472bfd0">pixEqual</a>(pixs, pixd, &amp;same);
<a name="l00560"></a>00560         <span class="keywordflow">if</span> (!same)
<a name="l00561"></a>00561            fprintf(stderr, <span class="stringliteral">&quot;Mem write/read fail for format %d\n&quot;</span>, format);
<a name="l00562"></a>00562     }
<a name="l00563"></a>00563     <a class="code" href="leptprotos_8h.html#a1b238e61b64e4e5c62f44849cddb9658">pixDestroy</a>(&amp;pixd);
<a name="l00564"></a>00564     <a class="code" href="leptprotos_8h.html#ab57b50a91a79dab1cb178eea577c58c8">lept_free</a>(data);
<a name="l00565"></a>00565     <span class="keywordflow">return</span> (!same);
<a name="l00566"></a>00566 }
<a name="l00567"></a>00567 
<a name="l00568"></a>00568 
<a name="l00569"></a>00569     <span class="comment">/* Composes 24 bpp rgb pix */</span>
<a name="l00570"></a>00570 <span class="keyword">static</span> <a class="code" href="struct_pix.html">PIX</a> *
<a name="l00571"></a><a class="code" href="ioformats__reg_8c.html#aa1a66ea392c07421751d886020302b7b">00571</a> <a class="code" href="ioformats__reg_8c.html#aa1a66ea392c07421751d886020302b7b">make_24_bpp_pix</a>(<a class="code" href="struct_pix.html">PIX</a>  *pixs)
<a name="l00572"></a>00572 {
<a name="l00573"></a>00573 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>    i, j, w, h, wpls, wpld, rval, gval, bval;
<a name="l00574"></a>00574 <a class="code" href="environ_8h.html#a4d4d7254020fc95aef5dde8884405358">l_uint32</a>  *lines, *lined, *datas, *datad;
<a name="l00575"></a>00575 <a class="code" href="struct_pix.html">PIX</a>       *pixd;
<a name="l00576"></a>00576 
<a name="l00577"></a>00577     <a class="code" href="leptprotos_8h.html#a11b8bc890f3872b0a19307f4c5a9b41e">pixGetDimensions</a>(pixs, &amp;w, &amp;h, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00578"></a>00578     pixd = <a class="code" href="leptprotos_8h.html#a009df4671d39f94b50a0368af210aebe">pixCreate</a>(w, h, 24);
<a name="l00579"></a>00579     datas = <a class="code" href="leptprotos_8h.html#a44546f758f2cf71bb109bfc114e3ca7f">pixGetData</a>(pixs);
<a name="l00580"></a>00580     wpls = <a class="code" href="leptprotos_8h.html#af0b490472ab7999f208098dd37167d73">pixGetWpl</a>(pixs);
<a name="l00581"></a>00581     datad = <a class="code" href="leptprotos_8h.html#a44546f758f2cf71bb109bfc114e3ca7f">pixGetData</a>(pixd);
<a name="l00582"></a>00582     wpld = <a class="code" href="leptprotos_8h.html#af0b490472ab7999f208098dd37167d73">pixGetWpl</a>(pixd);
<a name="l00583"></a>00583     <span class="keywordflow">for</span> (i = 0; i &lt; h; i++) {
<a name="l00584"></a>00584         lines = datas + i * wpls;
<a name="l00585"></a>00585         lined = datad + i * wpld;
<a name="l00586"></a>00586         <span class="keywordflow">for</span> (j = 0; j &lt; w; j++) {
<a name="l00587"></a>00587             <a class="code" href="leptprotos_8h.html#a30bcb764e91f0bf1c90ab7fcd93fc33d">extractRGBValues</a>(lines[j], &amp;rval, &amp;gval, &amp;bval);
<a name="l00588"></a>00588             *((<a class="code" href="environ_8h.html#a7ed60554e7d6dd89aca643189b1e70ad">l_uint8</a> *)lined + 3 * j) = rval;
<a name="l00589"></a>00589             *((<a class="code" href="environ_8h.html#a7ed60554e7d6dd89aca643189b1e70ad">l_uint8</a> *)lined + 3 * j + 1) = gval;
<a name="l00590"></a>00590             *((<a class="code" href="environ_8h.html#a7ed60554e7d6dd89aca643189b1e70ad">l_uint8</a> *)lined + 3 * j + 2) = bval;
<a name="l00591"></a>00591         }
<a name="l00592"></a>00592     }
<a name="l00593"></a>00593 
<a name="l00594"></a>00594     <span class="keywordflow">return</span> pixd;
<a name="l00595"></a>00595 }
<a name="l00596"></a>00596 
<a name="l00597"></a>00597 
<a name="l00598"></a>00598     <span class="comment">/* Retrieve header data from file */</span>
<a name="l00599"></a>00599 <span class="keyword">static</span> <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>
<a name="l00600"></a><a class="code" href="ioformats__reg_8c.html#a8cc335a218d16cb56d7738169468a2b4">00600</a> <a class="code" href="ioformats__reg_8c.html#a8cc335a218d16cb56d7738169468a2b4">get_header_data</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>  *<a class="code" href="pixserial__reg_8c.html#acbe1cede344a3bc567aea2d2e2ec0b20">filename</a>,
<a name="l00601"></a>00601                 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>      true_format)
<a name="l00602"></a>00602 {
<a name="l00603"></a>00603 <span class="keywordtype">char</span>      <a class="code" href="otsutest1_8c.html#a866e3eea299e33d1f7cdc6e46e65835f">buf</a>[64];
<a name="l00604"></a>00604 <a class="code" href="environ_8h.html#a7ed60554e7d6dd89aca643189b1e70ad">l_uint8</a>  *data;
<a name="l00605"></a>00605 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>   ret1, ret2, format1, format2;
<a name="l00606"></a>00606 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>   w1, w2, h1, h2, d1, d2, bps1, bps2, spp1, spp2, iscmap1, iscmap2;
<a name="l00607"></a>00607 <span class="keywordtype">size_t</span>    size1, size2;
<a name="l00608"></a>00608 
<a name="l00609"></a>00609     <span class="comment">/* Fail silently if library is not available */</span>
<a name="l00610"></a>00610 <span class="preprocessor">#if !HAVE_LIBJPEG</span>
<a name="l00611"></a>00611 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (true_format == <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635af0d248e8c70ac2d66a436f0967d6663e">IFF_JFIF_JPEG</a>)
<a name="l00612"></a>00612         <span class="keywordflow">return</span> 0;
<a name="l00613"></a>00613 <span class="preprocessor">#endif  </span><span class="comment">/* !HAVE_LIBJPEG */</span>
<a name="l00614"></a>00614 <span class="preprocessor">#if !HAVE_LIBPNG</span>
<a name="l00615"></a>00615 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (true_format == <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a2ec77ead70eea85c6d7cc7372ea7394e">IFF_PNG</a>)
<a name="l00616"></a>00616         <span class="keywordflow">return</span> 0;
<a name="l00617"></a>00617 <span class="preprocessor">#endif  </span><span class="comment">/* !HAVE_LIBPNG */</span>
<a name="l00618"></a>00618 <span class="preprocessor">#if !HAVE_LIBTIFF</span>
<a name="l00619"></a>00619 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (true_format == <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a20a19f6a17ef80a4bc3592d8577ec015">IFF_TIFF_G3</a> || true_format == <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a663de6dc5bd3417a37675d0187f7bd03">IFF_TIFF_G4</a> ||
<a name="l00620"></a>00620         true_format == <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635af8e00c57cf7d6267639641ef491c650b">IFF_TIFF_ZIP</a> || true_format == <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a3eabcf217f57689b3799f8b881d1666f">IFF_TIFF_LZW</a> ||
<a name="l00621"></a>00621         true_format == <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a65df02ca29472d41ee38f72db9d312f9">IFF_TIFF_PACKBITS</a> || true_format == <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635aca51795c367578f3106a6c4d42d62a89">IFF_TIFF_RLE</a> ||
<a name="l00622"></a>00622         true_format == <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a896f3a013494bd8cbbf10cafc193bbdb">IFF_TIFF</a>)
<a name="l00623"></a>00623         <span class="keywordflow">return</span> 0;
<a name="l00624"></a>00624 <span class="preprocessor">#endif  </span><span class="comment">/* !HAVE_LIBTIFF */</span>
<a name="l00625"></a>00625 
<a name="l00626"></a>00626         <span class="comment">/* Read header from file */</span>
<a name="l00627"></a>00627     size1 = <a class="code" href="leptprotos_8h.html#ae5e93328f830c77f5b4124d2baea1d9f">nbytesInFile</a>(filename);
<a name="l00628"></a>00628     ret1 = <a class="code" href="leptprotos_8h.html#a8438c60a4e1fbb74caf7cf8f67ee0df8">pixReadHeader</a>(filename, &amp;format1, &amp;w1, &amp;h1, &amp;bps1, &amp;spp1, &amp;iscmap1);
<a name="l00629"></a>00629     d1 = bps1 * spp1;
<a name="l00630"></a>00630     <span class="keywordflow">if</span> (d1 == 24) d1 = 32;
<a name="l00631"></a>00631     <span class="keywordflow">if</span> (ret1)
<a name="l00632"></a>00632         fprintf(stderr, <span class="stringliteral">&quot;Error: couldn&#39;t read header data: %s\n&quot;</span>, filename);
<a name="l00633"></a>00633     <span class="keywordflow">else</span> {
<a name="l00634"></a>00634         <span class="keywordflow">if</span> (format1 &gt; <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a2ec77ead70eea85c6d7cc7372ea7394e">IFF_PNG</a> &amp;&amp; format1 &lt; <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635ac33278083e5bc66c865dc2830efe3255">IFF_PNM</a>) {
<a name="l00635"></a>00635             <a class="code" href="ioformats__reg_8c.html#a2d0f732e19f15d3d5dfdd7504906a2b8">get_tiff_compression_name</a>(buf, format1);
<a name="l00636"></a>00636             fprintf(stderr, <span class="stringliteral">&quot;Format data for image %s with format %s:\n&quot;</span>
<a name="l00637"></a>00637                 <span class="stringliteral">&quot;  nbytes = %ld, size (w, h, d) = (%d, %d, %d)\n&quot;</span>
<a name="l00638"></a>00638                 <span class="stringliteral">&quot;  bps = %d, spp = %d, iscmap = %d\n&quot;</span>,
<a name="l00639"></a>00639                 filename, buf, size1, w1, h1, d1, bps1, spp1, iscmap1);
<a name="l00640"></a>00640         } <span class="keywordflow">else</span> {
<a name="l00641"></a>00641             fprintf(stderr, <span class="stringliteral">&quot;Format data for image %s with format %s:\n&quot;</span>
<a name="l00642"></a>00642                 <span class="stringliteral">&quot;  nbytes = %ld, size (w, h, d) = (%d, %d, %d)\n&quot;</span>
<a name="l00643"></a>00643                 <span class="stringliteral">&quot;  bps = %d, spp = %d, iscmap = %d\n&quot;</span>,
<a name="l00644"></a>00644                 filename, <a class="code" href="pix1_8c.html#a65db7b5cece58497d4ecbd3cfa1002cc">ImageFileFormatExtensions</a>[format1], size1,
<a name="l00645"></a>00645                 w1, h1, d1, bps1, spp1, iscmap1);
<a name="l00646"></a>00646         }
<a name="l00647"></a>00647         <span class="keywordflow">if</span> (format1 != true_format) {
<a name="l00648"></a>00648             fprintf(stderr, <span class="stringliteral">&quot;Error: format is %d; should be %d\n&quot;</span>,
<a name="l00649"></a>00649                     format1, true_format);
<a name="l00650"></a>00650             ret1 = 1;
<a name="l00651"></a>00651         }
<a name="l00652"></a>00652     }
<a name="l00653"></a>00653 
<a name="l00654"></a>00654         <span class="comment">/* Read header from array in memory */</span>
<a name="l00655"></a>00655     data = <a class="code" href="leptprotos_8h.html#a3c6cc030405a520b5ad850c80c9211ae">l_binaryRead</a>(filename, &amp;size2);
<a name="l00656"></a>00656     ret2 = <a class="code" href="leptprotos_8h.html#a02de0d616de251929f9022b7b6a50774">pixReadHeaderMem</a>(data, size2, &amp;format2, &amp;w2, &amp;h2, &amp;bps2,
<a name="l00657"></a>00657                             &amp;spp2, &amp;iscmap2);
<a name="l00658"></a>00658     <a class="code" href="leptprotos_8h.html#ab57b50a91a79dab1cb178eea577c58c8">lept_free</a>(data);
<a name="l00659"></a>00659     d2 = bps2 * spp2;
<a name="l00660"></a>00660     <span class="keywordflow">if</span> (d2 == 24) d2 = 32;
<a name="l00661"></a>00661     <span class="keywordflow">if</span> (ret2)
<a name="l00662"></a>00662         fprintf(stderr, <span class="stringliteral">&quot;Error: couldn&#39;t mem-read header data: %s\n&quot;</span>, filename);
<a name="l00663"></a>00663     <span class="keywordflow">else</span> {
<a name="l00664"></a>00664         <span class="keywordflow">if</span> (size1 != size2 || format1 != format2 || w1 != w2 ||
<a name="l00665"></a>00665             h1 != h2 || d1 != d2 || bps1 != bps2 || spp1 != spp2 ||
<a name="l00666"></a>00666             iscmap1 != iscmap2) {
<a name="l00667"></a>00667             fprintf(stderr, <span class="stringliteral">&quot;Incomsistency reading image %s with format %s\n&quot;</span>,
<a name="l00668"></a>00668                     filename, buf);
<a name="l00669"></a>00669             ret2 = 1;
<a name="l00670"></a>00670         }
<a name="l00671"></a>00671     }
<a name="l00672"></a>00672     <span class="keywordflow">return</span> ret1 || ret2;
<a name="l00673"></a>00673 }
<a name="l00674"></a>00674 
<a name="l00675"></a>00675 
<a name="l00676"></a>00676 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00677"></a><a class="code" href="ioformats__reg_8c.html#a2d0f732e19f15d3d5dfdd7504906a2b8">00677</a> <a class="code" href="ioformats__reg_8c.html#a2d0f732e19f15d3d5dfdd7504906a2b8">get_tiff_compression_name</a>(<span class="keywordtype">char</span>    *<a class="code" href="otsutest1_8c.html#a866e3eea299e33d1f7cdc6e46e65835f">buf</a>,
<a name="l00678"></a>00678                           <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  format)
<a name="l00679"></a>00679 {
<a name="l00680"></a>00680     <span class="keywordflow">if</span> (format == <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a663de6dc5bd3417a37675d0187f7bd03">IFF_TIFF_G4</a>)
<a name="l00681"></a>00681         sprintf(buf, <span class="stringliteral">&quot;tiff_g4&quot;</span>);
<a name="l00682"></a>00682     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (format == <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a20a19f6a17ef80a4bc3592d8577ec015">IFF_TIFF_G3</a>)
<a name="l00683"></a>00683         sprintf(buf, <span class="stringliteral">&quot;tiff_g3&quot;</span>);
<a name="l00684"></a>00684     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (format == <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635af8e00c57cf7d6267639641ef491c650b">IFF_TIFF_ZIP</a>)
<a name="l00685"></a>00685         sprintf(buf, <span class="stringliteral">&quot;tiff_zip&quot;</span>);
<a name="l00686"></a>00686     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (format == <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a3eabcf217f57689b3799f8b881d1666f">IFF_TIFF_LZW</a>)
<a name="l00687"></a>00687         sprintf(buf, <span class="stringliteral">&quot;tiff_lzw&quot;</span>);
<a name="l00688"></a>00688     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (format == <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635aca51795c367578f3106a6c4d42d62a89">IFF_TIFF_RLE</a>)
<a name="l00689"></a>00689         sprintf(buf, <span class="stringliteral">&quot;tiff_rle&quot;</span>);
<a name="l00690"></a>00690     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (format == <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a65df02ca29472d41ee38f72db9d312f9">IFF_TIFF_PACKBITS</a>)
<a name="l00691"></a>00691         sprintf(buf, <span class="stringliteral">&quot;tiff_packbits&quot;</span>);
<a name="l00692"></a>00692     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (format == <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a896f3a013494bd8cbbf10cafc193bbdb">IFF_TIFF</a>)
<a name="l00693"></a>00693         sprintf(buf, <span class="stringliteral">&quot;tiff_uncompressed&quot;</span>);
<a name="l00694"></a>00694     <span class="keywordflow">else</span>
<a name="l00695"></a>00695         fprintf(stderr, <span class="stringliteral">&quot;format %d: not tiff\n&quot;</span>, format);
<a name="l00696"></a>00696     <span class="keywordflow">return</span>;
<a name="l00697"></a>00697 }
<a name="l00698"></a>00698 
<a name="l00699"></a>00699 
</pre></div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="ioformats__reg_8c.html">ioformats_reg.c</a>      </li>
      <li class="footer">Generated by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </li>
    </ul>
  </div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


</body>
</html>
