<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Leptonica: src/colorseg.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<script type="text/javascript">
function hasClass(ele,cls) {
  return ele.className.match(new RegExp('(\\s|^)'+cls+'(\\s|$)'));
}

function addClass(ele,cls) {
  if (!this.hasClass(ele,cls)) ele.className += " "+cls;
}

function removeClass(ele,cls) {
  if (hasClass(ele,cls)) {
    var reg = new RegExp('(\\s|^)'+cls+'(\\s|$)');
    ele.className=ele.className.replace(reg,' ');
  }
}

function toggleVisibility(linkObj) {
 var base = linkObj.getAttribute('id');
 var summary = document.getElementById(base + '-summary');
 var content = document.getElementById(base + '-content');
 var trigger = document.getElementById(base + '-trigger');
 if ( hasClass(linkObj,'closed') ) {
   summary.style.display = 'none';
   content.style.display = 'block';
   trigger.src = 'open.png';
   removeClass(linkObj,'closed');
   addClass(linkObj,'opened');
 } else if ( hasClass(linkObj,'opened') ) {
   summary.style.display = 'block';
   content.style.display = 'none';
   trigger.src = 'closed.png';
   removeClass(linkObj,'opened');
   addClass(linkObj,'closed');
 }
 return false;
}
</script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="moller52-tiny.jpg"></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Leptonica&#160;<span id="projectnumber">1.68</span></div>
   <div id="projectbrief">C Image Processing Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('colorseg_8c.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<h1>colorseg.c File Reference</h1>  </div>
</div>
<div class="contents">

<p>Unsupervised color segmentation; selection and display of color content in HSV.  
<a href="#_details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="allheaders_8h_source.html">allheaders.h</a>&quot;</code><br/>
</div>
<p><a href="colorseg_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="colorseg_8c.html#a93a19aeba26c6e2c80776eb41632c836">pixColorSegmentTryCluster</a> (<a class="el" href="struct_pix.html">PIX</a> *pixd, <a class="el" href="struct_pix.html">PIX</a> *pixs, <a class="el" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a> maxdist, <a class="el" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a> maxcolors)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="struct_pix.html">PIX</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="colorseg_8c.html#a40d9250e22c0cac68b4e9fc4132e5426">pixColorSegment</a> (<a class="el" href="struct_pix.html">PIX</a> *pixs, <a class="el" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a> maxdist, <a class="el" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a> maxcolors, <a class="el" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a> selsize, <a class="el" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a> finalcolors)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="struct_pix.html">PIX</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="colorseg_8c.html#abdad5deb52ec8872bd3f7f3e1cbfe936">pixColorSegmentCluster</a> (<a class="el" href="struct_pix.html">PIX</a> *pixs, <a class="el" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a> maxdist, <a class="el" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a> maxcolors)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="colorseg_8c.html#add6a22eb71424598dd36dc3358d475b1">pixAssignToNearestColor</a> (<a class="el" href="struct_pix.html">PIX</a> *pixd, <a class="el" href="struct_pix.html">PIX</a> *pixs, <a class="el" href="struct_pix.html">PIX</a> *pixm, <a class="el" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a> level, <a class="el" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a> *countarray)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="colorseg_8c.html#aaa7f66295131d68ec4f5edaaa8455b40">pixColorSegmentClean</a> (<a class="el" href="struct_pix.html">PIX</a> *pixs, <a class="el" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a> selsize, <a class="el" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a> *countarray)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="colorseg_8c.html#a15193d14c9e07f9cd64e1211a8e2f745">pixColorSegmentRemoveColors</a> (<a class="el" href="struct_pix.html">PIX</a> *pixd, <a class="el" href="struct_pix.html">PIX</a> *pixs, <a class="el" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a> finalcolors)</td></tr>
<tr><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const <a class="el" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="colorseg_8c.html#a678d3697f6691489ba8959958ed26905">MAX_ALLOWED_ITERATIONS</a> = 20</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const <a class="el" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="colorseg_8c.html#a44d90e153530b913ba5ee54f62967dc2">DIST_EXPAND_FACT</a> = 1.3</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const <a class="el" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="colorseg_8c.html#abc390c466a51f6fd6069c1bb61726b6f">LEVEL_IN_OCTCUBE</a> = 4</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Unsupervised color segmentation; selection and display of color content in HSV. </p>

<p>Definition in file <a class="el" href="colorseg_8c_source.html">colorseg.c</a>.</p>
</div><hr/><h2>Function Documentation</h2>
<a class="anchor" id="a93a19aeba26c6e2c80776eb41632c836"></a><!-- doxytag: member="colorseg.c::pixColorSegmentTryCluster" ref="a93a19aeba26c6e2c80776eb41632c836" args="(PIX *pixd, PIX *pixs, l_int32 maxdist, l_int32 maxcolors)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a> pixColorSegmentTryCluster </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_pix.html">PIX</a> *&#160;</td>
          <td class="paramname"><em>pixd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_pix.html">PIX</a> *&#160;</td>
          <td class="paramname"><em>pixs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>&#160;</td>
          <td class="paramname"><em>maxdist</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>&#160;</td>
          <td class="paramname"><em>maxcolors</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p><a class="el" href="colorseg_8c.html#a93a19aeba26c6e2c80776eb41632c836">pixColorSegmentTryCluster()</a></p>
<p>Input: pixd pixs maxdist maxcolors Return: 0 if OK, 1 on error</p>
<p>Note: This function should only be called from pixColorSegCluster() </p>

<p>Definition at line <a class="el" href="colorseg_8c_source.html#l00237">237</a> of file <a class="el" href="colorseg_8c_source.html">colorseg.c</a>.</p>

<p>References <a class="el" href="pix_8h_source.html#l00145">COLOR_BLUE</a>, <a class="el" href="pix_8h_source.html#l00144">COLOR_GREEN</a>, <a class="el" href="pix_8h_source.html#l00143">COLOR_RED</a>, <a class="el" href="environ_8h_source.html#l00251">ERROR_INT</a>, <a class="el" href="environ_8h_source.html#l00179">FALSE</a>, <a class="el" href="arrayaccess_8h_source.html#l00118">GET_DATA_BYTE</a>, <a class="el" href="environ_8h_source.html#l00265">L_INFO_INT</a>, <a class="el" href="colormap_8c_source.html#l00311">pixcmapAddNewColor()</a>, <a class="el" href="colormap_8c_source.html#l00609">pixcmapClear()</a>, <a class="el" href="colormap_8c_source.html#l00517">pixcmapGetCount()</a>, <a class="el" href="colormap_8c_source.html#l00705">pixcmapResetColor()</a>, <a class="el" href="pix1_8c_source.html#l01288">pixGetColormap()</a>, <a class="el" href="pix1_8c_source.html#l01358">pixGetData()</a>, <a class="el" href="pix1_8c_source.html#l00833">pixGetHeight()</a>, <a class="el" href="pix1_8c_source.html#l00803">pixGetWidth()</a>, <a class="el" href="pix1_8c_source.html#l00970">pixGetWpl()</a>, <a class="el" href="environ_8h_source.html#l00249">PROCNAME</a>, <a class="el" href="arrayaccess_8h_source.html#l00126">SET_DATA_BYTE</a>, and <a class="el" href="environ_8h_source.html#l00175">TRUE</a>.</p>

<p>Referenced by <a class="el" href="colorseg_8c_source.html#l00172">pixColorSegmentCluster()</a>.</p>

</div>
</div>
<a class="anchor" id="a40d9250e22c0cac68b4e9fc4132e5426"></a><!-- doxytag: member="colorseg.c::pixColorSegment" ref="a40d9250e22c0cac68b4e9fc4132e5426" args="(PIX *pixs, l_int32 maxdist, l_int32 maxcolors, l_int32 selsize, l_int32 finalcolors)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct_pix.html">PIX</a>* pixColorSegment </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_pix.html">PIX</a> *&#160;</td>
          <td class="paramname"><em>pixs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>&#160;</td>
          <td class="paramname"><em>maxdist</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>&#160;</td>
          <td class="paramname"><em>maxcolors</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>&#160;</td>
          <td class="paramname"><em>selsize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>&#160;</td>
          <td class="paramname"><em>finalcolors</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p><a class="el" href="colorseg_8c.html#a40d9250e22c0cac68b4e9fc4132e5426">pixColorSegment()</a></p>
<p>Input: pixs (32 bpp; 24-bit color) maxdist (max euclidean dist to existing cluster) maxcolors (max number of colors allowed in first pass) selsize (linear size of sel for closing to remove noise) finalcolors (max number of final colors allowed after 4th pass) Return: pixd (8 bit with colormap), or null on error</p>
<p>Color segmentation proceeds in four phases:</p>
<p>Phase 1: <a class="el" href="colorseg_8c.html#abdad5deb52ec8872bd3f7f3e1cbfe936">pixColorSegmentCluster()</a> The image is traversed in raster order. Each pixel either becomes the representative for a new cluster or is assigned to an existing cluster. Assignment is greedy. The data is stored in a colormapped image. Three auxiliary arrays are used to hold the colors of the representative pixels, for fast lookup. The average color in each cluster is computed.</p>
<p>Phase 2. <a class="el" href="colorseg_8c.html#add6a22eb71424598dd36dc3358d475b1">pixAssignToNearestColor()</a> A second (non-greedy) clustering pass is performed, where each pixel is assigned to the nearest cluster (average). We also keep track of how many pixels are assigned to each cluster.</p>
<p>Phase 3. <a class="el" href="colorseg_8c.html#aaa7f66295131d68ec4f5edaaa8455b40">pixColorSegmentClean()</a> For each cluster, starting with the largest, do a morphological closing to eliminate small components within larger ones.</p>
<p>Phase 4. <a class="el" href="colorseg_8c.html#a15193d14c9e07f9cd64e1211a8e2f745">pixColorSegmentRemoveColors()</a> Eliminate all colors except the most populated 'finalcolors'. Then remove unused colors from the colormap, and reassign those pixels to the nearest remaining cluster, using the original pixel values.</p>
<p>Notes: (1) The goal is to generate a small number of colors. Typically this would be specified by 'finalcolors', a number that would be somewhere between 3 and 6. The parameter 'maxcolors' specifies the maximum number of colors generated in the first phase. This should be larger than finalcolors, perhaps twice as large. If more than 'maxcolors' are generated in the first phase using the input 'maxdist', the distance is repeatedly increased by a multiplicative factor until the condition is satisfied. The implicit relation between 'maxdist' and 'maxcolors' is thus adjusted programmatically. (2) As a very rough guideline, given a target value of 'finalcolors', here are approximate values of 'maxdist' and 'maxcolors' to start with:</p>
<p>finalcolors maxcolors maxdist ----------- --------- ------- 3 6 100 4 8 90 5 10 75 6 12 60</p>
<p>For a given number of finalcolors, if you use too many maxcolors, the result will be noisy. If you use too few, the result will be a relatively poor assignment of colors. </p>

<p>Definition at line <a class="el" href="colorseg_8c_source.html#l00113">113</a> of file <a class="el" href="colorseg_8c_source.html">colorseg.c</a>.</p>

<p>References <a class="el" href="environ_8h_source.html#l00214">CALLOC</a>, <a class="el" href="environ_8h_source.html#l00250">ERROR_PTR</a>, <a class="el" href="environ_8h_source.html#l00216">FREE</a>, <a class="el" href="colorseg_8c_source.html#l00041">LEVEL_IN_OCTCUBE</a>, <a class="el" href="environ_8h_source.html#l00171">NULL</a>, <a class="el" href="colorseg_8c_source.html#l00373">pixAssignToNearestColor()</a>, <a class="el" href="colorseg_8c_source.html#l00466">pixColorSegmentClean()</a>, <a class="el" href="colorseg_8c_source.html#l00172">pixColorSegmentCluster()</a>, <a class="el" href="colorseg_8c_source.html#l00535">pixColorSegmentRemoveColors()</a>, <a class="el" href="pix1_8c_source.html#l00863">pixGetDepth()</a>, and <a class="el" href="environ_8h_source.html#l00249">PROCNAME</a>.</p>

<p>Referenced by <a class="el" href="colorseg__reg_8c_source.html#l00042">main()</a>.</p>

</div>
</div>
<a class="anchor" id="abdad5deb52ec8872bd3f7f3e1cbfe936"></a><!-- doxytag: member="colorseg.c::pixColorSegmentCluster" ref="abdad5deb52ec8872bd3f7f3e1cbfe936" args="(PIX *pixs, l_int32 maxdist, l_int32 maxcolors)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct_pix.html">PIX</a>* pixColorSegmentCluster </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_pix.html">PIX</a> *&#160;</td>
          <td class="paramname"><em>pixs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>&#160;</td>
          <td class="paramname"><em>maxdist</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>&#160;</td>
          <td class="paramname"><em>maxcolors</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p><a class="el" href="colorseg_8c.html#abdad5deb52ec8872bd3f7f3e1cbfe936">pixColorSegmentCluster()</a></p>
<p>Input: pixs (32 bpp; 24-bit color) maxdist (max euclidean dist to existing cluster) maxcolors (max number of colors allowed in first pass) Return: pixd (8 bit with colormap), or null on error</p>
<p>Notes: (1) This is phase 1. See description in <a class="el" href="colorseg_8c.html#a40d9250e22c0cac68b4e9fc4132e5426">pixColorSegment()</a>. (2) Greedy unsupervised classification. If the limit 'maxcolors' is exceeded, the computation is repeated with a larger allowed cluster size. (3) On each successive iteration, 'maxdist' is increased by a constant factor. See comments in <a class="el" href="colorseg_8c.html#a40d9250e22c0cac68b4e9fc4132e5426">pixColorSegment()</a> for a guideline on parameter selection. Note that the diagonal of the 8-bit rgb color cube is about 440, so for 'maxdist' = 440, you are guaranteed to get 1 color! </p>

<p>Definition at line <a class="el" href="colorseg_8c_source.html#l00172">172</a> of file <a class="el" href="colorseg_8c_source.html">colorseg.c</a>.</p>

<p>References <a class="el" href="colorseg_8c_source.html#l00035">DIST_EXPAND_FACT</a>, <a class="el" href="environ_8h_source.html#l00250">ERROR_PTR</a>, <a class="el" href="environ_8h_source.html#l00179">FALSE</a>, <a class="el" href="environ_8h_source.html#l00266">L_INFO_INT2</a>, <a class="el" href="environ_8h_source.html#l00259">L_WARNING_INT</a>, <a class="el" href="colorseg_8c_source.html#l00032">MAX_ALLOWED_ITERATIONS</a>, <a class="el" href="environ_8h_source.html#l00171">NULL</a>, <a class="el" href="colormap_8c_source.html#l00085">pixcmapCreate()</a>, <a class="el" href="colormap_8c_source.html#l00517">pixcmapGetCount()</a>, <a class="el" href="colorseg_8c_source.html#l00237">pixColorSegmentTryCluster()</a>, <a class="el" href="pix1_8c_source.html#l01114">pixCopyResolution()</a>, <a class="el" href="pix1_8c_source.html#l00269">pixCreate()</a>, <a class="el" href="pix1_8c_source.html#l00466">pixDestroy()</a>, <a class="el" href="pix1_8c_source.html#l00863">pixGetDepth()</a>, <a class="el" href="pix1_8c_source.html#l00833">pixGetHeight()</a>, <a class="el" href="pix1_8c_source.html#l00803">pixGetWidth()</a>, <a class="el" href="pix1_8c_source.html#l01312">pixSetColormap()</a>, <a class="el" href="environ_8h_source.html#l00249">PROCNAME</a>, and <a class="el" href="environ_8h_source.html#l00175">TRUE</a>.</p>

<p>Referenced by <a class="el" href="colorseg_8c_source.html#l00113">pixColorSegment()</a>.</p>

</div>
</div>
<a class="anchor" id="add6a22eb71424598dd36dc3358d475b1"></a><!-- doxytag: member="colorseg.c::pixAssignToNearestColor" ref="add6a22eb71424598dd36dc3358d475b1" args="(PIX *pixd, PIX *pixs, PIX *pixm, l_int32 level, l_int32 *countarray)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a> pixAssignToNearestColor </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_pix.html">PIX</a> *&#160;</td>
          <td class="paramname"><em>pixd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_pix.html">PIX</a> *&#160;</td>
          <td class="paramname"><em>pixs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_pix.html">PIX</a> *&#160;</td>
          <td class="paramname"><em>pixm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>&#160;</td>
          <td class="paramname"><em>level</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a> *&#160;</td>
          <td class="paramname"><em>countarray</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p><a class="el" href="colorseg_8c.html#add6a22eb71424598dd36dc3358d475b1">pixAssignToNearestColor()</a></p>
<p>Input: pixd (8 bpp, colormapped) pixs (32 bpp; 24-bit color) pixm (&lt;optional&gt; 1 bpp) level (of octcube used for finding nearest color in cmap) countarray (&lt;optional&gt; ptr to array, in which we can store the number of pixels found in each color in the colormap in pixd) Return: 0 if OK, 1 on error</p>
<p>Notes: (1) This is used in phase 2 of color segmentation, where pixs is the original input image to <a class="el" href="colorseg_8c.html#a40d9250e22c0cac68b4e9fc4132e5426">pixColorSegment()</a>, and pixd is the colormapped image returned from <a class="el" href="colorseg_8c.html#abdad5deb52ec8872bd3f7f3e1cbfe936">pixColorSegmentCluster()</a>. It is also used, with a mask, in phase 4. (2) This is an in-place operation. (3) The colormap in pixd is unchanged. (4) pixs and pixd must be the same size (w, h). (5) The selection mask pixm can be null. If it exists, it must be the same size as pixs and pixd, and only pixels corresponding to fg in pixm are assigned. Set to NULL if all pixels in pixd are to be assigned. (6) The countarray can be null. If it exists, it is pre-allocated and of a size at least equal to the size of the colormap in pixd. (7) This does a best-fit (non-greedy) assignment of pixels to existing clusters. Specifically, it assigns each pixel in pixd to the color index in the pixd colormap that has a color closest to the corresponding rgb pixel in pixs. (8) 'level' is the octcube level used to quickly find the nearest color in the colormap for each pixel. For color segmentation, this parameter is set to LEVEL_IN_OCTCUBE. (9) We build a mapping table from octcube to colormap index so that this function can run in a time (otherwise) independent of the number of colors in the colormap. This avoids a brute-force search for the closest colormap color to each pixel in the image. </p>

<p>Definition at line <a class="el" href="colorseg_8c_source.html#l00373">373</a> of file <a class="el" href="colorseg_8c_source.html">colorseg.c</a>.</p>

<p>References <a class="el" href="pix_8h_source.html#l00145">COLOR_BLUE</a>, <a class="el" href="pix_8h_source.html#l00144">COLOR_GREEN</a>, <a class="el" href="pix_8h_source.html#l00143">COLOR_RED</a>, <a class="el" href="environ_8h_source.html#l00251">ERROR_INT</a>, <a class="el" href="environ_8h_source.html#l00216">FREE</a>, <a class="el" href="arrayaccess_8h_source.html#l00060">GET_DATA_BIT</a>, <a class="el" href="arrayaccess_8h_source.html#l00118">GET_DATA_BYTE</a>, <a class="el" href="colorquant1_8c_source.html#l01419">getOctcubeIndexFromRGB()</a>, <a class="el" href="pix_8h_source.html#l00752">L_MANHATTAN_DISTANCE</a>, <a class="el" href="colorquant1_8c_source.html#l01312">makeRGBToIndexTables()</a>, <a class="el" href="environ_8h_source.html#l00171">NULL</a>, <a class="el" href="colorquant1_8c_source.html#l03758">pixcmapToOctcubeLUT()</a>, <a class="el" href="pix1_8c_source.html#l01288">pixGetColormap()</a>, <a class="el" href="pix1_8c_source.html#l01358">pixGetData()</a>, <a class="el" href="pix1_8c_source.html#l00863">pixGetDepth()</a>, <a class="el" href="pix1_8c_source.html#l00833">pixGetHeight()</a>, <a class="el" href="pix1_8c_source.html#l00803">pixGetWidth()</a>, <a class="el" href="pix1_8c_source.html#l00970">pixGetWpl()</a>, <a class="el" href="environ_8h_source.html#l00249">PROCNAME</a>, and <a class="el" href="arrayaccess_8h_source.html#l00126">SET_DATA_BYTE</a>.</p>

<p>Referenced by <a class="el" href="colorseg_8c_source.html#l00113">pixColorSegment()</a>, and <a class="el" href="colorseg_8c_source.html#l00535">pixColorSegmentRemoveColors()</a>.</p>

</div>
</div>
<a class="anchor" id="aaa7f66295131d68ec4f5edaaa8455b40"></a><!-- doxytag: member="colorseg.c::pixColorSegmentClean" ref="aaa7f66295131d68ec4f5edaaa8455b40" args="(PIX *pixs, l_int32 selsize, l_int32 *countarray)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a> pixColorSegmentClean </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_pix.html">PIX</a> *&#160;</td>
          <td class="paramname"><em>pixs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>&#160;</td>
          <td class="paramname"><em>selsize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a> *&#160;</td>
          <td class="paramname"><em>countarray</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p><a class="el" href="colorseg_8c.html#aaa7f66295131d68ec4f5edaaa8455b40">pixColorSegmentClean()</a></p>
<p>Input: pixs (8 bpp, colormapped) selsize (for closing) countarray (ptr to array containing the number of pixels found in each color in the colormap) Return: 0 if OK, 1 on error</p>
<p>Notes: (1) This operation is in-place. (2) This is phase 3 of color segmentation. It is the first part of a two-step noise removal process. Colors with a large population are closed first; this operation absorbs small sets of intercolated pixels of a different color. </p>

<p>Definition at line <a class="el" href="colorseg_8c_source.html#l00466">466</a> of file <a class="el" href="colorseg_8c_source.html">colorseg.c</a>.</p>

<p>References <a class="el" href="environ_8h_source.html#l00251">ERROR_INT</a>, <a class="el" href="pix_8h_source.html#l00610">L_SORT_DECREASING</a>, <a class="el" href="environ_8h_source.html#l00171">NULL</a>, <a class="el" href="numabasic_8c_source.html#l00403">numaAddNumber()</a>, <a class="el" href="numabasic_8c_source.html#l00177">numaCreate()</a>, <a class="el" href="numabasic_8c_source.html#l00292">numaDestroy()</a>, <a class="el" href="numabasic_8c_source.html#l00647">numaGetIValue()</a>, <a class="el" href="numafunc1_8c_source.html#l02107">numaGetSortIndex()</a>, <a class="el" href="morph_8c_source.html#l01564">pixCloseSafeCompBrick()</a>, <a class="el" href="colormap_8c_source.html#l00672">pixcmapGetColor32()</a>, <a class="el" href="colormap_8c_source.html#l00517">pixcmapGetCount()</a>, <a class="el" href="pix1_8c_source.html#l00466">pixDestroy()</a>, <a class="el" href="grayquant_8c_source.html#l00413">pixGenerateMaskByValue()</a>, <a class="el" href="pix1_8c_source.html#l01288">pixGetColormap()</a>, <a class="el" href="pix1_8c_source.html#l00863">pixGetDepth()</a>, <a class="el" href="pix3_8c_source.html#l00115">pixSetMasked()</a>, <a class="el" href="pix3_8c_source.html#l01175">pixXor()</a>, and <a class="el" href="environ_8h_source.html#l00249">PROCNAME</a>.</p>

<p>Referenced by <a class="el" href="colorseg_8c_source.html#l00113">pixColorSegment()</a>.</p>

</div>
</div>
<a class="anchor" id="a15193d14c9e07f9cd64e1211a8e2f745"></a><!-- doxytag: member="colorseg.c::pixColorSegmentRemoveColors" ref="a15193d14c9e07f9cd64e1211a8e2f745" args="(PIX *pixd, PIX *pixs, l_int32 finalcolors)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a> pixColorSegmentRemoveColors </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_pix.html">PIX</a> *&#160;</td>
          <td class="paramname"><em>pixd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_pix.html">PIX</a> *&#160;</td>
          <td class="paramname"><em>pixs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>&#160;</td>
          <td class="paramname"><em>finalcolors</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p><a class="el" href="colorseg_8c.html#a15193d14c9e07f9cd64e1211a8e2f745">pixColorSegmentRemoveColors()</a></p>
<p>Input: pixd (8 bpp, colormapped) pixs (32 bpp rgb, with initial pixel values) finalcolors (max number of colors to retain) Return: 0 if OK, 1 on error</p>
<p>Notes: (1) This operation is in-place. (2) This is phase 4 of color segmentation, and the second part of the 2-step noise removal. Only 'finalcolors' different colors are retained, with colors with smaller populations being replaced by the nearest color of the remaining colors. For highest accuracy, for pixels that are being replaced, we find the nearest colormap color to the original rgb color. </p>

<p>Definition at line <a class="el" href="colorseg_8c_source.html#l00535">535</a> of file <a class="el" href="colorseg_8c_source.html">colorseg.c</a>.</p>

<p>References <a class="el" href="environ_8h_source.html#l00214">CALLOC</a>, <a class="el" href="environ_8h_source.html#l00251">ERROR_INT</a>, <a class="el" href="environ_8h_source.html#l00216">FREE</a>, <a class="el" href="pix_8h_source.html#l00610">L_SORT_DECREASING</a>, <a class="el" href="colorseg_8c_source.html#l00041">LEVEL_IN_OCTCUBE</a>, <a class="el" href="environ_8h_source.html#l00171">NULL</a>, <a class="el" href="numabasic_8c_source.html#l00292">numaDestroy()</a>, <a class="el" href="numabasic_8c_source.html#l00647">numaGetIValue()</a>, <a class="el" href="numafunc1_8c_source.html#l02107">numaGetSortIndex()</a>, <a class="el" href="colorseg_8c_source.html#l00373">pixAssignToNearestColor()</a>, <a class="el" href="colormap_8c_source.html#l00672">pixcmapGetColor32()</a>, <a class="el" href="colormap_8c_source.html#l00517">pixcmapGetCount()</a>, <a class="el" href="pix1_8c_source.html#l00466">pixDestroy()</a>, <a class="el" href="pix4_8c_source.html#l00475">pixGetCmapHistogram()</a>, <a class="el" href="pix1_8c_source.html#l01288">pixGetColormap()</a>, <a class="el" href="pix1_8c_source.html#l00863">pixGetDepth()</a>, <a class="el" href="pix3_8c_source.html#l00821">pixMakeMaskFromLUT()</a>, <a class="el" href="colorquant1_8c_source.html#l03843">pixRemoveUnusedColors()</a>, <a class="el" href="pix3_8c_source.html#l00115">pixSetMasked()</a>, and <a class="el" href="environ_8h_source.html#l00249">PROCNAME</a>.</p>

<p>Referenced by <a class="el" href="colorseg_8c_source.html#l00113">pixColorSegment()</a>.</p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="a678d3697f6691489ba8959958ed26905"></a><!-- doxytag: member="colorseg.c::MAX_ALLOWED_ITERATIONS" ref="a678d3697f6691489ba8959958ed26905" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a> <a class="el" href="colorseg_8c.html#a678d3697f6691489ba8959958ed26905">MAX_ALLOWED_ITERATIONS</a> = 20<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="colorseg_8c_source.html#l00032">32</a> of file <a class="el" href="colorseg_8c_source.html">colorseg.c</a>.</p>

<p>Referenced by <a class="el" href="colorseg_8c_source.html#l00172">pixColorSegmentCluster()</a>.</p>

</div>
</div>
<a class="anchor" id="a44d90e153530b913ba5ee54f62967dc2"></a><!-- doxytag: member="colorseg.c::DIST_EXPAND_FACT" ref="a44d90e153530b913ba5ee54f62967dc2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a> <a class="el" href="colorseg_8c.html#a44d90e153530b913ba5ee54f62967dc2">DIST_EXPAND_FACT</a> = 1.3<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="colorseg_8c_source.html#l00035">35</a> of file <a class="el" href="colorseg_8c_source.html">colorseg.c</a>.</p>

<p>Referenced by <a class="el" href="colorseg_8c_source.html#l00172">pixColorSegmentCluster()</a>.</p>

</div>
</div>
<a class="anchor" id="abc390c466a51f6fd6069c1bb61726b6f"></a><!-- doxytag: member="colorseg.c::LEVEL_IN_OCTCUBE" ref="abc390c466a51f6fd6069c1bb61726b6f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a> <a class="el" href="colorseg_8c.html#abc390c466a51f6fd6069c1bb61726b6f">LEVEL_IN_OCTCUBE</a> = 4<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="colorseg_8c_source.html#l00041">41</a> of file <a class="el" href="colorseg_8c_source.html">colorseg.c</a>.</p>

<p>Referenced by <a class="el" href="colorseg_8c_source.html#l00113">pixColorSegment()</a>, and <a class="el" href="colorseg_8c_source.html#l00535">pixColorSegmentRemoveColors()</a>.</p>

</div>
</div>
</div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="colorseg_8c.html">colorseg.c</a>      </li>
      <li class="footer">Generated by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </li>
    </ul>
  </div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


</body>
</html>
